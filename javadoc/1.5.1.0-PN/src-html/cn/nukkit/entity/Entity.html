<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="pt">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>// Generated by delombok at Fri Nov 26 12:30:32 BRT 2021<a name="line.1"></a>
<span class="sourceLineNo">002</span>package cn.nukkit.entity;<a name="line.2"></a>
<span class="sourceLineNo">003</span><a name="line.3"></a>
<span class="sourceLineNo">004</span>import cn.nukkit.AdventureSettings;<a name="line.4"></a>
<span class="sourceLineNo">005</span>import cn.nukkit.Player;<a name="line.5"></a>
<span class="sourceLineNo">006</span>import cn.nukkit.Server;<a name="line.6"></a>
<span class="sourceLineNo">007</span>import cn.nukkit.api.DeprecationDetails;<a name="line.7"></a>
<span class="sourceLineNo">008</span>import cn.nukkit.api.PowerNukkitDifference;<a name="line.8"></a>
<span class="sourceLineNo">009</span>import cn.nukkit.api.PowerNukkitOnly;<a name="line.9"></a>
<span class="sourceLineNo">010</span>import cn.nukkit.api.Since;<a name="line.10"></a>
<span class="sourceLineNo">011</span>import cn.nukkit.block.*;<a name="line.11"></a>
<span class="sourceLineNo">012</span>import cn.nukkit.blockentity.BlockEntityPistonArm;<a name="line.12"></a>
<span class="sourceLineNo">013</span>import cn.nukkit.blockstate.BlockState;<a name="line.13"></a>
<span class="sourceLineNo">014</span>import cn.nukkit.entity.data.*;<a name="line.14"></a>
<span class="sourceLineNo">015</span>import cn.nukkit.event.Event;<a name="line.15"></a>
<span class="sourceLineNo">016</span>import cn.nukkit.event.entity.*;<a name="line.16"></a>
<span class="sourceLineNo">017</span>import cn.nukkit.event.entity.EntityDamageEvent.DamageCause;<a name="line.17"></a>
<span class="sourceLineNo">018</span>import cn.nukkit.event.entity.EntityPortalEnterEvent.PortalType;<a name="line.18"></a>
<span class="sourceLineNo">019</span>import cn.nukkit.event.player.PlayerInteractEvent;<a name="line.19"></a>
<span class="sourceLineNo">020</span>import cn.nukkit.event.player.PlayerInteractEvent.Action;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import cn.nukkit.event.player.PlayerTeleportEvent;<a name="line.21"></a>
<span class="sourceLineNo">022</span>import cn.nukkit.item.Item;<a name="line.22"></a>
<span class="sourceLineNo">023</span>import cn.nukkit.item.ItemID;<a name="line.23"></a>
<span class="sourceLineNo">024</span>import cn.nukkit.item.enchantment.sideeffect.SideEffect;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import cn.nukkit.level.*;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import cn.nukkit.level.format.FullChunk;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import cn.nukkit.math.*;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import cn.nukkit.metadata.MetadataValue;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import cn.nukkit.metadata.Metadatable;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import cn.nukkit.nbt.tag.CompoundTag;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import cn.nukkit.nbt.tag.DoubleTag;<a name="line.31"></a>
<span class="sourceLineNo">032</span>import cn.nukkit.nbt.tag.FloatTag;<a name="line.32"></a>
<span class="sourceLineNo">033</span>import cn.nukkit.nbt.tag.ListTag;<a name="line.33"></a>
<span class="sourceLineNo">034</span>import cn.nukkit.network.protocol.*;<a name="line.34"></a>
<span class="sourceLineNo">035</span>import cn.nukkit.network.protocol.types.EntityLink;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import cn.nukkit.plugin.Plugin;<a name="line.36"></a>
<span class="sourceLineNo">037</span>import cn.nukkit.potion.Effect;<a name="line.37"></a>
<span class="sourceLineNo">038</span>import cn.nukkit.scheduler.Task;<a name="line.38"></a>
<span class="sourceLineNo">039</span>import cn.nukkit.utils.ChunkException;<a name="line.39"></a>
<span class="sourceLineNo">040</span>import cn.nukkit.utils.TextFormat;<a name="line.40"></a>
<span class="sourceLineNo">041</span>import cn.nukkit.utils.Utils;<a name="line.41"></a>
<span class="sourceLineNo">042</span>import co.aikar.timings.Timing;<a name="line.42"></a>
<span class="sourceLineNo">043</span>import co.aikar.timings.Timings;<a name="line.43"></a>
<span class="sourceLineNo">044</span>import co.aikar.timings.TimingsHistory;<a name="line.44"></a>
<span class="sourceLineNo">045</span>import com.google.common.collect.Iterables;<a name="line.45"></a>
<span class="sourceLineNo">046</span>import it.unimi.dsi.fastutil.ints.IntArrayList;<a name="line.46"></a>
<span class="sourceLineNo">047</span>import it.unimi.dsi.fastutil.ints.IntCollection;<a name="line.47"></a>
<span class="sourceLineNo">048</span>import javax.annotation.Nonnull;<a name="line.48"></a>
<span class="sourceLineNo">049</span>import javax.annotation.Nullable;<a name="line.49"></a>
<span class="sourceLineNo">050</span>import java.lang.reflect.Constructor;<a name="line.50"></a>
<span class="sourceLineNo">051</span>import java.util.*;<a name="line.51"></a>
<span class="sourceLineNo">052</span>import java.util.concurrent.ConcurrentHashMap;<a name="line.52"></a>
<span class="sourceLineNo">053</span>import java.util.concurrent.ThreadLocalRandom;<a name="line.53"></a>
<span class="sourceLineNo">054</span>import java.util.function.BiPredicate;<a name="line.54"></a>
<span class="sourceLineNo">055</span>import static cn.nukkit.network.protocol.SetEntityLinkPacket.*;<a name="line.55"></a>
<span class="sourceLineNo">056</span>import static cn.nukkit.utils.Utils.dynamic;<a name="line.56"></a>
<span class="sourceLineNo">057</span><a name="line.57"></a>
<span class="sourceLineNo">058</span>/**<a name="line.58"></a>
<span class="sourceLineNo">059</span> * @author MagicDroidX<a name="line.59"></a>
<span class="sourceLineNo">060</span> */<a name="line.60"></a>
<span class="sourceLineNo">061</span>@PowerNukkitDifference(since = "1.4.0.0-PN", info = "All DATA constants were made dynamic because they have tendency to change on Minecraft updates, these dynamic calls will avoid the need of plugin recompilations after Minecraft updates that shifts the data values")<a name="line.61"></a>
<span class="sourceLineNo">062</span>public abstract class Entity extends Location implements Metadatable {<a name="line.62"></a>
<span class="sourceLineNo">063</span>    @java.lang.SuppressWarnings("all")<a name="line.63"></a>
<span class="sourceLineNo">064</span>    private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.LogManager.getLogger(Entity.class);<a name="line.64"></a>
<span class="sourceLineNo">065</span>    @PowerNukkitOnly<a name="line.65"></a>
<span class="sourceLineNo">066</span>    @Since("1.4.0.0-PN")<a name="line.66"></a>
<span class="sourceLineNo">067</span>    public static final Entity[] EMPTY_ARRAY = new Entity[0];<a name="line.67"></a>
<span class="sourceLineNo">068</span>    public static final int NETWORK_ID = -1;<a name="line.68"></a>
<span class="sourceLineNo">069</span><a name="line.69"></a>
<span class="sourceLineNo">070</span>    public abstract int getNetworkId();<a name="line.70"></a>
<span class="sourceLineNo">071</span><a name="line.71"></a>
<span class="sourceLineNo">072</span>    public static final int DATA_TYPE_BYTE = 0;<a name="line.72"></a>
<span class="sourceLineNo">073</span>    public static final int DATA_TYPE_SHORT = 1;<a name="line.73"></a>
<span class="sourceLineNo">074</span>    public static final int DATA_TYPE_INT = 2;<a name="line.74"></a>
<span class="sourceLineNo">075</span>    public static final int DATA_TYPE_FLOAT = 3;<a name="line.75"></a>
<span class="sourceLineNo">076</span>    public static final int DATA_TYPE_STRING = 4;<a name="line.76"></a>
<span class="sourceLineNo">077</span>    public static final int DATA_TYPE_NBT = 5;<a name="line.77"></a>
<span class="sourceLineNo">078</span>    public static final int DATA_TYPE_POS = 6;<a name="line.78"></a>
<span class="sourceLineNo">079</span>    public static final int DATA_TYPE_LONG = 7;<a name="line.79"></a>
<span class="sourceLineNo">080</span>    public static final int DATA_TYPE_VECTOR3F = 8;<a name="line.80"></a>
<span class="sourceLineNo">081</span>    public static final int DATA_FLAGS = dynamic(0);<a name="line.81"></a>
<span class="sourceLineNo">082</span>    public static final int DATA_HEALTH = dynamic(1); //int (minecart/boat)<a name="line.82"></a>
<span class="sourceLineNo">083</span>    public static final int DATA_VARIANT = dynamic(2); //int<a name="line.83"></a>
<span class="sourceLineNo">084</span>    public static final int DATA_COLOR = dynamic(3); //byte<a name="line.84"></a>
<span class="sourceLineNo">085</span>    public static final int DATA_COLOUR = DATA_COLOR;<a name="line.85"></a>
<span class="sourceLineNo">086</span>    public static final int DATA_NAMETAG = dynamic(4); //string<a name="line.86"></a>
<span class="sourceLineNo">087</span>    public static final int DATA_OWNER_EID = dynamic(5); //long<a name="line.87"></a>
<span class="sourceLineNo">088</span>    public static final int DATA_TARGET_EID = dynamic(6); //long<a name="line.88"></a>
<span class="sourceLineNo">089</span>    public static final int DATA_AIR = dynamic(7); //short<a name="line.89"></a>
<span class="sourceLineNo">090</span>    public static final int DATA_POTION_COLOR = dynamic(8); //int (ARGB!)<a name="line.90"></a>
<span class="sourceLineNo">091</span>    public static final int DATA_POTION_AMBIENT = dynamic(9); //byte<a name="line.91"></a>
<span class="sourceLineNo">092</span>    public static final int DATA_JUMP_DURATION = dynamic(10); //long<a name="line.92"></a>
<span class="sourceLineNo">093</span>    public static final int DATA_HURT_TIME = dynamic(11); //int (minecart/boat)<a name="line.93"></a>
<span class="sourceLineNo">094</span>    public static final int DATA_HURT_DIRECTION = dynamic(12); //int (minecart/boat)<a name="line.94"></a>
<span class="sourceLineNo">095</span>    public static final int DATA_PADDLE_TIME_LEFT = dynamic(13); //float<a name="line.95"></a>
<span class="sourceLineNo">096</span>    public static final int DATA_PADDLE_TIME_RIGHT = dynamic(14); //float<a name="line.96"></a>
<span class="sourceLineNo">097</span>    public static final int DATA_EXPERIENCE_VALUE = dynamic(15); //int (xp orb)<a name="line.97"></a>
<span class="sourceLineNo">098</span>    public static final int DATA_DISPLAY_ITEM = dynamic(16); //int (id | (data &lt;&lt; 16))<a name="line.98"></a>
<span class="sourceLineNo">099</span>    public static final int DATA_DISPLAY_OFFSET = dynamic(17); //int<a name="line.99"></a>
<span class="sourceLineNo">100</span>    public static final int DATA_HAS_DISPLAY = dynamic(18); //byte (must be 1 for minecart to show block inside)<a name="line.100"></a>
<span class="sourceLineNo">101</span>    @Since("1.2.0.0-PN")<a name="line.101"></a>
<span class="sourceLineNo">102</span>    public static final int DATA_SWELL = dynamic(19);<a name="line.102"></a>
<span class="sourceLineNo">103</span>    @Since("1.2.0.0-PN")<a name="line.103"></a>
<span class="sourceLineNo">104</span>    public static final int DATA_OLD_SWELL = dynamic(20);<a name="line.104"></a>
<span class="sourceLineNo">105</span>    @Since("1.2.0.0-PN")<a name="line.105"></a>
<span class="sourceLineNo">106</span>    public static final int DATA_SWELL_DIR = dynamic(21);<a name="line.106"></a>
<span class="sourceLineNo">107</span>    @Since("1.2.0.0-PN")<a name="line.107"></a>
<span class="sourceLineNo">108</span>    public static final int DATA_CHARGE_AMOUNT = dynamic(22);<a name="line.108"></a>
<span class="sourceLineNo">109</span>    public static final int DATA_ENDERMAN_HELD_RUNTIME_ID = dynamic(23); //short<a name="line.109"></a>
<span class="sourceLineNo">110</span>    @PowerNukkitOnly<a name="line.110"></a>
<span class="sourceLineNo">111</span>    @Since("1.4.0.0-PN")<a name="line.111"></a>
<span class="sourceLineNo">112</span>    public static final int DATA_CLIENT_EVENT = dynamic(24); //byte<a name="line.112"></a>
<span class="sourceLineNo">113</span>    @Deprecated<a name="line.113"></a>
<span class="sourceLineNo">114</span>    @DeprecationDetails(since = "1.4.0.0-PN", by = "PowerNukkit", reason = "Apparently this the ID 24 was reused to represent CLIENT_EVENT but Cloudburst Nukkit is still mapping it as age")<a name="line.114"></a>
<span class="sourceLineNo">115</span>    public static final int DATA_ENTITY_AGE = dynamic(DATA_CLIENT_EVENT); //short<a name="line.115"></a>
<span class="sourceLineNo">116</span>    @PowerNukkitOnly<a name="line.116"></a>
<span class="sourceLineNo">117</span>    @Since("1.4.0.0-PN")<a name="line.117"></a>
<span class="sourceLineNo">118</span>    public static final int DATA_USING_ITEM = dynamic(25); //byte<a name="line.118"></a>
<span class="sourceLineNo">119</span>    public static final int DATA_PLAYER_FLAGS = dynamic(26); //byte<a name="line.119"></a>
<span class="sourceLineNo">120</span>    @Since("1.2.0.0-PN")<a name="line.120"></a>
<span class="sourceLineNo">121</span>    public static final int DATA_PLAYER_INDEX = dynamic(27);<a name="line.121"></a>
<span class="sourceLineNo">122</span>    public static final int DATA_PLAYER_BED_POSITION = dynamic(28); //block coords<a name="line.122"></a>
<span class="sourceLineNo">123</span>    public static final int DATA_FIREBALL_POWER_X = dynamic(29); //float<a name="line.123"></a>
<span class="sourceLineNo">124</span>    public static final int DATA_FIREBALL_POWER_Y = dynamic(30); //float<a name="line.124"></a>
<span class="sourceLineNo">125</span>    public static final int DATA_FIREBALL_POWER_Z = dynamic(31); //float<a name="line.125"></a>
<span class="sourceLineNo">126</span>    @Since("1.2.0.0-PN")<a name="line.126"></a>
<span class="sourceLineNo">127</span>    public static final int DATA_AUX_POWER = dynamic(32); //???<a name="line.127"></a>
<span class="sourceLineNo">128</span>    @Since("1.2.0.0-PN")<a name="line.128"></a>
<span class="sourceLineNo">129</span>    public static final int DATA_FISH_X = dynamic(33); //float<a name="line.129"></a>
<span class="sourceLineNo">130</span>    @Since("1.2.0.0-PN")<a name="line.130"></a>
<span class="sourceLineNo">131</span>    public static final int DATA_FISH_Z = dynamic(34); //float<a name="line.131"></a>
<span class="sourceLineNo">132</span>    @Since("1.2.0.0-PN")<a name="line.132"></a>
<span class="sourceLineNo">133</span>    public static final int DATA_FISH_ANGLE = dynamic(35); //float<a name="line.133"></a>
<span class="sourceLineNo">134</span>    public static final int DATA_POTION_AUX_VALUE = dynamic(36); //short<a name="line.134"></a>
<span class="sourceLineNo">135</span>    public static final int DATA_LEAD_HOLDER_EID = dynamic(37); //long<a name="line.135"></a>
<span class="sourceLineNo">136</span>    public static final int DATA_SCALE = dynamic(38); //float<a name="line.136"></a>
<span class="sourceLineNo">137</span>    @Since("1.4.0.0-PN")<a name="line.137"></a>
<span class="sourceLineNo">138</span>    public static final int DATA_INTERACTIVE_TAG = dynamic(39); //string (button text)<a name="line.138"></a>
<span class="sourceLineNo">139</span>    @PowerNukkitOnly<a name="line.139"></a>
<span class="sourceLineNo">140</span>    @Since("1.2.0.0-PN")<a name="line.140"></a>
<span class="sourceLineNo">141</span>    @Deprecated<a name="line.141"></a>
<span class="sourceLineNo">142</span>    @DeprecationDetails(by = "PowerNukkit", since = "1.4.0.0-PN", reason = "This is not only for NPC, it\'s used to display any interactive button text and Nukkit added this constant with a different name", replaceWith = "DATA_INTERACTIVE_TAG")<a name="line.142"></a>
<span class="sourceLineNo">143</span>    public static final int DATA_HAS_NPC_COMPONENT = dynamic(DATA_INTERACTIVE_TAG); //byte<a name="line.143"></a>
<span class="sourceLineNo">144</span>    public static final int DATA_NPC_SKIN_ID = dynamic(40); //string<a name="line.144"></a>
<span class="sourceLineNo">145</span>    public static final int DATA_URL_TAG = dynamic(41); //string<a name="line.145"></a>
<span class="sourceLineNo">146</span>    public static final int DATA_MAX_AIR = dynamic(42); //short<a name="line.146"></a>
<span class="sourceLineNo">147</span>    public static final int DATA_MARK_VARIANT = dynamic(43); //int<a name="line.147"></a>
<span class="sourceLineNo">148</span>    public static final int DATA_CONTAINER_TYPE = dynamic(44); //byte<a name="line.148"></a>
<span class="sourceLineNo">149</span>    public static final int DATA_CONTAINER_BASE_SIZE = dynamic(45); //int<a name="line.149"></a>
<span class="sourceLineNo">150</span>    public static final int DATA_CONTAINER_EXTRA_SLOTS_PER_STRENGTH = dynamic(46); //int<a name="line.150"></a>
<span class="sourceLineNo">151</span>    public static final int DATA_BLOCK_TARGET = dynamic(47); //block coords (ender crystal)<a name="line.151"></a>
<span class="sourceLineNo">152</span>    public static final int DATA_WITHER_INVULNERABLE_TICKS = dynamic(48); //int<a name="line.152"></a>
<span class="sourceLineNo">153</span>    public static final int DATA_WITHER_TARGET_1 = dynamic(49); //long<a name="line.153"></a>
<span class="sourceLineNo">154</span>    public static final int DATA_WITHER_TARGET_2 = dynamic(50); //long<a name="line.154"></a>
<span class="sourceLineNo">155</span>    public static final int DATA_WITHER_TARGET_3 = dynamic(51); //long<a name="line.155"></a>
<span class="sourceLineNo">156</span>    @Since("1.2.0.0-PN")<a name="line.156"></a>
<span class="sourceLineNo">157</span>    public static final int DATA_AERIAL_ATTACK = dynamic(52);<a name="line.157"></a>
<span class="sourceLineNo">158</span>    public static final int DATA_BOUNDING_BOX_WIDTH = dynamic(53); //float<a name="line.158"></a>
<span class="sourceLineNo">159</span>    public static final int DATA_BOUNDING_BOX_HEIGHT = dynamic(54); //float<a name="line.159"></a>
<span class="sourceLineNo">160</span>    public static final int DATA_FUSE_LENGTH = dynamic(55); //int<a name="line.160"></a>
<span class="sourceLineNo">161</span>    public static final int DATA_RIDER_SEAT_POSITION = dynamic(56); //vector3f<a name="line.161"></a>
<span class="sourceLineNo">162</span>    public static final int DATA_RIDER_ROTATION_LOCKED = dynamic(57); //byte<a name="line.162"></a>
<span class="sourceLineNo">163</span>    public static final int DATA_RIDER_MAX_ROTATION = dynamic(58); //float<a name="line.163"></a>
<span class="sourceLineNo">164</span>    public static final int DATA_RIDER_MIN_ROTATION = dynamic(59); //float<a name="line.164"></a>
<span class="sourceLineNo">165</span>    @Since("1.4.0.0-PN")<a name="line.165"></a>
<span class="sourceLineNo">166</span>    public static final int DATA_RIDER_ROTATION_OFFSET = dynamic(60);<a name="line.166"></a>
<span class="sourceLineNo">167</span>    public static final int DATA_AREA_EFFECT_CLOUD_RADIUS = dynamic(61); //float<a name="line.167"></a>
<span class="sourceLineNo">168</span>    public static final int DATA_AREA_EFFECT_CLOUD_WAITING = dynamic(62); //int<a name="line.168"></a>
<span class="sourceLineNo">169</span>    public static final int DATA_AREA_EFFECT_CLOUD_PARTICLE_ID = dynamic(63); //int<a name="line.169"></a>
<span class="sourceLineNo">170</span>    @Since("1.2.0.0-PN")<a name="line.170"></a>
<span class="sourceLineNo">171</span>    public static final int DATA_SHULKER_PEEK_ID = dynamic(64); //int<a name="line.171"></a>
<span class="sourceLineNo">172</span>    public static final int DATA_SHULKER_ATTACH_FACE = dynamic(65); //byte<a name="line.172"></a>
<span class="sourceLineNo">173</span>    @Since("1.2.0.0-PN")<a name="line.173"></a>
<span class="sourceLineNo">174</span>    public static final int DATA_SHULKER_ATTACHED = dynamic(66); //short<a name="line.174"></a>
<span class="sourceLineNo">175</span>    public static final int DATA_SHULKER_ATTACH_POS = dynamic(67); //block coords<a name="line.175"></a>
<span class="sourceLineNo">176</span>    public static final int DATA_TRADING_PLAYER_EID = dynamic(68); //long<a name="line.176"></a>
<span class="sourceLineNo">177</span>    @Since("1.2.0.0-PN")<a name="line.177"></a>
<span class="sourceLineNo">178</span>    public static final int DATA_TRADING_CAREER = dynamic(69);<a name="line.178"></a>
<span class="sourceLineNo">179</span>    @Since("1.2.0.0-PN")<a name="line.179"></a>
<span class="sourceLineNo">180</span>    public static final int DATA_HAS_COMMAND_BLOCK = dynamic(70); //byte<a name="line.180"></a>
<span class="sourceLineNo">181</span>    @Since("1.2.0.0-PN")<a name="line.181"></a>
<span class="sourceLineNo">182</span>    public static final int DATA_COMMAND_BLOCK_COMMAND = dynamic(71); //string<a name="line.182"></a>
<span class="sourceLineNo">183</span>    public static final int DATA_COMMAND_BLOCK_LAST_OUTPUT = dynamic(72); //string<a name="line.183"></a>
<span class="sourceLineNo">184</span>    public static final int DATA_COMMAND_BLOCK_TRACK_OUTPUT = dynamic(73); //byte<a name="line.184"></a>
<span class="sourceLineNo">185</span>    public static final int DATA_CONTROLLING_RIDER_SEAT_NUMBER = dynamic(74); //byte<a name="line.185"></a>
<span class="sourceLineNo">186</span>    public static final int DATA_STRENGTH = dynamic(75); //int<a name="line.186"></a>
<span class="sourceLineNo">187</span>    public static final int DATA_MAX_STRENGTH = dynamic(76); //int<a name="line.187"></a>
<span class="sourceLineNo">188</span>    @Since("1.2.0.0-PN")<a name="line.188"></a>
<span class="sourceLineNo">189</span>    public static final int DATA_SPELL_CASTING_COLOR = dynamic(77); //int<a name="line.189"></a>
<span class="sourceLineNo">190</span>    public static final int DATA_LIMITED_LIFE = dynamic(78); //int<a name="line.190"></a>
<span class="sourceLineNo">191</span>    public static final int DATA_ARMOR_STAND_POSE_INDEX = dynamic(79); //int<a name="line.191"></a>
<span class="sourceLineNo">192</span>    public static final int DATA_ENDER_CRYSTAL_TIME_OFFSET = dynamic(80); //int<a name="line.192"></a>
<span class="sourceLineNo">193</span>    public static final int DATA_ALWAYS_SHOW_NAMETAG = dynamic(81); //byte<a name="line.193"></a>
<span class="sourceLineNo">194</span>    public static final int DATA_COLOR_2 = dynamic(82); //byte<a name="line.194"></a>
<span class="sourceLineNo">195</span>    @Since("1.2.0.0-PN")<a name="line.195"></a>
<span class="sourceLineNo">196</span>    public static final int DATA_NAME_AUTHOR = dynamic(83);<a name="line.196"></a>
<span class="sourceLineNo">197</span>    public static final int DATA_SCORE_TAG = dynamic(84); //String<a name="line.197"></a>
<span class="sourceLineNo">198</span>    public static final int DATA_BALLOON_ATTACHED_ENTITY = dynamic(85); //long<a name="line.198"></a>
<span class="sourceLineNo">199</span>    public static final int DATA_PUFFERFISH_SIZE = dynamic(86); //byte<a name="line.199"></a>
<span class="sourceLineNo">200</span>    @Since("1.2.0.0-PN")<a name="line.200"></a>
<span class="sourceLineNo">201</span>    public static final int DATA_BUBBLE_TIME = dynamic(87); //int<a name="line.201"></a>
<span class="sourceLineNo">202</span>    @Since("1.2.0.0-PN")<a name="line.202"></a>
<span class="sourceLineNo">203</span>    public static final int DATA_AGENT = dynamic(88); //long<a name="line.203"></a>
<span class="sourceLineNo">204</span>    @Since("1.2.0.0-PN")<a name="line.204"></a>
<span class="sourceLineNo">205</span>    public static final int DATA_SITTING_AMOUNT = dynamic(89); //??<a name="line.205"></a>
<span class="sourceLineNo">206</span>    @Since("1.2.0.0-PN")<a name="line.206"></a>
<span class="sourceLineNo">207</span>    public static final int DATA_SITTING_AMOUNT_PREVIOUS = dynamic(90); //??<a name="line.207"></a>
<span class="sourceLineNo">208</span>    @Since("1.2.0.0-PN")<a name="line.208"></a>
<span class="sourceLineNo">209</span>    public static final int DATA_EATING_COUNTER = dynamic(91); //int<a name="line.209"></a>
<span class="sourceLineNo">210</span>    public static final int DATA_FLAGS_EXTENDED = dynamic(92); //flags<a name="line.210"></a>
<span class="sourceLineNo">211</span>    @Since("1.2.0.0-PN")<a name="line.211"></a>
<span class="sourceLineNo">212</span>    public static final int DATA_LAYING_AMOUNT = dynamic(93); //??<a name="line.212"></a>
<span class="sourceLineNo">213</span>    @Since("1.2.0.0-PN")<a name="line.213"></a>
<span class="sourceLineNo">214</span>    public static final int DATA_LAYING_AMOUNT_PREVIOUS = dynamic(94); //??<a name="line.214"></a>
<span class="sourceLineNo">215</span>    @Since("1.2.0.0-PN")<a name="line.215"></a>
<span class="sourceLineNo">216</span>    public static final int DATA_DURATION = dynamic(95); //int<a name="line.216"></a>
<span class="sourceLineNo">217</span>    @Since("1.2.0.0-PN")<a name="line.217"></a>
<span class="sourceLineNo">218</span>    public static final int DATA_SPAWN_TIME = dynamic(96); //int<a name="line.218"></a>
<span class="sourceLineNo">219</span>    @Since("1.2.0.0-PN")<a name="line.219"></a>
<span class="sourceLineNo">220</span>    public static final int DATA_CHANGE_RATE = dynamic(97); //float<a name="line.220"></a>
<span class="sourceLineNo">221</span>    @Since("1.2.0.0-PN")<a name="line.221"></a>
<span class="sourceLineNo">222</span>    public static final int DATA_CHANGE_ON_PICKUP = dynamic(98); //float<a name="line.222"></a>
<span class="sourceLineNo">223</span>    @Since("1.2.0.0-PN")<a name="line.223"></a>
<span class="sourceLineNo">224</span>    public static final int DATA_PICKUP_COUNT = dynamic(99); //int<a name="line.224"></a>
<span class="sourceLineNo">225</span>    @Since("1.2.0.0-PN")<a name="line.225"></a>
<span class="sourceLineNo">226</span>    public static final int DATA_INTERACT_TEXT = dynamic(100); //string<a name="line.226"></a>
<span class="sourceLineNo">227</span>    public static final int DATA_TRADE_TIER = dynamic(101); //int<a name="line.227"></a>
<span class="sourceLineNo">228</span>    public static final int DATA_MAX_TRADE_TIER = dynamic(102); //int<a name="line.228"></a>
<span class="sourceLineNo">229</span>    @Since("1.2.0.0-PN")<a name="line.229"></a>
<span class="sourceLineNo">230</span>    public static final int DATA_TRADE_EXPERIENCE = dynamic(103); //int<a name="line.230"></a>
<span class="sourceLineNo">231</span>    @Since("1.1.1.0-PN")<a name="line.231"></a>
<span class="sourceLineNo">232</span>    public static final int DATA_SKIN_ID = dynamic(104); //int<a name="line.232"></a>
<span class="sourceLineNo">233</span>    @Since("1.2.0.0-PN")<a name="line.233"></a>
<span class="sourceLineNo">234</span>    public static final int DATA_SPAWNING_FRAMES = dynamic(105); //??<a name="line.234"></a>
<span class="sourceLineNo">235</span>    @Since("1.2.0.0-PN")<a name="line.235"></a>
<span class="sourceLineNo">236</span>    public static final int DATA_COMMAND_BLOCK_TICK_DELAY = dynamic(106); //int<a name="line.236"></a>
<span class="sourceLineNo">237</span>    @Since("1.2.0.0-PN")<a name="line.237"></a>
<span class="sourceLineNo">238</span>    public static final int DATA_COMMAND_BLOCK_EXECUTE_ON_FIRST_TICK = dynamic(107); //byte<a name="line.238"></a>
<span class="sourceLineNo">239</span>    @Since("1.2.0.0-PN")<a name="line.239"></a>
<span class="sourceLineNo">240</span>    public static final int DATA_AMBIENT_SOUND_INTERVAL = dynamic(108); //float<a name="line.240"></a>
<span class="sourceLineNo">241</span>    @Since("1.3.0.0-PN")<a name="line.241"></a>
<span class="sourceLineNo">242</span>    public static final int DATA_AMBIENT_SOUND_INTERVAL_RANGE = dynamic(109); //float<a name="line.242"></a>
<span class="sourceLineNo">243</span>    @Since("1.2.0.0-PN")<a name="line.243"></a>
<span class="sourceLineNo">244</span>    public static final int DATA_AMBIENT_SOUND_EVENT_NAME = dynamic(110); //string<a name="line.244"></a>
<span class="sourceLineNo">245</span>    @Since("1.2.0.0-PN")<a name="line.245"></a>
<span class="sourceLineNo">246</span>    public static final int DATA_FALL_DAMAGE_MULTIPLIER = dynamic(111); //float<a name="line.246"></a>
<span class="sourceLineNo">247</span>    @Since("1.2.0.0-PN")<a name="line.247"></a>
<span class="sourceLineNo">248</span>    public static final int DATA_NAME_RAW_TEXT = dynamic(112); //??<a name="line.248"></a>
<span class="sourceLineNo">249</span>    @Since("1.2.0.0-PN")<a name="line.249"></a>
<span class="sourceLineNo">250</span>    public static final int DATA_CAN_RIDE_TARGET = dynamic(113); //byte<a name="line.250"></a>
<span class="sourceLineNo">251</span>    @Since("1.3.0.0-PN")<a name="line.251"></a>
<span class="sourceLineNo">252</span>    public static final int DATA_LOW_TIER_CURED_DISCOUNT = dynamic(114); //int<a name="line.252"></a>
<span class="sourceLineNo">253</span>    @Since("1.3.0.0-PN")<a name="line.253"></a>
<span class="sourceLineNo">254</span>    public static final int DATA_HIGH_TIER_CURED_DISCOUNT = dynamic(115); //int<a name="line.254"></a>
<span class="sourceLineNo">255</span>    @Since("1.3.0.0-PN")<a name="line.255"></a>
<span class="sourceLineNo">256</span>    public static final int DATA_NEARBY_CURED_DISCOUNT = dynamic(116); //int<a name="line.256"></a>
<span class="sourceLineNo">257</span>    @Since("1.3.0.0-PN")<a name="line.257"></a>
<span class="sourceLineNo">258</span>    public static final int DATA_NEARBY_CURED_DISCOUNT_TIMESTAMP = dynamic(117); //int<a name="line.258"></a>
<span class="sourceLineNo">259</span>    @Since("1.3.0.0-PN")<a name="line.259"></a>
<span class="sourceLineNo">260</span>    public static final int DATA_HITBOX = dynamic(118); //NBT<a name="line.260"></a>
<span class="sourceLineNo">261</span>    @Since("1.3.0.0-PN")<a name="line.261"></a>
<span class="sourceLineNo">262</span>    public static final int DATA_IS_BUOYANT = dynamic(119); //byte<a name="line.262"></a>
<span class="sourceLineNo">263</span>    @Since("1.5.0.0-PN")<a name="line.263"></a>
<span class="sourceLineNo">264</span>    @PowerNukkitOnly<a name="line.264"></a>
<span class="sourceLineNo">265</span>    public static final int DATA_BASE_RUNTIME_ID = dynamic(120); // ???<a name="line.265"></a>
<span class="sourceLineNo">266</span>    @Since("1.4.0.0-PN")<a name="line.266"></a>
<span class="sourceLineNo">267</span>    public static final int DATA_FREEZING_EFFECT_STRENGTH = dynamic(121);<a name="line.267"></a>
<span class="sourceLineNo">268</span>    @Since("1.3.0.0-PN")<a name="line.268"></a>
<span class="sourceLineNo">269</span>    public static final int DATA_BUOYANCY_DATA = dynamic(122); //string<a name="line.269"></a>
<span class="sourceLineNo">270</span>    @Since("1.4.0.0-PN")<a name="line.270"></a>
<span class="sourceLineNo">271</span>    public static final int DATA_GOAT_HORN_COUNT = dynamic(123); // ???<a name="line.271"></a>
<span class="sourceLineNo">272</span>    @Since("1.5.0.0-PN")<a name="line.272"></a>
<span class="sourceLineNo">273</span>    @PowerNukkitOnly<a name="line.273"></a>
<span class="sourceLineNo">274</span>    public static final int DATA_UPDATE_PROPERTIES = dynamic(124); // ???<a name="line.274"></a>
<span class="sourceLineNo">275</span>    // Flags<a name="line.275"></a>
<span class="sourceLineNo">276</span>    public static final int DATA_FLAG_ONFIRE = dynamic(0);<a name="line.276"></a>
<span class="sourceLineNo">277</span>    public static final int DATA_FLAG_SNEAKING = dynamic(1);<a name="line.277"></a>
<span class="sourceLineNo">278</span>    public static final int DATA_FLAG_RIDING = dynamic(2);<a name="line.278"></a>
<span class="sourceLineNo">279</span>    public static final int DATA_FLAG_SPRINTING = dynamic(3);<a name="line.279"></a>
<span class="sourceLineNo">280</span>    public static final int DATA_FLAG_ACTION = dynamic(4);<a name="line.280"></a>
<span class="sourceLineNo">281</span>    public static final int DATA_FLAG_INVISIBLE = dynamic(5);<a name="line.281"></a>
<span class="sourceLineNo">282</span>    public static final int DATA_FLAG_TEMPTED = dynamic(6);<a name="line.282"></a>
<span class="sourceLineNo">283</span>    public static final int DATA_FLAG_INLOVE = dynamic(7);<a name="line.283"></a>
<span class="sourceLineNo">284</span>    public static final int DATA_FLAG_SADDLED = dynamic(8);<a name="line.284"></a>
<span class="sourceLineNo">285</span>    public static final int DATA_FLAG_POWERED = dynamic(9);<a name="line.285"></a>
<span class="sourceLineNo">286</span>    public static final int DATA_FLAG_IGNITED = dynamic(10);<a name="line.286"></a>
<span class="sourceLineNo">287</span>    public static final int DATA_FLAG_BABY = dynamic(11); //disable head scaling<a name="line.287"></a>
<span class="sourceLineNo">288</span>    public static final int DATA_FLAG_CONVERTING = dynamic(12);<a name="line.288"></a>
<span class="sourceLineNo">289</span>    public static final int DATA_FLAG_CRITICAL = dynamic(13);<a name="line.289"></a>
<span class="sourceLineNo">290</span>    public static final int DATA_FLAG_CAN_SHOW_NAMETAG = dynamic(14);<a name="line.290"></a>
<span class="sourceLineNo">291</span>    public static final int DATA_FLAG_ALWAYS_SHOW_NAMETAG = dynamic(15);<a name="line.291"></a>
<span class="sourceLineNo">292</span>    public static final int DATA_FLAG_IMMOBILE = dynamic(16);<a name="line.292"></a>
<span class="sourceLineNo">293</span>    public static final int DATA_FLAG_NO_AI = DATA_FLAG_IMMOBILE;<a name="line.293"></a>
<span class="sourceLineNo">294</span>    public static final int DATA_FLAG_SILENT = dynamic(17);<a name="line.294"></a>
<span class="sourceLineNo">295</span>    public static final int DATA_FLAG_WALLCLIMBING = dynamic(18);<a name="line.295"></a>
<span class="sourceLineNo">296</span>    public static final int DATA_FLAG_CAN_CLIMB = dynamic(19);<a name="line.296"></a>
<span class="sourceLineNo">297</span>    public static final int DATA_FLAG_SWIMMER = dynamic(20);<a name="line.297"></a>
<span class="sourceLineNo">298</span>    public static final int DATA_FLAG_CAN_FLY = dynamic(21);<a name="line.298"></a>
<span class="sourceLineNo">299</span>    public static final int DATA_FLAG_WALKER = dynamic(22);<a name="line.299"></a>
<span class="sourceLineNo">300</span>    public static final int DATA_FLAG_RESTING = dynamic(23);<a name="line.300"></a>
<span class="sourceLineNo">301</span>    public static final int DATA_FLAG_SITTING = dynamic(24);<a name="line.301"></a>
<span class="sourceLineNo">302</span>    public static final int DATA_FLAG_ANGRY = dynamic(25);<a name="line.302"></a>
<span class="sourceLineNo">303</span>    public static final int DATA_FLAG_INTERESTED = dynamic(26);<a name="line.303"></a>
<span class="sourceLineNo">304</span>    public static final int DATA_FLAG_CHARGED = dynamic(27);<a name="line.304"></a>
<span class="sourceLineNo">305</span>    public static final int DATA_FLAG_TAMED = dynamic(28);<a name="line.305"></a>
<span class="sourceLineNo">306</span>    public static final int DATA_FLAG_ORPHANED = dynamic(29);<a name="line.306"></a>
<span class="sourceLineNo">307</span>    public static final int DATA_FLAG_LEASHED = dynamic(30);<a name="line.307"></a>
<span class="sourceLineNo">308</span>    public static final int DATA_FLAG_SHEARED = dynamic(31);<a name="line.308"></a>
<span class="sourceLineNo">309</span>    public static final int DATA_FLAG_GLIDING = dynamic(32);<a name="line.309"></a>
<span class="sourceLineNo">310</span>    public static final int DATA_FLAG_ELDER = dynamic(33);<a name="line.310"></a>
<span class="sourceLineNo">311</span>    public static final int DATA_FLAG_MOVING = dynamic(34);<a name="line.311"></a>
<span class="sourceLineNo">312</span>    public static final int DATA_FLAG_BREATHING = dynamic(35);<a name="line.312"></a>
<span class="sourceLineNo">313</span>    public static final int DATA_FLAG_CHESTED = dynamic(36);<a name="line.313"></a>
<span class="sourceLineNo">314</span>    public static final int DATA_FLAG_STACKABLE = dynamic(37);<a name="line.314"></a>
<span class="sourceLineNo">315</span>    public static final int DATA_FLAG_SHOWBASE = dynamic(38);<a name="line.315"></a>
<span class="sourceLineNo">316</span>    public static final int DATA_FLAG_REARING = dynamic(39);<a name="line.316"></a>
<span class="sourceLineNo">317</span>    public static final int DATA_FLAG_VIBRATING = dynamic(40);<a name="line.317"></a>
<span class="sourceLineNo">318</span>    public static final int DATA_FLAG_IDLING = dynamic(41);<a name="line.318"></a>
<span class="sourceLineNo">319</span>    public static final int DATA_FLAG_EVOKER_SPELL = dynamic(42);<a name="line.319"></a>
<span class="sourceLineNo">320</span>    public static final int DATA_FLAG_CHARGE_ATTACK = dynamic(43);<a name="line.320"></a>
<span class="sourceLineNo">321</span>    public static final int DATA_FLAG_WASD_CONTROLLED = dynamic(44);<a name="line.321"></a>
<span class="sourceLineNo">322</span>    public static final int DATA_FLAG_CAN_POWER_JUMP = dynamic(45);<a name="line.322"></a>
<span class="sourceLineNo">323</span>    public static final int DATA_FLAG_LINGER = dynamic(46);<a name="line.323"></a>
<span class="sourceLineNo">324</span>    public static final int DATA_FLAG_HAS_COLLISION = dynamic(47);<a name="line.324"></a>
<span class="sourceLineNo">325</span>    public static final int DATA_FLAG_GRAVITY = dynamic(48);<a name="line.325"></a>
<span class="sourceLineNo">326</span>    public static final int DATA_FLAG_FIRE_IMMUNE = dynamic(49);<a name="line.326"></a>
<span class="sourceLineNo">327</span>    public static final int DATA_FLAG_DANCING = dynamic(50);<a name="line.327"></a>
<span class="sourceLineNo">328</span>    public static final int DATA_FLAG_ENCHANTED = dynamic(51);<a name="line.328"></a>
<span class="sourceLineNo">329</span>    public static final int DATA_FLAG_SHOW_TRIDENT_ROPE = dynamic(52); // tridents show an animated rope when enchanted with loyalty after they are thrown and return to their owner. To be combined with DATA_OWNER_EID<a name="line.329"></a>
<span class="sourceLineNo">330</span>    public static final int DATA_FLAG_CONTAINER_PRIVATE = dynamic(53); //inventory is private, doesn't drop contents when killed if true<a name="line.330"></a>
<span class="sourceLineNo">331</span>    @Since("1.2.0.0-PN")<a name="line.331"></a>
<span class="sourceLineNo">332</span>    public static final int DATA_FLAG_IS_TRANSFORMING = dynamic(54);<a name="line.332"></a>
<span class="sourceLineNo">333</span>    public static final int DATA_FLAG_SPIN_ATTACK = dynamic(55);<a name="line.333"></a>
<span class="sourceLineNo">334</span>    public static final int DATA_FLAG_SWIMMING = dynamic(56);<a name="line.334"></a>
<span class="sourceLineNo">335</span>    public static final int DATA_FLAG_BRIBED = dynamic(57); //dolphins have this set when they go to find treasure for the player<a name="line.335"></a>
<span class="sourceLineNo">336</span>    public static final int DATA_FLAG_PREGNANT = dynamic(58);<a name="line.336"></a>
<span class="sourceLineNo">337</span>    public static final int DATA_FLAG_LAYING_EGG = dynamic(59);<a name="line.337"></a>
<span class="sourceLineNo">338</span>    @Since("1.2.0.0-PN")<a name="line.338"></a>
<span class="sourceLineNo">339</span>    public static final int DATA_FLAG_RIDER_CAN_PICK = dynamic(60);<a name="line.339"></a>
<span class="sourceLineNo">340</span>    @PowerNukkitOnly<a name="line.340"></a>
<span class="sourceLineNo">341</span>    @Since("1.2.0.0-PN")<a name="line.341"></a>
<span class="sourceLineNo">342</span>    public static final int DATA_FLAG_TRANSITION_SITTING = dynamic(61); // PowerNukkit but without typo<a name="line.342"></a>
<span class="sourceLineNo">343</span>    /**<a name="line.343"></a>
<span class="sourceLineNo">344</span>     * @deprecated This is from NukkitX but it has a typo which we can't remove unless NukkitX removes from their side.<a name="line.344"></a>
<span class="sourceLineNo">345</span>     * @see #DATA_FLAG_TRANSITION_SITTING<a name="line.345"></a>
<span class="sourceLineNo">346</span>     */<a name="line.346"></a>
<span class="sourceLineNo">347</span>    @Deprecated<a name="line.347"></a>
<span class="sourceLineNo">348</span>    @DeprecationDetails(reason = "This is from NukkitX but it has a typo which we can\'t remove unless NukkitX removes from their side.", since = "1.2.0.0-PN", replaceWith = "DATA_FLAG_TRANSITION_SITTING")<a name="line.348"></a>
<span class="sourceLineNo">349</span>    @Since("1.2.0.0-PN")<a name="line.349"></a>
<span class="sourceLineNo">350</span>    public static final int DATA_FLAG_TRANSITION_SETTING = DATA_FLAG_TRANSITION_SITTING; // NukkitX with the same typo<a name="line.350"></a>
<span class="sourceLineNo">351</span>    public static final int DATA_FLAG_EATING = dynamic(62);<a name="line.351"></a>
<span class="sourceLineNo">352</span>    public static final int DATA_FLAG_LAYING_DOWN = dynamic(63);<a name="line.352"></a>
<span class="sourceLineNo">353</span>    public static final int DATA_FLAG_SNEEZING = dynamic(64);<a name="line.353"></a>
<span class="sourceLineNo">354</span>    public static final int DATA_FLAG_TRUSTING = dynamic(65);<a name="line.354"></a>
<span class="sourceLineNo">355</span>    public static final int DATA_FLAG_ROLLING = dynamic(66);<a name="line.355"></a>
<span class="sourceLineNo">356</span>    public static final int DATA_FLAG_SCARED = dynamic(67);<a name="line.356"></a>
<span class="sourceLineNo">357</span>    public static final int DATA_FLAG_IN_SCAFFOLDING = dynamic(68);<a name="line.357"></a>
<span class="sourceLineNo">358</span>    public static final int DATA_FLAG_OVER_SCAFFOLDING = dynamic(69);<a name="line.358"></a>
<span class="sourceLineNo">359</span>    public static final int DATA_FLAG_FALL_THROUGH_SCAFFOLDING = dynamic(70);<a name="line.359"></a>
<span class="sourceLineNo">360</span>    public static final int DATA_FLAG_BLOCKING = dynamic(71); //shield<a name="line.360"></a>
<span class="sourceLineNo">361</span>    @Since("1.2.0.0-PN")<a name="line.361"></a>
<span class="sourceLineNo">362</span>    public static final int DATA_FLAG_TRANSITION_BLOCKING = dynamic(72);<a name="line.362"></a>
<span class="sourceLineNo">363</span>    @Since("1.2.0.0-PN")<a name="line.363"></a>
<span class="sourceLineNo">364</span>    public static final int DATA_FLAG_BLOCKED_USING_SHIELD = dynamic(73);<a name="line.364"></a>
<span class="sourceLineNo">365</span>    @Since("1.2.0.0-PN")<a name="line.365"></a>
<span class="sourceLineNo">366</span>    public static final int DATA_FLAG_BLOCKED_USING_DAMAGED_SHIELD = dynamic(74);<a name="line.366"></a>
<span class="sourceLineNo">367</span>    @Since("1.2.0.0-PN")<a name="line.367"></a>
<span class="sourceLineNo">368</span>    public static final int DATA_FLAG_SLEEPING = dynamic(75);<a name="line.368"></a>
<span class="sourceLineNo">369</span>    @Since("1.2.0.0-PN")<a name="line.369"></a>
<span class="sourceLineNo">370</span>    public static final int DATA_FLAG_WANTS_TO_WAKE = dynamic(76);<a name="line.370"></a>
<span class="sourceLineNo">371</span>    @Since("1.2.0.0-PN")<a name="line.371"></a>
<span class="sourceLineNo">372</span>    public static final int DATA_FLAG_TRADE_INTEREST = dynamic(77);<a name="line.372"></a>
<span class="sourceLineNo">373</span>    @Since("1.2.0.0-PN")<a name="line.373"></a>
<span class="sourceLineNo">374</span>    public static final int DATA_FLAG_DOOR_BREAKER = dynamic(78);<a name="line.374"></a>
<span class="sourceLineNo">375</span>    @Since("1.2.0.0-PN")<a name="line.375"></a>
<span class="sourceLineNo">376</span>    public static final int DATA_FLAG_BREAKING_OBSTRUCTION = dynamic(79);<a name="line.376"></a>
<span class="sourceLineNo">377</span>    @Since("1.2.0.0-PN")<a name="line.377"></a>
<span class="sourceLineNo">378</span>    public static final int DATA_FLAG_DOOR_OPENER = dynamic(80);<a name="line.378"></a>
<span class="sourceLineNo">379</span>    @Since("1.2.0.0-PN")<a name="line.379"></a>
<span class="sourceLineNo">380</span>    public static final int DATA_FLAG_IS_ILLAGER_CAPTAIN = dynamic(81);<a name="line.380"></a>
<span class="sourceLineNo">381</span>    @Since("1.2.0.0-PN")<a name="line.381"></a>
<span class="sourceLineNo">382</span>    public static final int DATA_FLAG_STUNNED = dynamic(82);<a name="line.382"></a>
<span class="sourceLineNo">383</span>    @Since("1.2.0.0-PN")<a name="line.383"></a>
<span class="sourceLineNo">384</span>    public static final int DATA_FLAG_ROARING = dynamic(83);<a name="line.384"></a>
<span class="sourceLineNo">385</span>    @Since("1.2.0.0-PN")<a name="line.385"></a>
<span class="sourceLineNo">386</span>    public static final int DATA_FLAG_DELAYED_ATTACK = dynamic(84);<a name="line.386"></a>
<span class="sourceLineNo">387</span>    @Since("1.2.0.0-PN")<a name="line.387"></a>
<span class="sourceLineNo">388</span>    public static final int DATA_FLAG_IS_AVOIDING_MOBS = dynamic(85);<a name="line.388"></a>
<span class="sourceLineNo">389</span>    @Since("1.3.0.0-PN")<a name="line.389"></a>
<span class="sourceLineNo">390</span>    public static final int DATA_FLAG_IS_AVOIDING_BLOCKS = dynamic(86);<a name="line.390"></a>
<span class="sourceLineNo">391</span>    @Since("1.2.0.0-PN")<a name="line.391"></a>
<span class="sourceLineNo">392</span>    public static final int DATA_FLAG_FACING_TARGET_TO_RANGE_ATTACK = dynamic(87);<a name="line.392"></a>
<span class="sourceLineNo">393</span>    @Since("1.2.0.0-PN")<a name="line.393"></a>
<span class="sourceLineNo">394</span>    public static final int DATA_FLAG_HIDDEN_WHEN_INVISIBLE = dynamic(88);<a name="line.394"></a>
<span class="sourceLineNo">395</span>    @Since("1.2.0.0-PN")<a name="line.395"></a>
<span class="sourceLineNo">396</span>    public static final int DATA_FLAG_IS_IN_UI = dynamic(89);<a name="line.396"></a>
<span class="sourceLineNo">397</span>    @Since("1.2.0.0-PN")<a name="line.397"></a>
<span class="sourceLineNo">398</span>    public static final int DATA_FLAG_STALKING = dynamic(90);<a name="line.398"></a>
<span class="sourceLineNo">399</span>    @Since("1.2.0.0-PN")<a name="line.399"></a>
<span class="sourceLineNo">400</span>    public static final int DATA_FLAG_EMOTING = dynamic(91);<a name="line.400"></a>
<span class="sourceLineNo">401</span>    @Since("1.2.0.0-PN")<a name="line.401"></a>
<span class="sourceLineNo">402</span>    public static final int DATA_FLAG_CELEBRATING = dynamic(92);<a name="line.402"></a>
<span class="sourceLineNo">403</span>    @Since("1.3.0.0-PN")<a name="line.403"></a>
<span class="sourceLineNo">404</span>    public static final int DATA_FLAG_ADMIRING = dynamic(93);<a name="line.404"></a>
<span class="sourceLineNo">405</span>    @Since("1.3.0.0-PN")<a name="line.405"></a>
<span class="sourceLineNo">406</span>    public static final int DATA_FLAG_CELEBRATING_SPECIAL = dynamic(94);<a name="line.406"></a>
<span class="sourceLineNo">407</span>    @Since("1.4.0.0-PN")<a name="line.407"></a>
<span class="sourceLineNo">408</span>    public static final int DATA_FLAG_RAM_ATTACK = dynamic(96);<a name="line.408"></a>
<span class="sourceLineNo">409</span>    @Since("1.5.0.0-PN")<a name="line.409"></a>
<span class="sourceLineNo">410</span>    @PowerNukkitOnly<a name="line.410"></a>
<span class="sourceLineNo">411</span>    public static final int DATA_FLAG_PLAYING_DEAD = dynamic(97);<a name="line.411"></a>
<span class="sourceLineNo">412</span>    public static long entityCount = 1;<a name="line.412"></a>
<span class="sourceLineNo">413</span>    private static final Map&lt;String, Class&lt;? extends Entity&gt;&gt; knownEntities = new HashMap&lt;&gt;();<a name="line.413"></a>
<span class="sourceLineNo">414</span>    private static final Map&lt;String, String&gt; shortNames = new HashMap&lt;&gt;();<a name="line.414"></a>
<span class="sourceLineNo">415</span>    protected final Map&lt;Integer, Player&gt; hasSpawned = new ConcurrentHashMap&lt;&gt;();<a name="line.415"></a>
<span class="sourceLineNo">416</span>    protected final Map&lt;Integer, Effect&gt; effects = new ConcurrentHashMap&lt;&gt;();<a name="line.416"></a>
<span class="sourceLineNo">417</span>    protected long id;<a name="line.417"></a>
<span class="sourceLineNo">418</span>    protected final EntityMetadata dataProperties = new EntityMetadata().putLong(DATA_FLAGS, 0).putByte(DATA_COLOR, 0).putShort(DATA_AIR, 400).putShort(DATA_MAX_AIR, 400).putString(DATA_NAMETAG, "").putLong(DATA_LEAD_HOLDER_EID, -1).putFloat(DATA_SCALE, 1.0F);<a name="line.418"></a>
<span class="sourceLineNo">419</span>    public final List&lt;Entity&gt; passengers = new ArrayList&lt;&gt;();<a name="line.419"></a>
<span class="sourceLineNo">420</span>    public Entity riding = null;<a name="line.420"></a>
<span class="sourceLineNo">421</span>    public FullChunk chunk;<a name="line.421"></a>
<span class="sourceLineNo">422</span>    protected EntityDamageEvent lastDamageCause = null;<a name="line.422"></a>
<span class="sourceLineNo">423</span>    public List&lt;Block&gt; blocksAround = new ArrayList&lt;&gt;();<a name="line.423"></a>
<span class="sourceLineNo">424</span>    public List&lt;Block&gt; collisionBlocks = new ArrayList&lt;&gt;();<a name="line.424"></a>
<span class="sourceLineNo">425</span>    public double lastX;<a name="line.425"></a>
<span class="sourceLineNo">426</span>    public double lastY;<a name="line.426"></a>
<span class="sourceLineNo">427</span>    public double lastZ;<a name="line.427"></a>
<span class="sourceLineNo">428</span>    public boolean firstMove = true;<a name="line.428"></a>
<span class="sourceLineNo">429</span>    public double motionX;<a name="line.429"></a>
<span class="sourceLineNo">430</span>    public double motionY;<a name="line.430"></a>
<span class="sourceLineNo">431</span>    public double motionZ;<a name="line.431"></a>
<span class="sourceLineNo">432</span>    public Vector3 temporalVector;<a name="line.432"></a>
<span class="sourceLineNo">433</span>    public double lastMotionX;<a name="line.433"></a>
<span class="sourceLineNo">434</span>    public double lastMotionY;<a name="line.434"></a>
<span class="sourceLineNo">435</span>    public double lastMotionZ;<a name="line.435"></a>
<span class="sourceLineNo">436</span>    public double lastYaw;<a name="line.436"></a>
<span class="sourceLineNo">437</span>    public double lastPitch;<a name="line.437"></a>
<span class="sourceLineNo">438</span>    public double pitchDelta;<a name="line.438"></a>
<span class="sourceLineNo">439</span>    public double yawDelta;<a name="line.439"></a>
<span class="sourceLineNo">440</span>    public double entityCollisionReduction = 0; // Higher than 0.9 will result a fast collisions<a name="line.440"></a>
<span class="sourceLineNo">441</span>    public AxisAlignedBB boundingBox;<a name="line.441"></a>
<span class="sourceLineNo">442</span>    public boolean onGround;<a name="line.442"></a>
<span class="sourceLineNo">443</span>    public boolean inBlock = false;<a name="line.443"></a>
<span class="sourceLineNo">444</span>    public boolean positionChanged;<a name="line.444"></a>
<span class="sourceLineNo">445</span>    public boolean motionChanged;<a name="line.445"></a>
<span class="sourceLineNo">446</span>    public int deadTicks = 0;<a name="line.446"></a>
<span class="sourceLineNo">447</span>    protected int age = 0;<a name="line.447"></a>
<span class="sourceLineNo">448</span>    protected float health = 20;<a name="line.448"></a>
<span class="sourceLineNo">449</span>    private int maxHealth = 20;<a name="line.449"></a>
<span class="sourceLineNo">450</span>    protected float absorption = 0;<a name="line.450"></a>
<span class="sourceLineNo">451</span>    protected float ySize = 0;<a name="line.451"></a>
<span class="sourceLineNo">452</span>    public boolean keepMovement = false;<a name="line.452"></a>
<span class="sourceLineNo">453</span>    public float fallDistance = 0;<a name="line.453"></a>
<span class="sourceLineNo">454</span>    public int ticksLived = 0;<a name="line.454"></a>
<span class="sourceLineNo">455</span>    public int lastUpdate;<a name="line.455"></a>
<span class="sourceLineNo">456</span>    public int maxFireTicks;<a name="line.456"></a>
<span class="sourceLineNo">457</span>    public int fireTicks = 0;<a name="line.457"></a>
<span class="sourceLineNo">458</span>    public int inPortalTicks = 0;<a name="line.458"></a>
<span class="sourceLineNo">459</span>    @PowerNukkitOnly<a name="line.459"></a>
<span class="sourceLineNo">460</span>    @Since("1.2.1.0-PN")<a name="line.460"></a>
<span class="sourceLineNo">461</span>    protected boolean inEndPortal;<a name="line.461"></a>
<span class="sourceLineNo">462</span>    public float scale = 1;<a name="line.462"></a>
<span class="sourceLineNo">463</span>    public CompoundTag namedTag;<a name="line.463"></a>
<span class="sourceLineNo">464</span>    protected boolean isStatic = false;<a name="line.464"></a>
<span class="sourceLineNo">465</span>    public boolean isCollided = false;<a name="line.465"></a>
<span class="sourceLineNo">466</span>    public boolean isCollidedHorizontally = false;<a name="line.466"></a>
<span class="sourceLineNo">467</span>    public boolean isCollidedVertically = false;<a name="line.467"></a>
<span class="sourceLineNo">468</span>    public int noDamageTicks;<a name="line.468"></a>
<span class="sourceLineNo">469</span>    public boolean justCreated;<a name="line.469"></a>
<span class="sourceLineNo">470</span>    public boolean fireProof;<a name="line.470"></a>
<span class="sourceLineNo">471</span>    public boolean invulnerable;<a name="line.471"></a>
<span class="sourceLineNo">472</span>    protected Server server;<a name="line.472"></a>
<span class="sourceLineNo">473</span>    public double highestPosition;<a name="line.473"></a>
<span class="sourceLineNo">474</span>    public boolean closed = false;<a name="line.474"></a>
<span class="sourceLineNo">475</span>    protected Timing timing;<a name="line.475"></a>
<span class="sourceLineNo">476</span>    protected boolean isPlayer = false;<a name="line.476"></a>
<span class="sourceLineNo">477</span>    private volatile boolean initialized;<a name="line.477"></a>
<span class="sourceLineNo">478</span>    @PowerNukkitOnly<a name="line.478"></a>
<span class="sourceLineNo">479</span>    @Since("1.4.0.0-PN")<a name="line.479"></a>
<span class="sourceLineNo">480</span>    public boolean noClip = false;<a name="line.480"></a>
<span class="sourceLineNo">481</span><a name="line.481"></a>
<span class="sourceLineNo">482</span>    public float getHeight() {<a name="line.482"></a>
<span class="sourceLineNo">483</span>        return 0;<a name="line.483"></a>
<span class="sourceLineNo">484</span>    }<a name="line.484"></a>
<span class="sourceLineNo">485</span><a name="line.485"></a>
<span class="sourceLineNo">486</span>    @PowerNukkitOnly<a name="line.486"></a>
<span class="sourceLineNo">487</span>    @Since("1.5.1.0-PN")<a name="line.487"></a>
<span class="sourceLineNo">488</span>    public float getCurrentHeight() {<a name="line.488"></a>
<span class="sourceLineNo">489</span>        if (isSwimming()) {<a name="line.489"></a>
<span class="sourceLineNo">490</span>            return getSwimmingHeight();<a name="line.490"></a>
<span class="sourceLineNo">491</span>        } else {<a name="line.491"></a>
<span class="sourceLineNo">492</span>            return getHeight();<a name="line.492"></a>
<span class="sourceLineNo">493</span>        }<a name="line.493"></a>
<span class="sourceLineNo">494</span>    }<a name="line.494"></a>
<span class="sourceLineNo">495</span><a name="line.495"></a>
<span class="sourceLineNo">496</span>    public float getEyeHeight() {<a name="line.496"></a>
<span class="sourceLineNo">497</span>        return getCurrentHeight() / 2 + 0.1F;<a name="line.497"></a>
<span class="sourceLineNo">498</span>    }<a name="line.498"></a>
<span class="sourceLineNo">499</span><a name="line.499"></a>
<span class="sourceLineNo">500</span>    public float getWidth() {<a name="line.500"></a>
<span class="sourceLineNo">501</span>        return 0;<a name="line.501"></a>
<span class="sourceLineNo">502</span>    }<a name="line.502"></a>
<span class="sourceLineNo">503</span><a name="line.503"></a>
<span class="sourceLineNo">504</span>    public float getLength() {<a name="line.504"></a>
<span class="sourceLineNo">505</span>        return 0;<a name="line.505"></a>
<span class="sourceLineNo">506</span>    }<a name="line.506"></a>
<span class="sourceLineNo">507</span><a name="line.507"></a>
<span class="sourceLineNo">508</span>    protected double getStepHeight() {<a name="line.508"></a>
<span class="sourceLineNo">509</span>        return 0;<a name="line.509"></a>
<span class="sourceLineNo">510</span>    }<a name="line.510"></a>
<span class="sourceLineNo">511</span><a name="line.511"></a>
<span class="sourceLineNo">512</span>    public boolean canCollide() {<a name="line.512"></a>
<span class="sourceLineNo">513</span>        return true;<a name="line.513"></a>
<span class="sourceLineNo">514</span>    }<a name="line.514"></a>
<span class="sourceLineNo">515</span><a name="line.515"></a>
<span class="sourceLineNo">516</span>    protected float getGravity() {<a name="line.516"></a>
<span class="sourceLineNo">517</span>        return 0;<a name="line.517"></a>
<span class="sourceLineNo">518</span>    }<a name="line.518"></a>
<span class="sourceLineNo">519</span><a name="line.519"></a>
<span class="sourceLineNo">520</span>    protected float getDrag() {<a name="line.520"></a>
<span class="sourceLineNo">521</span>        return 0;<a name="line.521"></a>
<span class="sourceLineNo">522</span>    }<a name="line.522"></a>
<span class="sourceLineNo">523</span><a name="line.523"></a>
<span class="sourceLineNo">524</span>    protected float getBaseOffset() {<a name="line.524"></a>
<span class="sourceLineNo">525</span>        return 0;<a name="line.525"></a>
<span class="sourceLineNo">526</span>    }<a name="line.526"></a>
<span class="sourceLineNo">527</span><a name="line.527"></a>
<span class="sourceLineNo">528</span>    public Entity(FullChunk chunk, CompoundTag nbt) {<a name="line.528"></a>
<span class="sourceLineNo">529</span>        if (this instanceof Player) {<a name="line.529"></a>
<span class="sourceLineNo">530</span>            return;<a name="line.530"></a>
<span class="sourceLineNo">531</span>        }<a name="line.531"></a>
<span class="sourceLineNo">532</span>        this.init(chunk, nbt);<a name="line.532"></a>
<span class="sourceLineNo">533</span>    }<a name="line.533"></a>
<span class="sourceLineNo">534</span><a name="line.534"></a>
<span class="sourceLineNo">535</span>    protected void initEntity() {<a name="line.535"></a>
<span class="sourceLineNo">536</span>        if (this.namedTag.contains("ActiveEffects")) {<a name="line.536"></a>
<span class="sourceLineNo">537</span>            ListTag&lt;CompoundTag&gt; effects = this.namedTag.getList("ActiveEffects", CompoundTag.class);<a name="line.537"></a>
<span class="sourceLineNo">538</span>            for (CompoundTag e : effects.getAll()) {<a name="line.538"></a>
<span class="sourceLineNo">539</span>                Effect effect = Effect.getEffect(e.getByte("Id"));<a name="line.539"></a>
<span class="sourceLineNo">540</span>                if (effect == null) {<a name="line.540"></a>
<span class="sourceLineNo">541</span>                    continue;<a name="line.541"></a>
<span class="sourceLineNo">542</span>                }<a name="line.542"></a>
<span class="sourceLineNo">543</span>                effect.setAmplifier(e.getByte("Amplifier")).setDuration(e.getInt("Duration")).setVisible(e.getBoolean("ShowParticles"));<a name="line.543"></a>
<span class="sourceLineNo">544</span>                this.addEffect(effect);<a name="line.544"></a>
<span class="sourceLineNo">545</span>            }<a name="line.545"></a>
<span class="sourceLineNo">546</span>        }<a name="line.546"></a>
<span class="sourceLineNo">547</span>        if (this.namedTag.contains("CustomName")) {<a name="line.547"></a>
<span class="sourceLineNo">548</span>            this.setNameTag(this.namedTag.getString("CustomName"));<a name="line.548"></a>
<span class="sourceLineNo">549</span>            if (this.namedTag.contains("CustomNameVisible")) {<a name="line.549"></a>
<span class="sourceLineNo">550</span>                this.setNameTagVisible(this.namedTag.getBoolean("CustomNameVisible"));<a name="line.550"></a>
<span class="sourceLineNo">551</span>            }<a name="line.551"></a>
<span class="sourceLineNo">552</span>            if (this.namedTag.contains("CustomNameAlwaysVisible")) {<a name="line.552"></a>
<span class="sourceLineNo">553</span>                this.setNameTagAlwaysVisible(this.namedTag.getBoolean("CustomNameAlwaysVisible"));<a name="line.553"></a>
<span class="sourceLineNo">554</span>            }<a name="line.554"></a>
<span class="sourceLineNo">555</span>        }<a name="line.555"></a>
<span class="sourceLineNo">556</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_HAS_COLLISION, true);<a name="line.556"></a>
<span class="sourceLineNo">557</span>        this.dataProperties.putFloat(DATA_BOUNDING_BOX_HEIGHT, this.getHeight());<a name="line.557"></a>
<span class="sourceLineNo">558</span>        this.dataProperties.putFloat(DATA_BOUNDING_BOX_WIDTH, this.getWidth());<a name="line.558"></a>
<span class="sourceLineNo">559</span>        this.dataProperties.putInt(DATA_HEALTH, (int) this.getHealth());<a name="line.559"></a>
<span class="sourceLineNo">560</span>        this.scheduleUpdate();<a name="line.560"></a>
<span class="sourceLineNo">561</span>    }<a name="line.561"></a>
<span class="sourceLineNo">562</span><a name="line.562"></a>
<span class="sourceLineNo">563</span>    protected final void init(FullChunk chunk, CompoundTag nbt) {<a name="line.563"></a>
<span class="sourceLineNo">564</span>        if ((chunk == null || chunk.getProvider() == null)) {<a name="line.564"></a>
<span class="sourceLineNo">565</span>            throw new ChunkException("Invalid garbage Chunk given to Entity");<a name="line.565"></a>
<span class="sourceLineNo">566</span>        }<a name="line.566"></a>
<span class="sourceLineNo">567</span>        if (this.initialized) {<a name="line.567"></a>
<span class="sourceLineNo">568</span>            // We've already initialized this entity<a name="line.568"></a>
<span class="sourceLineNo">569</span>            return;<a name="line.569"></a>
<span class="sourceLineNo">570</span>        }<a name="line.570"></a>
<span class="sourceLineNo">571</span>        this.initialized = true;<a name="line.571"></a>
<span class="sourceLineNo">572</span>        this.timing = Timings.getEntityTiming(this);<a name="line.572"></a>
<span class="sourceLineNo">573</span>        this.isPlayer = this instanceof Player;<a name="line.573"></a>
<span class="sourceLineNo">574</span>        this.temporalVector = new Vector3();<a name="line.574"></a>
<span class="sourceLineNo">575</span>        this.id = Entity.entityCount++;<a name="line.575"></a>
<span class="sourceLineNo">576</span>        this.justCreated = true;<a name="line.576"></a>
<span class="sourceLineNo">577</span>        this.namedTag = nbt;<a name="line.577"></a>
<span class="sourceLineNo">578</span>        this.chunk = chunk;<a name="line.578"></a>
<span class="sourceLineNo">579</span>        this.setLevel(chunk.getProvider().getLevel());<a name="line.579"></a>
<span class="sourceLineNo">580</span>        this.server = chunk.getProvider().getLevel().getServer();<a name="line.580"></a>
<span class="sourceLineNo">581</span>        this.boundingBox = new SimpleAxisAlignedBB(0, 0, 0, 0, 0, 0);<a name="line.581"></a>
<span class="sourceLineNo">582</span>        ListTag&lt;DoubleTag&gt; posList = this.namedTag.getList("Pos", DoubleTag.class);<a name="line.582"></a>
<span class="sourceLineNo">583</span>        ListTag&lt;FloatTag&gt; rotationList = this.namedTag.getList("Rotation", FloatTag.class);<a name="line.583"></a>
<span class="sourceLineNo">584</span>        ListTag&lt;DoubleTag&gt; motionList = this.namedTag.getList("Motion", DoubleTag.class);<a name="line.584"></a>
<span class="sourceLineNo">585</span>        this.setPositionAndRotation(this.temporalVector.setComponents(posList.get(0).data, posList.get(1).data, posList.get(2).data), rotationList.get(0).data, rotationList.get(1).data);<a name="line.585"></a>
<span class="sourceLineNo">586</span>        this.setMotion(this.temporalVector.setComponents(motionList.get(0).data, motionList.get(1).data, motionList.get(2).data));<a name="line.586"></a>
<span class="sourceLineNo">587</span>        if (!this.namedTag.contains("FallDistance")) {<a name="line.587"></a>
<span class="sourceLineNo">588</span>            this.namedTag.putFloat("FallDistance", 0);<a name="line.588"></a>
<span class="sourceLineNo">589</span>        }<a name="line.589"></a>
<span class="sourceLineNo">590</span>        this.fallDistance = this.namedTag.getFloat("FallDistance");<a name="line.590"></a>
<span class="sourceLineNo">591</span>        this.highestPosition = this.y + this.namedTag.getFloat("FallDistance");<a name="line.591"></a>
<span class="sourceLineNo">592</span>        if (!this.namedTag.contains("Fire") || this.namedTag.getShort("Fire") &gt; 32767) {<a name="line.592"></a>
<span class="sourceLineNo">593</span>            this.namedTag.putShort("Fire", 0);<a name="line.593"></a>
<span class="sourceLineNo">594</span>        }<a name="line.594"></a>
<span class="sourceLineNo">595</span>        this.fireTicks = this.namedTag.getShort("Fire");<a name="line.595"></a>
<span class="sourceLineNo">596</span>        if (!this.namedTag.contains("Air")) {<a name="line.596"></a>
<span class="sourceLineNo">597</span>            this.namedTag.putShort("Air", 300);<a name="line.597"></a>
<span class="sourceLineNo">598</span>        }<a name="line.598"></a>
<span class="sourceLineNo">599</span>        this.setDataProperty(new ShortEntityData(DATA_AIR, this.namedTag.getShort("Air")), false);<a name="line.599"></a>
<span class="sourceLineNo">600</span>        if (!this.namedTag.contains("OnGround")) {<a name="line.600"></a>
<span class="sourceLineNo">601</span>            this.namedTag.putBoolean("OnGround", false);<a name="line.601"></a>
<span class="sourceLineNo">602</span>        }<a name="line.602"></a>
<span class="sourceLineNo">603</span>        this.onGround = this.namedTag.getBoolean("OnGround");<a name="line.603"></a>
<span class="sourceLineNo">604</span>        if (!this.namedTag.contains("Invulnerable")) {<a name="line.604"></a>
<span class="sourceLineNo">605</span>            this.namedTag.putBoolean("Invulnerable", false);<a name="line.605"></a>
<span class="sourceLineNo">606</span>        }<a name="line.606"></a>
<span class="sourceLineNo">607</span>        this.invulnerable = this.namedTag.getBoolean("Invulnerable");<a name="line.607"></a>
<span class="sourceLineNo">608</span>        if (!this.namedTag.contains("Scale")) {<a name="line.608"></a>
<span class="sourceLineNo">609</span>            this.namedTag.putFloat("Scale", 1);<a name="line.609"></a>
<span class="sourceLineNo">610</span>        }<a name="line.610"></a>
<span class="sourceLineNo">611</span>        this.scale = this.namedTag.getFloat("Scale");<a name="line.611"></a>
<span class="sourceLineNo">612</span>        this.setDataProperty(new FloatEntityData(DATA_SCALE, scale), false);<a name="line.612"></a>
<span class="sourceLineNo">613</span>        this.setDataProperty(new ByteEntityData(DATA_COLOR, 0), false);<a name="line.613"></a>
<span class="sourceLineNo">614</span>        try {<a name="line.614"></a>
<span class="sourceLineNo">615</span>            this.chunk.addEntity(this);<a name="line.615"></a>
<span class="sourceLineNo">616</span>            this.level.addEntity(this);<a name="line.616"></a>
<span class="sourceLineNo">617</span>            this.initEntity();<a name="line.617"></a>
<span class="sourceLineNo">618</span>            this.lastUpdate = this.server.getTick();<a name="line.618"></a>
<span class="sourceLineNo">619</span>            EntitySpawnEvent event = new EntitySpawnEvent(this);<a name="line.619"></a>
<span class="sourceLineNo">620</span>            this.server.getPluginManager().callEvent(event);<a name="line.620"></a>
<span class="sourceLineNo">621</span>            if (event.isCancelled()) {<a name="line.621"></a>
<span class="sourceLineNo">622</span>                this.close(false);<a name="line.622"></a>
<span class="sourceLineNo">623</span>            } else {<a name="line.623"></a>
<span class="sourceLineNo">624</span>                this.scheduleUpdate();<a name="line.624"></a>
<span class="sourceLineNo">625</span>            }<a name="line.625"></a>
<span class="sourceLineNo">626</span>        } catch (Exception e) {<a name="line.626"></a>
<span class="sourceLineNo">627</span>            this.close(false);<a name="line.627"></a>
<span class="sourceLineNo">628</span>            throw e;<a name="line.628"></a>
<span class="sourceLineNo">629</span>        }<a name="line.629"></a>
<span class="sourceLineNo">630</span>    }<a name="line.630"></a>
<span class="sourceLineNo">631</span><a name="line.631"></a>
<span class="sourceLineNo">632</span>    public boolean hasCustomName() {<a name="line.632"></a>
<span class="sourceLineNo">633</span>        return !this.getNameTag().isEmpty();<a name="line.633"></a>
<span class="sourceLineNo">634</span>    }<a name="line.634"></a>
<span class="sourceLineNo">635</span><a name="line.635"></a>
<span class="sourceLineNo">636</span>    public String getNameTag() {<a name="line.636"></a>
<span class="sourceLineNo">637</span>        return this.getDataPropertyString(DATA_NAMETAG);<a name="line.637"></a>
<span class="sourceLineNo">638</span>    }<a name="line.638"></a>
<span class="sourceLineNo">639</span><a name="line.639"></a>
<span class="sourceLineNo">640</span>    public boolean isNameTagVisible() {<a name="line.640"></a>
<span class="sourceLineNo">641</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_CAN_SHOW_NAMETAG);<a name="line.641"></a>
<span class="sourceLineNo">642</span>    }<a name="line.642"></a>
<span class="sourceLineNo">643</span><a name="line.643"></a>
<span class="sourceLineNo">644</span>    public boolean isNameTagAlwaysVisible() {<a name="line.644"></a>
<span class="sourceLineNo">645</span>        return this.getDataPropertyByte(DATA_ALWAYS_SHOW_NAMETAG) == 1;<a name="line.645"></a>
<span class="sourceLineNo">646</span>    }<a name="line.646"></a>
<span class="sourceLineNo">647</span><a name="line.647"></a>
<span class="sourceLineNo">648</span>    public void setNameTag(String name) {<a name="line.648"></a>
<span class="sourceLineNo">649</span>        this.setDataProperty(new StringEntityData(DATA_NAMETAG, name));<a name="line.649"></a>
<span class="sourceLineNo">650</span>    }<a name="line.650"></a>
<span class="sourceLineNo">651</span><a name="line.651"></a>
<span class="sourceLineNo">652</span>    public void setNameTagVisible() {<a name="line.652"></a>
<span class="sourceLineNo">653</span>        this.setNameTagVisible(true);<a name="line.653"></a>
<span class="sourceLineNo">654</span>    }<a name="line.654"></a>
<span class="sourceLineNo">655</span><a name="line.655"></a>
<span class="sourceLineNo">656</span>    public void setNameTagVisible(boolean value) {<a name="line.656"></a>
<span class="sourceLineNo">657</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_CAN_SHOW_NAMETAG, value);<a name="line.657"></a>
<span class="sourceLineNo">658</span>    }<a name="line.658"></a>
<span class="sourceLineNo">659</span><a name="line.659"></a>
<span class="sourceLineNo">660</span>    public void setNameTagAlwaysVisible() {<a name="line.660"></a>
<span class="sourceLineNo">661</span>        this.setNameTagAlwaysVisible(true);<a name="line.661"></a>
<span class="sourceLineNo">662</span>    }<a name="line.662"></a>
<span class="sourceLineNo">663</span><a name="line.663"></a>
<span class="sourceLineNo">664</span>    public void setNameTagAlwaysVisible(boolean value) {<a name="line.664"></a>
<span class="sourceLineNo">665</span>        this.setDataProperty(new ByteEntityData(DATA_ALWAYS_SHOW_NAMETAG, value ? 1 : 0));<a name="line.665"></a>
<span class="sourceLineNo">666</span>    }<a name="line.666"></a>
<span class="sourceLineNo">667</span><a name="line.667"></a>
<span class="sourceLineNo">668</span>    public void setScoreTag(String score) {<a name="line.668"></a>
<span class="sourceLineNo">669</span>        this.setDataProperty(new StringEntityData(DATA_SCORE_TAG, score));<a name="line.669"></a>
<span class="sourceLineNo">670</span>    }<a name="line.670"></a>
<span class="sourceLineNo">671</span><a name="line.671"></a>
<span class="sourceLineNo">672</span>    public String getScoreTag() {<a name="line.672"></a>
<span class="sourceLineNo">673</span>        return this.getDataPropertyString(DATA_SCORE_TAG);<a name="line.673"></a>
<span class="sourceLineNo">674</span>    }<a name="line.674"></a>
<span class="sourceLineNo">675</span><a name="line.675"></a>
<span class="sourceLineNo">676</span>    public boolean isSneaking() {<a name="line.676"></a>
<span class="sourceLineNo">677</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_SNEAKING);<a name="line.677"></a>
<span class="sourceLineNo">678</span>    }<a name="line.678"></a>
<span class="sourceLineNo">679</span><a name="line.679"></a>
<span class="sourceLineNo">680</span>    public void setSneaking() {<a name="line.680"></a>
<span class="sourceLineNo">681</span>        this.setSneaking(true);<a name="line.681"></a>
<span class="sourceLineNo">682</span>    }<a name="line.682"></a>
<span class="sourceLineNo">683</span><a name="line.683"></a>
<span class="sourceLineNo">684</span>    public void setSneaking(boolean value) {<a name="line.684"></a>
<span class="sourceLineNo">685</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_SNEAKING, value);<a name="line.685"></a>
<span class="sourceLineNo">686</span>    }<a name="line.686"></a>
<span class="sourceLineNo">687</span><a name="line.687"></a>
<span class="sourceLineNo">688</span>    public boolean isSwimming() {<a name="line.688"></a>
<span class="sourceLineNo">689</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_SWIMMING);<a name="line.689"></a>
<span class="sourceLineNo">690</span>    }<a name="line.690"></a>
<span class="sourceLineNo">691</span><a name="line.691"></a>
<span class="sourceLineNo">692</span>    @PowerNukkitOnly<a name="line.692"></a>
<span class="sourceLineNo">693</span>    @Since("1.5.1.0-PN")<a name="line.693"></a>
<span class="sourceLineNo">694</span>    public float getSwimmingHeight() {<a name="line.694"></a>
<span class="sourceLineNo">695</span>        return getHeight();<a name="line.695"></a>
<span class="sourceLineNo">696</span>    }<a name="line.696"></a>
<span class="sourceLineNo">697</span><a name="line.697"></a>
<span class="sourceLineNo">698</span>    public void setSwimming() {<a name="line.698"></a>
<span class="sourceLineNo">699</span>        this.setSwimming(true);<a name="line.699"></a>
<span class="sourceLineNo">700</span>    }<a name="line.700"></a>
<span class="sourceLineNo">701</span><a name="line.701"></a>
<span class="sourceLineNo">702</span>    public void setSwimming(boolean value) {<a name="line.702"></a>
<span class="sourceLineNo">703</span>        if (isSwimming() == value) {<a name="line.703"></a>
<span class="sourceLineNo">704</span>            return;<a name="line.704"></a>
<span class="sourceLineNo">705</span>        }<a name="line.705"></a>
<span class="sourceLineNo">706</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_SWIMMING, value);<a name="line.706"></a>
<span class="sourceLineNo">707</span>        if (Float.compare(getSwimmingHeight(), getHeight()) != 0) {<a name="line.707"></a>
<span class="sourceLineNo">708</span>            recalculateBoundingBox(true);<a name="line.708"></a>
<span class="sourceLineNo">709</span>        }<a name="line.709"></a>
<span class="sourceLineNo">710</span>    }<a name="line.710"></a>
<span class="sourceLineNo">711</span><a name="line.711"></a>
<span class="sourceLineNo">712</span>    public boolean isSprinting() {<a name="line.712"></a>
<span class="sourceLineNo">713</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_SPRINTING);<a name="line.713"></a>
<span class="sourceLineNo">714</span>    }<a name="line.714"></a>
<span class="sourceLineNo">715</span><a name="line.715"></a>
<span class="sourceLineNo">716</span>    public void setSprinting() {<a name="line.716"></a>
<span class="sourceLineNo">717</span>        this.setSprinting(true);<a name="line.717"></a>
<span class="sourceLineNo">718</span>    }<a name="line.718"></a>
<span class="sourceLineNo">719</span><a name="line.719"></a>
<span class="sourceLineNo">720</span>    public void setSprinting(boolean value) {<a name="line.720"></a>
<span class="sourceLineNo">721</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_SPRINTING, value);<a name="line.721"></a>
<span class="sourceLineNo">722</span>    }<a name="line.722"></a>
<span class="sourceLineNo">723</span><a name="line.723"></a>
<span class="sourceLineNo">724</span>    public boolean isGliding() {<a name="line.724"></a>
<span class="sourceLineNo">725</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_GLIDING);<a name="line.725"></a>
<span class="sourceLineNo">726</span>    }<a name="line.726"></a>
<span class="sourceLineNo">727</span><a name="line.727"></a>
<span class="sourceLineNo">728</span>    public void setGliding() {<a name="line.728"></a>
<span class="sourceLineNo">729</span>        this.setGliding(true);<a name="line.729"></a>
<span class="sourceLineNo">730</span>    }<a name="line.730"></a>
<span class="sourceLineNo">731</span><a name="line.731"></a>
<span class="sourceLineNo">732</span>    public void setGliding(boolean value) {<a name="line.732"></a>
<span class="sourceLineNo">733</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_GLIDING, value);<a name="line.733"></a>
<span class="sourceLineNo">734</span>    }<a name="line.734"></a>
<span class="sourceLineNo">735</span><a name="line.735"></a>
<span class="sourceLineNo">736</span>    public boolean isImmobile() {<a name="line.736"></a>
<span class="sourceLineNo">737</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_IMMOBILE);<a name="line.737"></a>
<span class="sourceLineNo">738</span>    }<a name="line.738"></a>
<span class="sourceLineNo">739</span><a name="line.739"></a>
<span class="sourceLineNo">740</span>    public void setImmobile() {<a name="line.740"></a>
<span class="sourceLineNo">741</span>        this.setImmobile(true);<a name="line.741"></a>
<span class="sourceLineNo">742</span>    }<a name="line.742"></a>
<span class="sourceLineNo">743</span><a name="line.743"></a>
<span class="sourceLineNo">744</span>    public void setImmobile(boolean value) {<a name="line.744"></a>
<span class="sourceLineNo">745</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_IMMOBILE, value);<a name="line.745"></a>
<span class="sourceLineNo">746</span>    }<a name="line.746"></a>
<span class="sourceLineNo">747</span><a name="line.747"></a>
<span class="sourceLineNo">748</span>    public boolean canClimb() {<a name="line.748"></a>
<span class="sourceLineNo">749</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_CAN_CLIMB);<a name="line.749"></a>
<span class="sourceLineNo">750</span>    }<a name="line.750"></a>
<span class="sourceLineNo">751</span><a name="line.751"></a>
<span class="sourceLineNo">752</span>    public void setCanClimb() {<a name="line.752"></a>
<span class="sourceLineNo">753</span>        this.setCanClimb(true);<a name="line.753"></a>
<span class="sourceLineNo">754</span>    }<a name="line.754"></a>
<span class="sourceLineNo">755</span><a name="line.755"></a>
<span class="sourceLineNo">756</span>    public void setCanClimb(boolean value) {<a name="line.756"></a>
<span class="sourceLineNo">757</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_CAN_CLIMB, value);<a name="line.757"></a>
<span class="sourceLineNo">758</span>    }<a name="line.758"></a>
<span class="sourceLineNo">759</span><a name="line.759"></a>
<span class="sourceLineNo">760</span>    public boolean canClimbWalls() {<a name="line.760"></a>
<span class="sourceLineNo">761</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_WALLCLIMBING);<a name="line.761"></a>
<span class="sourceLineNo">762</span>    }<a name="line.762"></a>
<span class="sourceLineNo">763</span><a name="line.763"></a>
<span class="sourceLineNo">764</span>    public void setCanClimbWalls() {<a name="line.764"></a>
<span class="sourceLineNo">765</span>        this.setCanClimbWalls(true);<a name="line.765"></a>
<span class="sourceLineNo">766</span>    }<a name="line.766"></a>
<span class="sourceLineNo">767</span><a name="line.767"></a>
<span class="sourceLineNo">768</span>    public void setCanClimbWalls(boolean value) {<a name="line.768"></a>
<span class="sourceLineNo">769</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_WALLCLIMBING, value);<a name="line.769"></a>
<span class="sourceLineNo">770</span>    }<a name="line.770"></a>
<span class="sourceLineNo">771</span><a name="line.771"></a>
<span class="sourceLineNo">772</span>    public void setScale(float scale) {<a name="line.772"></a>
<span class="sourceLineNo">773</span>        this.scale = scale;<a name="line.773"></a>
<span class="sourceLineNo">774</span>        this.setDataProperty(new FloatEntityData(DATA_SCALE, this.scale));<a name="line.774"></a>
<span class="sourceLineNo">775</span>        this.recalculateBoundingBox();<a name="line.775"></a>
<span class="sourceLineNo">776</span>    }<a name="line.776"></a>
<span class="sourceLineNo">777</span><a name="line.777"></a>
<span class="sourceLineNo">778</span>    public float getScale() {<a name="line.778"></a>
<span class="sourceLineNo">779</span>        return this.scale;<a name="line.779"></a>
<span class="sourceLineNo">780</span>    }<a name="line.780"></a>
<span class="sourceLineNo">781</span><a name="line.781"></a>
<span class="sourceLineNo">782</span>    public List&lt;Entity&gt; getPassengers() {<a name="line.782"></a>
<span class="sourceLineNo">783</span>        return passengers;<a name="line.783"></a>
<span class="sourceLineNo">784</span>    }<a name="line.784"></a>
<span class="sourceLineNo">785</span><a name="line.785"></a>
<span class="sourceLineNo">786</span>    public Entity getPassenger() {<a name="line.786"></a>
<span class="sourceLineNo">787</span>        return Iterables.getFirst(this.passengers, null);<a name="line.787"></a>
<span class="sourceLineNo">788</span>    }<a name="line.788"></a>
<span class="sourceLineNo">789</span><a name="line.789"></a>
<span class="sourceLineNo">790</span>    public boolean isPassenger(Entity entity) {<a name="line.790"></a>
<span class="sourceLineNo">791</span>        return this.passengers.contains(entity);<a name="line.791"></a>
<span class="sourceLineNo">792</span>    }<a name="line.792"></a>
<span class="sourceLineNo">793</span><a name="line.793"></a>
<span class="sourceLineNo">794</span>    public boolean isControlling(Entity entity) {<a name="line.794"></a>
<span class="sourceLineNo">795</span>        return this.passengers.indexOf(entity) == 0;<a name="line.795"></a>
<span class="sourceLineNo">796</span>    }<a name="line.796"></a>
<span class="sourceLineNo">797</span><a name="line.797"></a>
<span class="sourceLineNo">798</span>    public boolean hasControllingPassenger() {<a name="line.798"></a>
<span class="sourceLineNo">799</span>        return !this.passengers.isEmpty() &amp;&amp; isControlling(this.passengers.get(0));<a name="line.799"></a>
<span class="sourceLineNo">800</span>    }<a name="line.800"></a>
<span class="sourceLineNo">801</span><a name="line.801"></a>
<span class="sourceLineNo">802</span>    public Entity getRiding() {<a name="line.802"></a>
<span class="sourceLineNo">803</span>        return riding;<a name="line.803"></a>
<span class="sourceLineNo">804</span>    }<a name="line.804"></a>
<span class="sourceLineNo">805</span><a name="line.805"></a>
<span class="sourceLineNo">806</span>    public Map&lt;Integer, Effect&gt; getEffects() {<a name="line.806"></a>
<span class="sourceLineNo">807</span>        return effects;<a name="line.807"></a>
<span class="sourceLineNo">808</span>    }<a name="line.808"></a>
<span class="sourceLineNo">809</span><a name="line.809"></a>
<span class="sourceLineNo">810</span>    public void removeAllEffects() {<a name="line.810"></a>
<span class="sourceLineNo">811</span>        for (Effect effect : this.effects.values()) {<a name="line.811"></a>
<span class="sourceLineNo">812</span>            this.removeEffect(effect.getId());<a name="line.812"></a>
<span class="sourceLineNo">813</span>        }<a name="line.813"></a>
<span class="sourceLineNo">814</span>    }<a name="line.814"></a>
<span class="sourceLineNo">815</span><a name="line.815"></a>
<span class="sourceLineNo">816</span>    public void removeEffect(int effectId) {<a name="line.816"></a>
<span class="sourceLineNo">817</span>        if (this.effects.containsKey(effectId)) {<a name="line.817"></a>
<span class="sourceLineNo">818</span>            Effect effect = this.effects.get(effectId);<a name="line.818"></a>
<span class="sourceLineNo">819</span>            this.effects.remove(effectId);<a name="line.819"></a>
<span class="sourceLineNo">820</span>            effect.remove(this);<a name="line.820"></a>
<span class="sourceLineNo">821</span>            this.recalculateEffectColor();<a name="line.821"></a>
<span class="sourceLineNo">822</span>        }<a name="line.822"></a>
<span class="sourceLineNo">823</span>    }<a name="line.823"></a>
<span class="sourceLineNo">824</span><a name="line.824"></a>
<span class="sourceLineNo">825</span>    public Effect getEffect(int effectId) {<a name="line.825"></a>
<span class="sourceLineNo">826</span>        return this.effects.getOrDefault(effectId, null);<a name="line.826"></a>
<span class="sourceLineNo">827</span>    }<a name="line.827"></a>
<span class="sourceLineNo">828</span><a name="line.828"></a>
<span class="sourceLineNo">829</span>    public boolean hasEffect(int effectId) {<a name="line.829"></a>
<span class="sourceLineNo">830</span>        return this.effects.containsKey(effectId);<a name="line.830"></a>
<span class="sourceLineNo">831</span>    }<a name="line.831"></a>
<span class="sourceLineNo">832</span><a name="line.832"></a>
<span class="sourceLineNo">833</span>    public void addEffect(Effect effect) {<a name="line.833"></a>
<span class="sourceLineNo">834</span>        if (effect == null) {<a name="line.834"></a>
<span class="sourceLineNo">835</span>            return; //here add null means add nothing<a name="line.835"></a>
<span class="sourceLineNo">836</span>        }<a name="line.836"></a>
<span class="sourceLineNo">837</span>        effect.add(this);<a name="line.837"></a>
<span class="sourceLineNo">838</span>        this.effects.put(effect.getId(), effect);<a name="line.838"></a>
<span class="sourceLineNo">839</span>        this.recalculateEffectColor();<a name="line.839"></a>
<span class="sourceLineNo">840</span>        if (effect.getId() == Effect.HEALTH_BOOST) {<a name="line.840"></a>
<span class="sourceLineNo">841</span>            this.setHealth(this.getHealth() + 4 * (effect.getAmplifier() + 1));<a name="line.841"></a>
<span class="sourceLineNo">842</span>        }<a name="line.842"></a>
<span class="sourceLineNo">843</span>    }<a name="line.843"></a>
<span class="sourceLineNo">844</span><a name="line.844"></a>
<span class="sourceLineNo">845</span>    public void recalculateBoundingBox() {<a name="line.845"></a>
<span class="sourceLineNo">846</span>        this.recalculateBoundingBox(true);<a name="line.846"></a>
<span class="sourceLineNo">847</span>    }<a name="line.847"></a>
<span class="sourceLineNo">848</span><a name="line.848"></a>
<span class="sourceLineNo">849</span>    public void recalculateBoundingBox(boolean send) {<a name="line.849"></a>
<span class="sourceLineNo">850</span>        float entityHeight = getCurrentHeight();<a name="line.850"></a>
<span class="sourceLineNo">851</span>        float height = entityHeight * this.scale;<a name="line.851"></a>
<span class="sourceLineNo">852</span>        double radius = (this.getWidth() * this.scale) / 2.0;<a name="line.852"></a>
<span class="sourceLineNo">853</span>        this.boundingBox.setBounds(x - radius, y, z - radius, x + radius, y + height, z + radius);<a name="line.853"></a>
<span class="sourceLineNo">854</span>        FloatEntityData bbH = new FloatEntityData(DATA_BOUNDING_BOX_HEIGHT, entityHeight);<a name="line.854"></a>
<span class="sourceLineNo">855</span>        FloatEntityData bbW = new FloatEntityData(DATA_BOUNDING_BOX_WIDTH, this.getWidth());<a name="line.855"></a>
<span class="sourceLineNo">856</span>        this.dataProperties.put(bbH);<a name="line.856"></a>
<span class="sourceLineNo">857</span>        this.dataProperties.put(bbW);<a name="line.857"></a>
<span class="sourceLineNo">858</span>        if (send) {<a name="line.858"></a>
<span class="sourceLineNo">859</span>            sendData(this.hasSpawned.values().toArray(Player.EMPTY_ARRAY), new EntityMetadata().put(bbH).put(bbW));<a name="line.859"></a>
<span class="sourceLineNo">860</span>        }<a name="line.860"></a>
<span class="sourceLineNo">861</span>    }<a name="line.861"></a>
<span class="sourceLineNo">862</span><a name="line.862"></a>
<span class="sourceLineNo">863</span>    protected void recalculateEffectColor() {<a name="line.863"></a>
<span class="sourceLineNo">864</span>        int[] color = new int[3];<a name="line.864"></a>
<span class="sourceLineNo">865</span>        int count = 0;<a name="line.865"></a>
<span class="sourceLineNo">866</span>        boolean ambient = true;<a name="line.866"></a>
<span class="sourceLineNo">867</span>        for (Effect effect : this.effects.values()) {<a name="line.867"></a>
<span class="sourceLineNo">868</span>            if (effect.isVisible()) {<a name="line.868"></a>
<span class="sourceLineNo">869</span>                int[] c = effect.getColor();<a name="line.869"></a>
<span class="sourceLineNo">870</span>                color[0] += c[0] * (effect.getAmplifier() + 1);<a name="line.870"></a>
<span class="sourceLineNo">871</span>                color[1] += c[1] * (effect.getAmplifier() + 1);<a name="line.871"></a>
<span class="sourceLineNo">872</span>                color[2] += c[2] * (effect.getAmplifier() + 1);<a name="line.872"></a>
<span class="sourceLineNo">873</span>                count += effect.getAmplifier() + 1;<a name="line.873"></a>
<span class="sourceLineNo">874</span>                if (!effect.isAmbient()) {<a name="line.874"></a>
<span class="sourceLineNo">875</span>                    ambient = false;<a name="line.875"></a>
<span class="sourceLineNo">876</span>                }<a name="line.876"></a>
<span class="sourceLineNo">877</span>            }<a name="line.877"></a>
<span class="sourceLineNo">878</span>        }<a name="line.878"></a>
<span class="sourceLineNo">879</span>        if (count &gt; 0) {<a name="line.879"></a>
<span class="sourceLineNo">880</span>            int r = (color[0] / count) &amp; 255;<a name="line.880"></a>
<span class="sourceLineNo">881</span>            int g = (color[1] / count) &amp; 255;<a name="line.881"></a>
<span class="sourceLineNo">882</span>            int b = (color[2] / count) &amp; 255;<a name="line.882"></a>
<span class="sourceLineNo">883</span>            this.setDataProperty(new IntEntityData(Entity.DATA_POTION_COLOR, (r &lt;&lt; 16) + (g &lt;&lt; 8) + b));<a name="line.883"></a>
<span class="sourceLineNo">884</span>            this.setDataProperty(new ByteEntityData(Entity.DATA_POTION_AMBIENT, ambient ? 1 : 0));<a name="line.884"></a>
<span class="sourceLineNo">885</span>        } else {<a name="line.885"></a>
<span class="sourceLineNo">886</span>            this.setDataProperty(new IntEntityData(Entity.DATA_POTION_COLOR, 0));<a name="line.886"></a>
<span class="sourceLineNo">887</span>            this.setDataProperty(new ByteEntityData(Entity.DATA_POTION_AMBIENT, 0));<a name="line.887"></a>
<span class="sourceLineNo">888</span>        }<a name="line.888"></a>
<span class="sourceLineNo">889</span>    }<a name="line.889"></a>
<span class="sourceLineNo">890</span><a name="line.890"></a>
<span class="sourceLineNo">891</span>    @Nullable<a name="line.891"></a>
<span class="sourceLineNo">892</span>    public static Entity createEntity(@Nonnull String name, @Nonnull Position pos, @Nullable Object... args) {<a name="line.892"></a>
<span class="sourceLineNo">893</span>        return createEntity(name, pos.getChunk(), getDefaultNBT(pos), args);<a name="line.893"></a>
<span class="sourceLineNo">894</span>    }<a name="line.894"></a>
<span class="sourceLineNo">895</span><a name="line.895"></a>
<span class="sourceLineNo">896</span>    @Nullable<a name="line.896"></a>
<span class="sourceLineNo">897</span>    public static Entity createEntity(int type, @Nonnull Position pos, @Nullable Object... args) {<a name="line.897"></a>
<span class="sourceLineNo">898</span>        return createEntity(String.valueOf(type), pos.getChunk(), getDefaultNBT(pos), args);<a name="line.898"></a>
<span class="sourceLineNo">899</span>    }<a name="line.899"></a>
<span class="sourceLineNo">900</span><a name="line.900"></a>
<span class="sourceLineNo">901</span>    @Nullable<a name="line.901"></a>
<span class="sourceLineNo">902</span>    public static Entity createEntity(@Nonnull String name, @Nonnull FullChunk chunk, @Nonnull CompoundTag nbt, @Nullable Object... args) {<a name="line.902"></a>
<span class="sourceLineNo">903</span>        Entity entity = null;<a name="line.903"></a>
<span class="sourceLineNo">904</span>        Class&lt;? extends Entity&gt; clazz = knownEntities.get(name);<a name="line.904"></a>
<span class="sourceLineNo">905</span>        if (clazz != null) {<a name="line.905"></a>
<span class="sourceLineNo">906</span>            List&lt;Exception&gt; exceptions = null;<a name="line.906"></a>
<span class="sourceLineNo">907</span>            for (Constructor constructor : clazz.getConstructors()) {<a name="line.907"></a>
<span class="sourceLineNo">908</span>                if (entity != null) {<a name="line.908"></a>
<span class="sourceLineNo">909</span>                    break;<a name="line.909"></a>
<span class="sourceLineNo">910</span>                }<a name="line.910"></a>
<span class="sourceLineNo">911</span>                if (constructor.getParameterCount() != (args == null ? 2 : args.length + 2)) {<a name="line.911"></a>
<span class="sourceLineNo">912</span>                    continue;<a name="line.912"></a>
<span class="sourceLineNo">913</span>                }<a name="line.913"></a>
<span class="sourceLineNo">914</span>                try {<a name="line.914"></a>
<span class="sourceLineNo">915</span>                    if (args == null || args.length == 0) {<a name="line.915"></a>
<span class="sourceLineNo">916</span>                        entity = (Entity) constructor.newInstance(chunk, nbt);<a name="line.916"></a>
<span class="sourceLineNo">917</span>                    } else {<a name="line.917"></a>
<span class="sourceLineNo">918</span>                        Object[] objects = new Object[args.length + 2];<a name="line.918"></a>
<span class="sourceLineNo">919</span>                        objects[0] = chunk;<a name="line.919"></a>
<span class="sourceLineNo">920</span>                        objects[1] = nbt;<a name="line.920"></a>
<span class="sourceLineNo">921</span>                        System.arraycopy(args, 0, objects, 2, args.length);<a name="line.921"></a>
<span class="sourceLineNo">922</span>                        entity = (Entity) constructor.newInstance(objects);<a name="line.922"></a>
<span class="sourceLineNo">923</span>                    }<a name="line.923"></a>
<span class="sourceLineNo">924</span>                } catch (Exception e) {<a name="line.924"></a>
<span class="sourceLineNo">925</span>                    if (exceptions == null) {<a name="line.925"></a>
<span class="sourceLineNo">926</span>                        exceptions = new ArrayList&lt;&gt;();<a name="line.926"></a>
<span class="sourceLineNo">927</span>                    }<a name="line.927"></a>
<span class="sourceLineNo">928</span>                    exceptions.add(e);<a name="line.928"></a>
<span class="sourceLineNo">929</span>                }<a name="line.929"></a>
<span class="sourceLineNo">930</span>            }<a name="line.930"></a>
<span class="sourceLineNo">931</span>            if (entity == null) {<a name="line.931"></a>
<span class="sourceLineNo">932</span>                Exception cause = new IllegalArgumentException("Could not create an entity of type " + name, exceptions != null &amp;&amp; exceptions.size() &gt; 0 ? exceptions.get(0) : null);<a name="line.932"></a>
<span class="sourceLineNo">933</span>                if (exceptions != null &amp;&amp; exceptions.size() &gt; 1) {<a name="line.933"></a>
<span class="sourceLineNo">934</span>                    for (int i = 1; i &lt; exceptions.size(); i++) {<a name="line.934"></a>
<span class="sourceLineNo">935</span>                        cause.addSuppressed(exceptions.get(i));<a name="line.935"></a>
<span class="sourceLineNo">936</span>                    }<a name="line.936"></a>
<span class="sourceLineNo">937</span>                }<a name="line.937"></a>
<span class="sourceLineNo">938</span>                log.debug("Could not create an entity of type {} with {} args", name, args == null ? 0 : args.length, cause);<a name="line.938"></a>
<span class="sourceLineNo">939</span>            }<a name="line.939"></a>
<span class="sourceLineNo">940</span>        } else {<a name="line.940"></a>
<span class="sourceLineNo">941</span>            log.debug("Entity type {} is unknown", name);<a name="line.941"></a>
<span class="sourceLineNo">942</span>        }<a name="line.942"></a>
<span class="sourceLineNo">943</span>        return entity;<a name="line.943"></a>
<span class="sourceLineNo">944</span>    }<a name="line.944"></a>
<span class="sourceLineNo">945</span><a name="line.945"></a>
<span class="sourceLineNo">946</span>    @Nullable<a name="line.946"></a>
<span class="sourceLineNo">947</span>    public static Entity createEntity(int type, @Nonnull FullChunk chunk, @Nonnull CompoundTag nbt, @Nullable Object... args) {<a name="line.947"></a>
<span class="sourceLineNo">948</span>        return createEntity(String.valueOf(type), chunk, nbt, args);<a name="line.948"></a>
<span class="sourceLineNo">949</span>    }<a name="line.949"></a>
<span class="sourceLineNo">950</span><a name="line.950"></a>
<span class="sourceLineNo">951</span>    public static boolean registerEntity(String name, Class&lt;? extends Entity&gt; clazz) {<a name="line.951"></a>
<span class="sourceLineNo">952</span>        return registerEntity(name, clazz, false);<a name="line.952"></a>
<span class="sourceLineNo">953</span>    }<a name="line.953"></a>
<span class="sourceLineNo">954</span><a name="line.954"></a>
<span class="sourceLineNo">955</span>    public static boolean registerEntity(String name, Class&lt;? extends Entity&gt; clazz, boolean force) {<a name="line.955"></a>
<span class="sourceLineNo">956</span>        if (clazz == null) {<a name="line.956"></a>
<span class="sourceLineNo">957</span>            return false;<a name="line.957"></a>
<span class="sourceLineNo">958</span>        }<a name="line.958"></a>
<span class="sourceLineNo">959</span>        try {<a name="line.959"></a>
<span class="sourceLineNo">960</span>            int networkId = clazz.getField("NETWORK_ID").getInt(null);<a name="line.960"></a>
<span class="sourceLineNo">961</span>            knownEntities.put(String.valueOf(networkId), clazz);<a name="line.961"></a>
<span class="sourceLineNo">962</span>        } catch (Exception e) {<a name="line.962"></a>
<span class="sourceLineNo">963</span>            if (!force) {<a name="line.963"></a>
<span class="sourceLineNo">964</span>                return false;<a name="line.964"></a>
<span class="sourceLineNo">965</span>            }<a name="line.965"></a>
<span class="sourceLineNo">966</span>        }<a name="line.966"></a>
<span class="sourceLineNo">967</span>        knownEntities.put(name, clazz);<a name="line.967"></a>
<span class="sourceLineNo">968</span>        shortNames.put(clazz.getSimpleName(), name);<a name="line.968"></a>
<span class="sourceLineNo">969</span>        return true;<a name="line.969"></a>
<span class="sourceLineNo">970</span>    }<a name="line.970"></a>
<span class="sourceLineNo">971</span><a name="line.971"></a>
<span class="sourceLineNo">972</span>    @Nonnull<a name="line.972"></a>
<span class="sourceLineNo">973</span>    @PowerNukkitOnly<a name="line.973"></a>
<span class="sourceLineNo">974</span>    @Since("1.5.1.0-PN")<a name="line.974"></a>
<span class="sourceLineNo">975</span>    public static IntCollection getKnownEntityIds() {<a name="line.975"></a>
<span class="sourceLineNo">976</span>        return knownEntities.keySet().stream().filter(Utils::isInteger).mapToInt(Integer::parseInt).collect(IntArrayList::new, IntArrayList::add, IntArrayList::addAll);<a name="line.976"></a>
<span class="sourceLineNo">977</span>    }<a name="line.977"></a>
<span class="sourceLineNo">978</span><a name="line.978"></a>
<span class="sourceLineNo">979</span>    @Nonnull<a name="line.979"></a>
<span class="sourceLineNo">980</span>    @PowerNukkitOnly<a name="line.980"></a>
<span class="sourceLineNo">981</span>    @Since("1.5.1.0-PN")<a name="line.981"></a>
<span class="sourceLineNo">982</span>    public static List&lt;String&gt; getSaveIds() {<a name="line.982"></a>
<span class="sourceLineNo">983</span>        return new ArrayList&lt;&gt;(shortNames.values());<a name="line.983"></a>
<span class="sourceLineNo">984</span>    }<a name="line.984"></a>
<span class="sourceLineNo">985</span><a name="line.985"></a>
<span class="sourceLineNo">986</span>    @Nonnull<a name="line.986"></a>
<span class="sourceLineNo">987</span>    @PowerNukkitOnly<a name="line.987"></a>
<span class="sourceLineNo">988</span>    @Since("1.5.1.0-PN")<a name="line.988"></a>
<span class="sourceLineNo">989</span>    public static OptionalInt getSaveId(String id) {<a name="line.989"></a>
<span class="sourceLineNo">990</span>        Class&lt;? extends Entity&gt; entityClass = knownEntities.get(id);<a name="line.990"></a>
<span class="sourceLineNo">991</span>        if (entityClass == null) {<a name="line.991"></a>
<span class="sourceLineNo">992</span>            return OptionalInt.empty();<a name="line.992"></a>
<span class="sourceLineNo">993</span>        }<a name="line.993"></a>
<span class="sourceLineNo">994</span>        return knownEntities.entrySet().stream().filter(entry -&gt; entry.getValue().equals(entityClass)).map(Map.Entry::getKey).filter(Utils::isInteger).mapToInt(Integer::parseInt).findFirst();<a name="line.994"></a>
<span class="sourceLineNo">995</span>    }<a name="line.995"></a>
<span class="sourceLineNo">996</span><a name="line.996"></a>
<span class="sourceLineNo">997</span>    @Nullable<a name="line.997"></a>
<span class="sourceLineNo">998</span>    @PowerNukkitOnly<a name="line.998"></a>
<span class="sourceLineNo">999</span>    @Since("1.5.1.0-PN")<a name="line.999"></a>
<span class="sourceLineNo">1000</span>    public static String getSaveId(int id) {<a name="line.1000"></a>
<span class="sourceLineNo">1001</span>        Class&lt;? extends Entity&gt; entityClass = knownEntities.get(Integer.toString(id));<a name="line.1001"></a>
<span class="sourceLineNo">1002</span>        if (entityClass == null) {<a name="line.1002"></a>
<span class="sourceLineNo">1003</span>            return null;<a name="line.1003"></a>
<span class="sourceLineNo">1004</span>        }<a name="line.1004"></a>
<span class="sourceLineNo">1005</span>        return shortNames.get(entityClass.getSimpleName());<a name="line.1005"></a>
<span class="sourceLineNo">1006</span>    }<a name="line.1006"></a>
<span class="sourceLineNo">1007</span><a name="line.1007"></a>
<span class="sourceLineNo">1008</span>    @Nonnull<a name="line.1008"></a>
<span class="sourceLineNo">1009</span>    public static CompoundTag getDefaultNBT(@Nonnull Vector3 pos) {<a name="line.1009"></a>
<span class="sourceLineNo">1010</span>        return getDefaultNBT(pos, null);<a name="line.1010"></a>
<span class="sourceLineNo">1011</span>    }<a name="line.1011"></a>
<span class="sourceLineNo">1012</span><a name="line.1012"></a>
<span class="sourceLineNo">1013</span>    @Nonnull<a name="line.1013"></a>
<span class="sourceLineNo">1014</span>    public static CompoundTag getDefaultNBT(@Nonnull Vector3 pos, @Nullable Vector3 motion) {<a name="line.1014"></a>
<span class="sourceLineNo">1015</span>        Location loc = pos instanceof Location ? (Location) pos : null;<a name="line.1015"></a>
<span class="sourceLineNo">1016</span>        if (loc != null) {<a name="line.1016"></a>
<span class="sourceLineNo">1017</span>            return getDefaultNBT(pos, motion, (float) loc.getYaw(), (float) loc.getPitch());<a name="line.1017"></a>
<span class="sourceLineNo">1018</span>        }<a name="line.1018"></a>
<span class="sourceLineNo">1019</span>        return getDefaultNBT(pos, motion, 0, 0);<a name="line.1019"></a>
<span class="sourceLineNo">1020</span>    }<a name="line.1020"></a>
<span class="sourceLineNo">1021</span><a name="line.1021"></a>
<span class="sourceLineNo">1022</span>    @Nonnull<a name="line.1022"></a>
<span class="sourceLineNo">1023</span>    public static CompoundTag getDefaultNBT(@Nonnull Vector3 pos, @Nullable Vector3 motion, float yaw, float pitch) {<a name="line.1023"></a>
<span class="sourceLineNo">1024</span>        return new CompoundTag().putList(new ListTag&lt;DoubleTag&gt;("Pos").add(new DoubleTag("", pos.x)).add(new DoubleTag("", pos.y)).add(new DoubleTag("", pos.z))).putList(new ListTag&lt;DoubleTag&gt;("Motion").add(new DoubleTag("", motion != null ? motion.x : 0)).add(new DoubleTag("", motion != null ? motion.y : 0)).add(new DoubleTag("", motion != null ? motion.z : 0))).putList(new ListTag&lt;FloatTag&gt;("Rotation").add(new FloatTag("", yaw)).add(new FloatTag("", pitch)));<a name="line.1024"></a>
<span class="sourceLineNo">1025</span>    }<a name="line.1025"></a>
<span class="sourceLineNo">1026</span><a name="line.1026"></a>
<span class="sourceLineNo">1027</span>    public void saveNBT() {<a name="line.1027"></a>
<span class="sourceLineNo">1028</span>        if (!(this instanceof Player)) {<a name="line.1028"></a>
<span class="sourceLineNo">1029</span>            this.namedTag.putString("id", this.getSaveId());<a name="line.1029"></a>
<span class="sourceLineNo">1030</span>            if (!this.getNameTag().equals("")) {<a name="line.1030"></a>
<span class="sourceLineNo">1031</span>                this.namedTag.putString("CustomName", this.getNameTag());<a name="line.1031"></a>
<span class="sourceLineNo">1032</span>                this.namedTag.putBoolean("CustomNameVisible", this.isNameTagVisible());<a name="line.1032"></a>
<span class="sourceLineNo">1033</span>                this.namedTag.putBoolean("CustomNameAlwaysVisible", this.isNameTagAlwaysVisible());<a name="line.1033"></a>
<span class="sourceLineNo">1034</span>            } else {<a name="line.1034"></a>
<span class="sourceLineNo">1035</span>                this.namedTag.remove("CustomName");<a name="line.1035"></a>
<span class="sourceLineNo">1036</span>                this.namedTag.remove("CustomNameVisible");<a name="line.1036"></a>
<span class="sourceLineNo">1037</span>                this.namedTag.remove("CustomNameAlwaysVisible");<a name="line.1037"></a>
<span class="sourceLineNo">1038</span>            }<a name="line.1038"></a>
<span class="sourceLineNo">1039</span>        }<a name="line.1039"></a>
<span class="sourceLineNo">1040</span>        this.namedTag.putList(new ListTag&lt;DoubleTag&gt;("Pos").add(new DoubleTag("0", this.x)).add(new DoubleTag("1", this.y)).add(new DoubleTag("2", this.z)));<a name="line.1040"></a>
<span class="sourceLineNo">1041</span>        this.namedTag.putList(new ListTag&lt;DoubleTag&gt;("Motion").add(new DoubleTag("0", this.motionX)).add(new DoubleTag("1", this.motionY)).add(new DoubleTag("2", this.motionZ)));<a name="line.1041"></a>
<span class="sourceLineNo">1042</span>        this.namedTag.putList(new ListTag&lt;FloatTag&gt;("Rotation").add(new FloatTag("0", (float) this.yaw)).add(new FloatTag("1", (float) this.pitch)));<a name="line.1042"></a>
<span class="sourceLineNo">1043</span>        this.namedTag.putFloat("FallDistance", this.fallDistance);<a name="line.1043"></a>
<span class="sourceLineNo">1044</span>        this.namedTag.putShort("Fire", this.fireTicks);<a name="line.1044"></a>
<span class="sourceLineNo">1045</span>        this.namedTag.putShort("Air", this.getDataPropertyShort(DATA_AIR));<a name="line.1045"></a>
<span class="sourceLineNo">1046</span>        this.namedTag.putBoolean("OnGround", this.onGround);<a name="line.1046"></a>
<span class="sourceLineNo">1047</span>        this.namedTag.putBoolean("Invulnerable", this.invulnerable);<a name="line.1047"></a>
<span class="sourceLineNo">1048</span>        this.namedTag.putFloat("Scale", this.scale);<a name="line.1048"></a>
<span class="sourceLineNo">1049</span>        if (!this.effects.isEmpty()) {<a name="line.1049"></a>
<span class="sourceLineNo">1050</span>            ListTag&lt;CompoundTag&gt; list = new ListTag&lt;&gt;("ActiveEffects");<a name="line.1050"></a>
<span class="sourceLineNo">1051</span>            for (Effect effect : this.effects.values()) {<a name="line.1051"></a>
<span class="sourceLineNo">1052</span>                list.add(new CompoundTag(String.valueOf(effect.getId())).putByte("Id", effect.getId()).putByte("Amplifier", effect.getAmplifier()).putInt("Duration", effect.getDuration()).putBoolean("Ambient", false).putBoolean("ShowParticles", effect.isVisible()));<a name="line.1052"></a>
<span class="sourceLineNo">1053</span>            }<a name="line.1053"></a>
<span class="sourceLineNo">1054</span>            this.namedTag.putList(list);<a name="line.1054"></a>
<span class="sourceLineNo">1055</span>        } else {<a name="line.1055"></a>
<span class="sourceLineNo">1056</span>            this.namedTag.remove("ActiveEffects");<a name="line.1056"></a>
<span class="sourceLineNo">1057</span>        }<a name="line.1057"></a>
<span class="sourceLineNo">1058</span>    }<a name="line.1058"></a>
<span class="sourceLineNo">1059</span><a name="line.1059"></a>
<span class="sourceLineNo">1060</span>    /**<a name="line.1060"></a>
<span class="sourceLineNo">1061</span>     * The name that English name of the type of this entity.<a name="line.1061"></a>
<span class="sourceLineNo">1062</span>     */<a name="line.1062"></a>
<span class="sourceLineNo">1063</span>    @PowerNukkitOnly<a name="line.1063"></a>
<span class="sourceLineNo">1064</span>    @Since("1.5.1.0-PN")<a name="line.1064"></a>
<span class="sourceLineNo">1065</span>    public String getOriginalName() {<a name="line.1065"></a>
<span class="sourceLineNo">1066</span>        return this.getSaveId();<a name="line.1066"></a>
<span class="sourceLineNo">1067</span>    }<a name="line.1067"></a>
<span class="sourceLineNo">1068</span><a name="line.1068"></a>
<span class="sourceLineNo">1069</span>    /**<a name="line.1069"></a>
<span class="sourceLineNo">1070</span>     * Similar to {@link #getName()}, but if the name is blank or empty it returns the static name instead.<a name="line.1070"></a>
<span class="sourceLineNo">1071</span>     */<a name="line.1071"></a>
<span class="sourceLineNo">1072</span>    @PowerNukkitOnly<a name="line.1072"></a>
<span class="sourceLineNo">1073</span>    @Since("1.5.1.0-PN")<a name="line.1073"></a>
<span class="sourceLineNo">1074</span>    public final String getVisibleName() {<a name="line.1074"></a>
<span class="sourceLineNo">1075</span>        String name = getName();<a name="line.1075"></a>
<span class="sourceLineNo">1076</span>        if (!TextFormat.clean(name).trim().isEmpty()) {<a name="line.1076"></a>
<span class="sourceLineNo">1077</span>            return name;<a name="line.1077"></a>
<span class="sourceLineNo">1078</span>        } else {<a name="line.1078"></a>
<span class="sourceLineNo">1079</span>            return getOriginalName();<a name="line.1079"></a>
<span class="sourceLineNo">1080</span>        }<a name="line.1080"></a>
<span class="sourceLineNo">1081</span>    }<a name="line.1081"></a>
<span class="sourceLineNo">1082</span><a name="line.1082"></a>
<span class="sourceLineNo">1083</span>    /**<a name="line.1083"></a>
<span class="sourceLineNo">1084</span>     * The current name used by this entity in the name tag, or the static name if the entity don't have nametag.<a name="line.1084"></a>
<span class="sourceLineNo">1085</span>     */<a name="line.1085"></a>
<span class="sourceLineNo">1086</span>    @Nonnull<a name="line.1086"></a>
<span class="sourceLineNo">1087</span>    public String getName() {<a name="line.1087"></a>
<span class="sourceLineNo">1088</span>        if (this.hasCustomName()) {<a name="line.1088"></a>
<span class="sourceLineNo">1089</span>            return this.getNameTag();<a name="line.1089"></a>
<span class="sourceLineNo">1090</span>        } else {<a name="line.1090"></a>
<span class="sourceLineNo">1091</span>            return this.getOriginalName();<a name="line.1091"></a>
<span class="sourceLineNo">1092</span>        }<a name="line.1092"></a>
<span class="sourceLineNo">1093</span>    }<a name="line.1093"></a>
<span class="sourceLineNo">1094</span><a name="line.1094"></a>
<span class="sourceLineNo">1095</span>    public final String getSaveId() {<a name="line.1095"></a>
<span class="sourceLineNo">1096</span>        return shortNames.getOrDefault(this.getClass().getSimpleName(), "");<a name="line.1096"></a>
<span class="sourceLineNo">1097</span>    }<a name="line.1097"></a>
<span class="sourceLineNo">1098</span><a name="line.1098"></a>
<span class="sourceLineNo">1099</span>    public void spawnTo(Player player) {<a name="line.1099"></a>
<span class="sourceLineNo">1100</span>        if (!this.hasSpawned.containsKey(player.getLoaderId()) &amp;&amp; this.chunk != null &amp;&amp; player.usedChunks.containsKey(Level.chunkHash(this.chunk.getX(), this.chunk.getZ()))) {<a name="line.1100"></a>
<span class="sourceLineNo">1101</span>            this.hasSpawned.put(player.getLoaderId(), player);<a name="line.1101"></a>
<span class="sourceLineNo">1102</span>            player.dataPacket(createAddEntityPacket());<a name="line.1102"></a>
<span class="sourceLineNo">1103</span>        }<a name="line.1103"></a>
<span class="sourceLineNo">1104</span>        if (this.riding != null) {<a name="line.1104"></a>
<span class="sourceLineNo">1105</span>            this.riding.spawnTo(player);<a name="line.1105"></a>
<span class="sourceLineNo">1106</span>            SetEntityLinkPacket pkk = new SetEntityLinkPacket();<a name="line.1106"></a>
<span class="sourceLineNo">1107</span>            pkk.vehicleUniqueId = this.riding.getId();<a name="line.1107"></a>
<span class="sourceLineNo">1108</span>            pkk.riderUniqueId = this.getId();<a name="line.1108"></a>
<span class="sourceLineNo">1109</span>            pkk.type = 1;<a name="line.1109"></a>
<span class="sourceLineNo">1110</span>            pkk.immediate = 1;<a name="line.1110"></a>
<span class="sourceLineNo">1111</span>            player.dataPacket(pkk);<a name="line.1111"></a>
<span class="sourceLineNo">1112</span>        }<a name="line.1112"></a>
<span class="sourceLineNo">1113</span>    }<a name="line.1113"></a>
<span class="sourceLineNo">1114</span><a name="line.1114"></a>
<span class="sourceLineNo">1115</span>    protected DataPacket createAddEntityPacket() {<a name="line.1115"></a>
<span class="sourceLineNo">1116</span>        AddEntityPacket addEntity = new AddEntityPacket();<a name="line.1116"></a>
<span class="sourceLineNo">1117</span>        addEntity.type = this.getNetworkId();<a name="line.1117"></a>
<span class="sourceLineNo">1118</span>        addEntity.entityUniqueId = this.getId();<a name="line.1118"></a>
<span class="sourceLineNo">1119</span>        addEntity.entityRuntimeId = this.getId();<a name="line.1119"></a>
<span class="sourceLineNo">1120</span>        addEntity.yaw = (float) this.yaw;<a name="line.1120"></a>
<span class="sourceLineNo">1121</span>        addEntity.headYaw = (float) this.yaw;<a name="line.1121"></a>
<span class="sourceLineNo">1122</span>        addEntity.pitch = (float) this.pitch;<a name="line.1122"></a>
<span class="sourceLineNo">1123</span>        addEntity.x = (float) this.x;<a name="line.1123"></a>
<span class="sourceLineNo">1124</span>        addEntity.y = (float) this.y;<a name="line.1124"></a>
<span class="sourceLineNo">1125</span>        addEntity.z = (float) this.z;<a name="line.1125"></a>
<span class="sourceLineNo">1126</span>        addEntity.speedX = (float) this.motionX;<a name="line.1126"></a>
<span class="sourceLineNo">1127</span>        addEntity.speedY = (float) this.motionY;<a name="line.1127"></a>
<span class="sourceLineNo">1128</span>        addEntity.speedZ = (float) this.motionZ;<a name="line.1128"></a>
<span class="sourceLineNo">1129</span>        addEntity.metadata = this.dataProperties;<a name="line.1129"></a>
<span class="sourceLineNo">1130</span>        addEntity.links = new EntityLink[this.passengers.size()];<a name="line.1130"></a>
<span class="sourceLineNo">1131</span>        for (int i = 0; i &lt; addEntity.links.length; i++) {<a name="line.1131"></a>
<span class="sourceLineNo">1132</span>            addEntity.links[i] = new EntityLink(this.getId(), this.passengers.get(i).getId(), i == 0 ? EntityLink.TYPE_RIDER : TYPE_PASSENGER, false, false);<a name="line.1132"></a>
<span class="sourceLineNo">1133</span>        }<a name="line.1133"></a>
<span class="sourceLineNo">1134</span>        return addEntity;<a name="line.1134"></a>
<span class="sourceLineNo">1135</span>    }<a name="line.1135"></a>
<span class="sourceLineNo">1136</span><a name="line.1136"></a>
<span class="sourceLineNo">1137</span>    public Map&lt;Integer, Player&gt; getViewers() {<a name="line.1137"></a>
<span class="sourceLineNo">1138</span>        return hasSpawned;<a name="line.1138"></a>
<span class="sourceLineNo">1139</span>    }<a name="line.1139"></a>
<span class="sourceLineNo">1140</span><a name="line.1140"></a>
<span class="sourceLineNo">1141</span>    public void sendPotionEffects(Player player) {<a name="line.1141"></a>
<span class="sourceLineNo">1142</span>        for (Effect effect : this.effects.values()) {<a name="line.1142"></a>
<span class="sourceLineNo">1143</span>            MobEffectPacket pk = new MobEffectPacket();<a name="line.1143"></a>
<span class="sourceLineNo">1144</span>            pk.eid = this.getId();<a name="line.1144"></a>
<span class="sourceLineNo">1145</span>            pk.effectId = effect.getId();<a name="line.1145"></a>
<span class="sourceLineNo">1146</span>            pk.amplifier = effect.getAmplifier();<a name="line.1146"></a>
<span class="sourceLineNo">1147</span>            pk.particles = effect.isVisible();<a name="line.1147"></a>
<span class="sourceLineNo">1148</span>            pk.duration = effect.getDuration();<a name="line.1148"></a>
<span class="sourceLineNo">1149</span>            pk.eventId = MobEffectPacket.EVENT_ADD;<a name="line.1149"></a>
<span class="sourceLineNo">1150</span>            player.dataPacket(pk);<a name="line.1150"></a>
<span class="sourceLineNo">1151</span>        }<a name="line.1151"></a>
<span class="sourceLineNo">1152</span>    }<a name="line.1152"></a>
<span class="sourceLineNo">1153</span><a name="line.1153"></a>
<span class="sourceLineNo">1154</span>    public void sendData(Player player) {<a name="line.1154"></a>
<span class="sourceLineNo">1155</span>        this.sendData(player, null);<a name="line.1155"></a>
<span class="sourceLineNo">1156</span>    }<a name="line.1156"></a>
<span class="sourceLineNo">1157</span><a name="line.1157"></a>
<span class="sourceLineNo">1158</span>    public void sendData(Player player, EntityMetadata data) {<a name="line.1158"></a>
<span class="sourceLineNo">1159</span>        SetEntityDataPacket pk = new SetEntityDataPacket();<a name="line.1159"></a>
<span class="sourceLineNo">1160</span>        pk.eid = this.getId();<a name="line.1160"></a>
<span class="sourceLineNo">1161</span>        pk.metadata = data == null ? this.dataProperties : data;<a name="line.1161"></a>
<span class="sourceLineNo">1162</span>        player.dataPacket(pk);<a name="line.1162"></a>
<span class="sourceLineNo">1163</span>    }<a name="line.1163"></a>
<span class="sourceLineNo">1164</span><a name="line.1164"></a>
<span class="sourceLineNo">1165</span>    public void sendData(Player[] players) {<a name="line.1165"></a>
<span class="sourceLineNo">1166</span>        this.sendData(players, null);<a name="line.1166"></a>
<span class="sourceLineNo">1167</span>    }<a name="line.1167"></a>
<span class="sourceLineNo">1168</span><a name="line.1168"></a>
<span class="sourceLineNo">1169</span>    public void sendData(Player[] players, EntityMetadata data) {<a name="line.1169"></a>
<span class="sourceLineNo">1170</span>        SetEntityDataPacket pk = new SetEntityDataPacket();<a name="line.1170"></a>
<span class="sourceLineNo">1171</span>        pk.eid = this.getId();<a name="line.1171"></a>
<span class="sourceLineNo">1172</span>        pk.metadata = data == null ? this.dataProperties : data;<a name="line.1172"></a>
<span class="sourceLineNo">1173</span>        for (Player player : players) {<a name="line.1173"></a>
<span class="sourceLineNo">1174</span>            if (player == this) {<a name="line.1174"></a>
<span class="sourceLineNo">1175</span>                continue;<a name="line.1175"></a>
<span class="sourceLineNo">1176</span>            }<a name="line.1176"></a>
<span class="sourceLineNo">1177</span>            player.dataPacket(pk.clone());<a name="line.1177"></a>
<span class="sourceLineNo">1178</span>        }<a name="line.1178"></a>
<span class="sourceLineNo">1179</span>        if (this instanceof Player) {<a name="line.1179"></a>
<span class="sourceLineNo">1180</span>            ((Player) this).dataPacket(pk);<a name="line.1180"></a>
<span class="sourceLineNo">1181</span>        }<a name="line.1181"></a>
<span class="sourceLineNo">1182</span>    }<a name="line.1182"></a>
<span class="sourceLineNo">1183</span><a name="line.1183"></a>
<span class="sourceLineNo">1184</span>    public void despawnFrom(Player player) {<a name="line.1184"></a>
<span class="sourceLineNo">1185</span>        if (this.hasSpawned.containsKey(player.getLoaderId())) {<a name="line.1185"></a>
<span class="sourceLineNo">1186</span>            RemoveEntityPacket pk = new RemoveEntityPacket();<a name="line.1186"></a>
<span class="sourceLineNo">1187</span>            pk.eid = this.getId();<a name="line.1187"></a>
<span class="sourceLineNo">1188</span>            player.dataPacket(pk);<a name="line.1188"></a>
<span class="sourceLineNo">1189</span>            this.hasSpawned.remove(player.getLoaderId());<a name="line.1189"></a>
<span class="sourceLineNo">1190</span>        }<a name="line.1190"></a>
<span class="sourceLineNo">1191</span>    }<a name="line.1191"></a>
<span class="sourceLineNo">1192</span><a name="line.1192"></a>
<span class="sourceLineNo">1193</span>    public boolean attack(EntityDamageEvent source) {<a name="line.1193"></a>
<span class="sourceLineNo">1194</span>        if (hasEffect(Effect.FIRE_RESISTANCE) &amp;&amp; (source.getCause() == DamageCause.FIRE || source.getCause() == DamageCause.FIRE_TICK || source.getCause() == DamageCause.LAVA)) {<a name="line.1194"></a>
<span class="sourceLineNo">1195</span>            return false;<a name="line.1195"></a>
<span class="sourceLineNo">1196</span>        }<a name="line.1196"></a>
<span class="sourceLineNo">1197</span>        getServer().getPluginManager().callEvent(source);<a name="line.1197"></a>
<span class="sourceLineNo">1198</span>        if (source.isCancelled()) {<a name="line.1198"></a>
<span class="sourceLineNo">1199</span>            return false;<a name="line.1199"></a>
<span class="sourceLineNo">1200</span>        }<a name="line.1200"></a>
<span class="sourceLineNo">1201</span>        if (this.absorption &gt; 0) {<a name="line.1201"></a>
<span class="sourceLineNo">1202</span>            // Damage Absorption<a name="line.1202"></a>
<span class="sourceLineNo">1203</span>            this.setAbsorption(Math.max(0, this.getAbsorption() + source.getDamage(EntityDamageEvent.DamageModifier.ABSORPTION)));<a name="line.1203"></a>
<span class="sourceLineNo">1204</span>        }<a name="line.1204"></a>
<span class="sourceLineNo">1205</span>        setLastDamageCause(source);<a name="line.1205"></a>
<span class="sourceLineNo">1206</span>        float newHealth = getHealth() - source.getFinalDamage();<a name="line.1206"></a>
<span class="sourceLineNo">1207</span>        if (newHealth &lt; 1 &amp;&amp; this instanceof Player) {<a name="line.1207"></a>
<span class="sourceLineNo">1208</span>            if (source.getCause() != DamageCause.VOID &amp;&amp; source.getCause() != DamageCause.SUICIDE) {<a name="line.1208"></a>
<span class="sourceLineNo">1209</span>                Player p = (Player) this;<a name="line.1209"></a>
<span class="sourceLineNo">1210</span>                boolean totem = false;<a name="line.1210"></a>
<span class="sourceLineNo">1211</span>                if (p.getOffhandInventory().getItem(0).getId() == ItemID.TOTEM) {<a name="line.1211"></a>
<span class="sourceLineNo">1212</span>                    p.getOffhandInventory().clear(0);<a name="line.1212"></a>
<span class="sourceLineNo">1213</span>                    totem = true;<a name="line.1213"></a>
<span class="sourceLineNo">1214</span>                } else if (p.getInventory().getItemInHand().getId() == ItemID.TOTEM) {<a name="line.1214"></a>
<span class="sourceLineNo">1215</span>                    p.getInventory().clear(p.getInventory().getHeldItemIndex());<a name="line.1215"></a>
<span class="sourceLineNo">1216</span>                    totem = true;<a name="line.1216"></a>
<span class="sourceLineNo">1217</span>                }<a name="line.1217"></a>
<span class="sourceLineNo">1218</span>                if (totem) {<a name="line.1218"></a>
<span class="sourceLineNo">1219</span>                    this.getLevel().addLevelEvent(this, LevelEventPacket.EVENT_SOUND_TOTEM);<a name="line.1219"></a>
<span class="sourceLineNo">1220</span>                    this.getLevel().addParticleEffect(this, ParticleEffect.TOTEM);<a name="line.1220"></a>
<span class="sourceLineNo">1221</span>                    this.extinguish();<a name="line.1221"></a>
<span class="sourceLineNo">1222</span>                    this.removeAllEffects();<a name="line.1222"></a>
<span class="sourceLineNo">1223</span>                    this.setHealth(1);<a name="line.1223"></a>
<span class="sourceLineNo">1224</span>                    this.addEffect(Effect.getEffect(Effect.REGENERATION).setDuration(800).setAmplifier(1));<a name="line.1224"></a>
<span class="sourceLineNo">1225</span>                    this.addEffect(Effect.getEffect(Effect.FIRE_RESISTANCE).setDuration(800));<a name="line.1225"></a>
<span class="sourceLineNo">1226</span>                    this.addEffect(Effect.getEffect(Effect.ABSORPTION).setDuration(100).setAmplifier(1));<a name="line.1226"></a>
<span class="sourceLineNo">1227</span>                    EntityEventPacket pk = new EntityEventPacket();<a name="line.1227"></a>
<span class="sourceLineNo">1228</span>                    pk.eid = this.getId();<a name="line.1228"></a>
<span class="sourceLineNo">1229</span>                    pk.event = EntityEventPacket.CONSUME_TOTEM;<a name="line.1229"></a>
<span class="sourceLineNo">1230</span>                    p.dataPacket(pk);<a name="line.1230"></a>
<span class="sourceLineNo">1231</span>                    source.setCancelled(true);<a name="line.1231"></a>
<span class="sourceLineNo">1232</span>                    return false;<a name="line.1232"></a>
<span class="sourceLineNo">1233</span>                }<a name="line.1233"></a>
<span class="sourceLineNo">1234</span>            }<a name="line.1234"></a>
<span class="sourceLineNo">1235</span>        }<a name="line.1235"></a>
<span class="sourceLineNo">1236</span>        Entity attacker = source instanceof EntityDamageByEntityEvent ? ((EntityDamageByEntityEvent) source).getDamager() : null;<a name="line.1236"></a>
<span class="sourceLineNo">1237</span>        for (SideEffect sideEffect : source.getSideEffects()) {<a name="line.1237"></a>
<span class="sourceLineNo">1238</span>            sideEffect.doPreHealthChange(this, source, attacker);<a name="line.1238"></a>
<span class="sourceLineNo">1239</span>        }<a name="line.1239"></a>
<span class="sourceLineNo">1240</span>        setHealth(newHealth);<a name="line.1240"></a>
<span class="sourceLineNo">1241</span>        return true;<a name="line.1241"></a>
<span class="sourceLineNo">1242</span>    }<a name="line.1242"></a>
<span class="sourceLineNo">1243</span><a name="line.1243"></a>
<span class="sourceLineNo">1244</span>    public boolean attack(float damage) {<a name="line.1244"></a>
<span class="sourceLineNo">1245</span>        return this.attack(new EntityDamageEvent(this, DamageCause.CUSTOM, damage));<a name="line.1245"></a>
<span class="sourceLineNo">1246</span>    }<a name="line.1246"></a>
<span class="sourceLineNo">1247</span><a name="line.1247"></a>
<span class="sourceLineNo">1248</span>    public void heal(EntityRegainHealthEvent source) {<a name="line.1248"></a>
<span class="sourceLineNo">1249</span>        this.server.getPluginManager().callEvent(source);<a name="line.1249"></a>
<span class="sourceLineNo">1250</span>        if (source.isCancelled()) {<a name="line.1250"></a>
<span class="sourceLineNo">1251</span>            return;<a name="line.1251"></a>
<span class="sourceLineNo">1252</span>        }<a name="line.1252"></a>
<span class="sourceLineNo">1253</span>        this.setHealth(this.getHealth() + source.getAmount());<a name="line.1253"></a>
<span class="sourceLineNo">1254</span>    }<a name="line.1254"></a>
<span class="sourceLineNo">1255</span><a name="line.1255"></a>
<span class="sourceLineNo">1256</span>    public void heal(float amount) {<a name="line.1256"></a>
<span class="sourceLineNo">1257</span>        this.heal(new EntityRegainHealthEvent(this, amount, EntityRegainHealthEvent.CAUSE_REGEN));<a name="line.1257"></a>
<span class="sourceLineNo">1258</span>    }<a name="line.1258"></a>
<span class="sourceLineNo">1259</span><a name="line.1259"></a>
<span class="sourceLineNo">1260</span>    public float getHealth() {<a name="line.1260"></a>
<span class="sourceLineNo">1261</span>        return health;<a name="line.1261"></a>
<span class="sourceLineNo">1262</span>    }<a name="line.1262"></a>
<span class="sourceLineNo">1263</span><a name="line.1263"></a>
<span class="sourceLineNo">1264</span>    public boolean isAlive() {<a name="line.1264"></a>
<span class="sourceLineNo">1265</span>        return this.health &gt; 0;<a name="line.1265"></a>
<span class="sourceLineNo">1266</span>    }<a name="line.1266"></a>
<span class="sourceLineNo">1267</span><a name="line.1267"></a>
<span class="sourceLineNo">1268</span>    public boolean isClosed() {<a name="line.1268"></a>
<span class="sourceLineNo">1269</span>        return closed;<a name="line.1269"></a>
<span class="sourceLineNo">1270</span>    }<a name="line.1270"></a>
<span class="sourceLineNo">1271</span><a name="line.1271"></a>
<span class="sourceLineNo">1272</span>    public void setHealth(float health) {<a name="line.1272"></a>
<span class="sourceLineNo">1273</span>        if (this.health == health) {<a name="line.1273"></a>
<span class="sourceLineNo">1274</span>            return;<a name="line.1274"></a>
<span class="sourceLineNo">1275</span>        }<a name="line.1275"></a>
<span class="sourceLineNo">1276</span>        if (health &lt; 1) {<a name="line.1276"></a>
<span class="sourceLineNo">1277</span>            if (this.isAlive()) {<a name="line.1277"></a>
<span class="sourceLineNo">1278</span>                this.kill();<a name="line.1278"></a>
<span class="sourceLineNo">1279</span>            }<a name="line.1279"></a>
<span class="sourceLineNo">1280</span>        } else if (health &lt;= this.getMaxHealth() || health &lt; this.health) {<a name="line.1280"></a>
<span class="sourceLineNo">1281</span>            this.health = health;<a name="line.1281"></a>
<span class="sourceLineNo">1282</span>        } else {<a name="line.1282"></a>
<span class="sourceLineNo">1283</span>            this.health = this.getMaxHealth();<a name="line.1283"></a>
<span class="sourceLineNo">1284</span>        }<a name="line.1284"></a>
<span class="sourceLineNo">1285</span>        setDataProperty(new IntEntityData(DATA_HEALTH, (int) this.health));<a name="line.1285"></a>
<span class="sourceLineNo">1286</span>    }<a name="line.1286"></a>
<span class="sourceLineNo">1287</span><a name="line.1287"></a>
<span class="sourceLineNo">1288</span>    public void setLastDamageCause(EntityDamageEvent type) {<a name="line.1288"></a>
<span class="sourceLineNo">1289</span>        this.lastDamageCause = type;<a name="line.1289"></a>
<span class="sourceLineNo">1290</span>    }<a name="line.1290"></a>
<span class="sourceLineNo">1291</span><a name="line.1291"></a>
<span class="sourceLineNo">1292</span>    public EntityDamageEvent getLastDamageCause() {<a name="line.1292"></a>
<span class="sourceLineNo">1293</span>        return lastDamageCause;<a name="line.1293"></a>
<span class="sourceLineNo">1294</span>    }<a name="line.1294"></a>
<span class="sourceLineNo">1295</span><a name="line.1295"></a>
<span class="sourceLineNo">1296</span>    public int getMaxHealth() {<a name="line.1296"></a>
<span class="sourceLineNo">1297</span>        return maxHealth + (this.hasEffect(Effect.HEALTH_BOOST) ? 4 * (this.getEffect(Effect.HEALTH_BOOST).getAmplifier() + 1) : 0);<a name="line.1297"></a>
<span class="sourceLineNo">1298</span>    }<a name="line.1298"></a>
<span class="sourceLineNo">1299</span><a name="line.1299"></a>
<span class="sourceLineNo">1300</span>    public void setMaxHealth(int maxHealth) {<a name="line.1300"></a>
<span class="sourceLineNo">1301</span>        this.maxHealth = maxHealth;<a name="line.1301"></a>
<span class="sourceLineNo">1302</span>    }<a name="line.1302"></a>
<span class="sourceLineNo">1303</span><a name="line.1303"></a>
<span class="sourceLineNo">1304</span>    public boolean canCollideWith(Entity entity) {<a name="line.1304"></a>
<span class="sourceLineNo">1305</span>        return !this.justCreated &amp;&amp; this != entity;<a name="line.1305"></a>
<span class="sourceLineNo">1306</span>    }<a name="line.1306"></a>
<span class="sourceLineNo">1307</span><a name="line.1307"></a>
<span class="sourceLineNo">1308</span>    protected boolean checkObstruction(double x, double y, double z) {<a name="line.1308"></a>
<span class="sourceLineNo">1309</span>        if (this.level.getCollisionCubes(this, this.getBoundingBox(), false).length == 0 || this.noClip) {<a name="line.1309"></a>
<span class="sourceLineNo">1310</span>            return false;<a name="line.1310"></a>
<span class="sourceLineNo">1311</span>        }<a name="line.1311"></a>
<span class="sourceLineNo">1312</span>        int i = NukkitMath.floorDouble(x);<a name="line.1312"></a>
<span class="sourceLineNo">1313</span>        int j = NukkitMath.floorDouble(y);<a name="line.1313"></a>
<span class="sourceLineNo">1314</span>        int k = NukkitMath.floorDouble(z);<a name="line.1314"></a>
<span class="sourceLineNo">1315</span>        double diffX = x - i;<a name="line.1315"></a>
<span class="sourceLineNo">1316</span>        double diffY = y - j;<a name="line.1316"></a>
<span class="sourceLineNo">1317</span>        double diffZ = z - k;<a name="line.1317"></a>
<span class="sourceLineNo">1318</span>        if (!Block.transparent[this.level.getBlockIdAt(i, j, k)]) {<a name="line.1318"></a>
<span class="sourceLineNo">1319</span>            boolean flag = Block.transparent[this.level.getBlockIdAt(i - 1, j, k)];<a name="line.1319"></a>
<span class="sourceLineNo">1320</span>            boolean flag1 = Block.transparent[this.level.getBlockIdAt(i + 1, j, k)];<a name="line.1320"></a>
<span class="sourceLineNo">1321</span>            boolean flag2 = Block.transparent[this.level.getBlockIdAt(i, j - 1, k)];<a name="line.1321"></a>
<span class="sourceLineNo">1322</span>            boolean flag3 = Block.transparent[this.level.getBlockIdAt(i, j + 1, k)];<a name="line.1322"></a>
<span class="sourceLineNo">1323</span>            boolean flag4 = Block.transparent[this.level.getBlockIdAt(i, j, k - 1)];<a name="line.1323"></a>
<span class="sourceLineNo">1324</span>            boolean flag5 = Block.transparent[this.level.getBlockIdAt(i, j, k + 1)];<a name="line.1324"></a>
<span class="sourceLineNo">1325</span>            int direction = -1;<a name="line.1325"></a>
<span class="sourceLineNo">1326</span>            double limit = 9999;<a name="line.1326"></a>
<span class="sourceLineNo">1327</span>            if (flag) {<a name="line.1327"></a>
<span class="sourceLineNo">1328</span>                limit = diffX;<a name="line.1328"></a>
<span class="sourceLineNo">1329</span>                direction = 0;<a name="line.1329"></a>
<span class="sourceLineNo">1330</span>            }<a name="line.1330"></a>
<span class="sourceLineNo">1331</span>            if (flag1 &amp;&amp; 1 - diffX &lt; limit) {<a name="line.1331"></a>
<span class="sourceLineNo">1332</span>                limit = 1 - diffX;<a name="line.1332"></a>
<span class="sourceLineNo">1333</span>                direction = 1;<a name="line.1333"></a>
<span class="sourceLineNo">1334</span>            }<a name="line.1334"></a>
<span class="sourceLineNo">1335</span>            if (flag2 &amp;&amp; diffY &lt; limit) {<a name="line.1335"></a>
<span class="sourceLineNo">1336</span>                limit = diffY;<a name="line.1336"></a>
<span class="sourceLineNo">1337</span>                direction = 2;<a name="line.1337"></a>
<span class="sourceLineNo">1338</span>            }<a name="line.1338"></a>
<span class="sourceLineNo">1339</span>            if (flag3 &amp;&amp; 1 - diffY &lt; limit) {<a name="line.1339"></a>
<span class="sourceLineNo">1340</span>                limit = 1 - diffY;<a name="line.1340"></a>
<span class="sourceLineNo">1341</span>                direction = 3;<a name="line.1341"></a>
<span class="sourceLineNo">1342</span>            }<a name="line.1342"></a>
<span class="sourceLineNo">1343</span>            if (flag4 &amp;&amp; diffZ &lt; limit) {<a name="line.1343"></a>
<span class="sourceLineNo">1344</span>                limit = diffZ;<a name="line.1344"></a>
<span class="sourceLineNo">1345</span>                direction = 4;<a name="line.1345"></a>
<span class="sourceLineNo">1346</span>            }<a name="line.1346"></a>
<span class="sourceLineNo">1347</span>            if (flag5 &amp;&amp; 1 - diffZ &lt; limit) {<a name="line.1347"></a>
<span class="sourceLineNo">1348</span>                direction = 5;<a name="line.1348"></a>
<span class="sourceLineNo">1349</span>            }<a name="line.1349"></a>
<span class="sourceLineNo">1350</span>            double force = ThreadLocalRandom.current().nextDouble() * 0.2 + 0.1;<a name="line.1350"></a>
<span class="sourceLineNo">1351</span>            if (direction == 0) {<a name="line.1351"></a>
<span class="sourceLineNo">1352</span>                this.motionX = -force;<a name="line.1352"></a>
<span class="sourceLineNo">1353</span>                return true;<a name="line.1353"></a>
<span class="sourceLineNo">1354</span>            }<a name="line.1354"></a>
<span class="sourceLineNo">1355</span>            if (direction == 1) {<a name="line.1355"></a>
<span class="sourceLineNo">1356</span>                this.motionX = force;<a name="line.1356"></a>
<span class="sourceLineNo">1357</span>                return true;<a name="line.1357"></a>
<span class="sourceLineNo">1358</span>            }<a name="line.1358"></a>
<span class="sourceLineNo">1359</span>            if (direction == 2) {<a name="line.1359"></a>
<span class="sourceLineNo">1360</span>                this.motionY = -force;<a name="line.1360"></a>
<span class="sourceLineNo">1361</span>                return true;<a name="line.1361"></a>
<span class="sourceLineNo">1362</span>            }<a name="line.1362"></a>
<span class="sourceLineNo">1363</span>            if (direction == 3) {<a name="line.1363"></a>
<span class="sourceLineNo">1364</span>                this.motionY = force;<a name="line.1364"></a>
<span class="sourceLineNo">1365</span>                return true;<a name="line.1365"></a>
<span class="sourceLineNo">1366</span>            }<a name="line.1366"></a>
<span class="sourceLineNo">1367</span>            if (direction == 4) {<a name="line.1367"></a>
<span class="sourceLineNo">1368</span>                this.motionZ = -force;<a name="line.1368"></a>
<span class="sourceLineNo">1369</span>                return true;<a name="line.1369"></a>
<span class="sourceLineNo">1370</span>            }<a name="line.1370"></a>
<span class="sourceLineNo">1371</span>            if (direction == 5) {<a name="line.1371"></a>
<span class="sourceLineNo">1372</span>                this.motionZ = force;<a name="line.1372"></a>
<span class="sourceLineNo">1373</span>                return true;<a name="line.1373"></a>
<span class="sourceLineNo">1374</span>            }<a name="line.1374"></a>
<span class="sourceLineNo">1375</span>        }<a name="line.1375"></a>
<span class="sourceLineNo">1376</span>        return false;<a name="line.1376"></a>
<span class="sourceLineNo">1377</span>    }<a name="line.1377"></a>
<span class="sourceLineNo">1378</span><a name="line.1378"></a>
<span class="sourceLineNo">1379</span>    public boolean entityBaseTick() {<a name="line.1379"></a>
<span class="sourceLineNo">1380</span>        return this.entityBaseTick(1);<a name="line.1380"></a>
<span class="sourceLineNo">1381</span>    }<a name="line.1381"></a>
<span class="sourceLineNo">1382</span><a name="line.1382"></a>
<span class="sourceLineNo">1383</span>    public boolean entityBaseTick(int tickDiff) {<a name="line.1383"></a>
<span class="sourceLineNo">1384</span>        Timings.entityBaseTickTimer.startTiming();<a name="line.1384"></a>
<span class="sourceLineNo">1385</span>        if (!this.isPlayer) {<a name="line.1385"></a>
<span class="sourceLineNo">1386</span>            this.blocksAround = null;<a name="line.1386"></a>
<span class="sourceLineNo">1387</span>            this.collisionBlocks = null;<a name="line.1387"></a>
<span class="sourceLineNo">1388</span>        }<a name="line.1388"></a>
<span class="sourceLineNo">1389</span>        this.justCreated = false;<a name="line.1389"></a>
<span class="sourceLineNo">1390</span>        if (!this.isAlive()) {<a name="line.1390"></a>
<span class="sourceLineNo">1391</span>            this.removeAllEffects();<a name="line.1391"></a>
<span class="sourceLineNo">1392</span>            this.despawnFromAll();<a name="line.1392"></a>
<span class="sourceLineNo">1393</span>            if (!this.isPlayer) {<a name="line.1393"></a>
<span class="sourceLineNo">1394</span>                this.close();<a name="line.1394"></a>
<span class="sourceLineNo">1395</span>            }<a name="line.1395"></a>
<span class="sourceLineNo">1396</span>            Timings.entityBaseTickTimer.stopTiming();<a name="line.1396"></a>
<span class="sourceLineNo">1397</span>            return false;<a name="line.1397"></a>
<span class="sourceLineNo">1398</span>        }<a name="line.1398"></a>
<span class="sourceLineNo">1399</span>        if (riding != null &amp;&amp; !riding.isAlive() &amp;&amp; riding instanceof EntityRideable) {<a name="line.1399"></a>
<span class="sourceLineNo">1400</span>            ((EntityRideable) riding).mountEntity(this);<a name="line.1400"></a>
<span class="sourceLineNo">1401</span>        }<a name="line.1401"></a>
<span class="sourceLineNo">1402</span>        updatePassengers();<a name="line.1402"></a>
<span class="sourceLineNo">1403</span>        if (!this.effects.isEmpty()) {<a name="line.1403"></a>
<span class="sourceLineNo">1404</span>            for (Effect effect : this.effects.values()) {<a name="line.1404"></a>
<span class="sourceLineNo">1405</span>                if (effect.canTick()) {<a name="line.1405"></a>
<span class="sourceLineNo">1406</span>                    effect.applyEffect(this);<a name="line.1406"></a>
<span class="sourceLineNo">1407</span>                }<a name="line.1407"></a>
<span class="sourceLineNo">1408</span>                effect.setDuration(effect.getDuration() - tickDiff);<a name="line.1408"></a>
<span class="sourceLineNo">1409</span>                if (effect.getDuration() &lt;= 0) {<a name="line.1409"></a>
<span class="sourceLineNo">1410</span>                    this.removeEffect(effect.getId());<a name="line.1410"></a>
<span class="sourceLineNo">1411</span>                }<a name="line.1411"></a>
<span class="sourceLineNo">1412</span>            }<a name="line.1412"></a>
<span class="sourceLineNo">1413</span>        }<a name="line.1413"></a>
<span class="sourceLineNo">1414</span>        boolean hasUpdate = false;<a name="line.1414"></a>
<span class="sourceLineNo">1415</span>        this.checkBlockCollision();<a name="line.1415"></a>
<span class="sourceLineNo">1416</span>        if (this.y &lt;= -16 &amp;&amp; this.isAlive()) {<a name="line.1416"></a>
<span class="sourceLineNo">1417</span>            if (this instanceof Player) {<a name="line.1417"></a>
<span class="sourceLineNo">1418</span>                Player player = (Player) this;<a name="line.1418"></a>
<span class="sourceLineNo">1419</span>                if (!player.isCreative()) this.attack(new EntityDamageEvent(this, DamageCause.VOID, 10));<a name="line.1419"></a>
<span class="sourceLineNo">1420</span>            } else {<a name="line.1420"></a>
<span class="sourceLineNo">1421</span>                this.attack(new EntityDamageEvent(this, DamageCause.VOID, 10));<a name="line.1421"></a>
<span class="sourceLineNo">1422</span>                hasUpdate = true;<a name="line.1422"></a>
<span class="sourceLineNo">1423</span>            }<a name="line.1423"></a>
<span class="sourceLineNo">1424</span>        }<a name="line.1424"></a>
<span class="sourceLineNo">1425</span>        if (this.fireTicks &gt; 0) {<a name="line.1425"></a>
<span class="sourceLineNo">1426</span>            if (this.fireProof) {<a name="line.1426"></a>
<span class="sourceLineNo">1427</span>                this.fireTicks -= 4 * tickDiff;<a name="line.1427"></a>
<span class="sourceLineNo">1428</span>                if (this.fireTicks &lt; 0) {<a name="line.1428"></a>
<span class="sourceLineNo">1429</span>                    this.fireTicks = 0;<a name="line.1429"></a>
<span class="sourceLineNo">1430</span>                }<a name="line.1430"></a>
<span class="sourceLineNo">1431</span>            } else {<a name="line.1431"></a>
<span class="sourceLineNo">1432</span>                if (!this.hasEffect(Effect.FIRE_RESISTANCE) &amp;&amp; ((this.fireTicks % 20) == 0 || tickDiff &gt; 20)) {<a name="line.1432"></a>
<span class="sourceLineNo">1433</span>                    this.attack(new EntityDamageEvent(this, DamageCause.FIRE_TICK, 1));<a name="line.1433"></a>
<span class="sourceLineNo">1434</span>                }<a name="line.1434"></a>
<span class="sourceLineNo">1435</span>                this.fireTicks -= tickDiff;<a name="line.1435"></a>
<span class="sourceLineNo">1436</span>            }<a name="line.1436"></a>
<span class="sourceLineNo">1437</span>            if (this.fireTicks &lt;= 0) {<a name="line.1437"></a>
<span class="sourceLineNo">1438</span>                this.extinguish();<a name="line.1438"></a>
<span class="sourceLineNo">1439</span>            } else if (!this.fireProof &amp;&amp; (!(this instanceof Player) || !((Player) this).isSpectator())) {<a name="line.1439"></a>
<span class="sourceLineNo">1440</span>                this.setDataFlag(DATA_FLAGS, DATA_FLAG_ONFIRE, true);<a name="line.1440"></a>
<span class="sourceLineNo">1441</span>                hasUpdate = true;<a name="line.1441"></a>
<span class="sourceLineNo">1442</span>            }<a name="line.1442"></a>
<span class="sourceLineNo">1443</span>        }<a name="line.1443"></a>
<span class="sourceLineNo">1444</span>        if (this.noDamageTicks &gt; 0) {<a name="line.1444"></a>
<span class="sourceLineNo">1445</span>            this.noDamageTicks -= tickDiff;<a name="line.1445"></a>
<span class="sourceLineNo">1446</span>            if (this.noDamageTicks &lt; 0) {<a name="line.1446"></a>
<span class="sourceLineNo">1447</span>                this.noDamageTicks = 0;<a name="line.1447"></a>
<span class="sourceLineNo">1448</span>            }<a name="line.1448"></a>
<span class="sourceLineNo">1449</span>        }<a name="line.1449"></a>
<span class="sourceLineNo">1450</span>        if (this.inPortalTicks == 80) {<a name="line.1450"></a>
<span class="sourceLineNo">1451</span>            EntityPortalEnterEvent ev = new EntityPortalEnterEvent(this, PortalType.NETHER);<a name="line.1451"></a>
<span class="sourceLineNo">1452</span>            getServer().getPluginManager().callEvent(ev);<a name="line.1452"></a>
<span class="sourceLineNo">1453</span>            if (!ev.isCancelled() &amp;&amp; (level == EnumLevel.OVERWORLD.getLevel() || level == EnumLevel.NETHER.getLevel())) {<a name="line.1453"></a>
<span class="sourceLineNo">1454</span>                Position newPos = EnumLevel.moveToNether(this);<a name="line.1454"></a>
<span class="sourceLineNo">1455</span>                if (newPos != null) {<a name="line.1455"></a>
<span class="sourceLineNo">1456</span>                    /*for (int x = -1; x &lt; 2; x++) {<a name="line.1456"></a>
<span class="sourceLineNo">1457</span>                        for (int z = -1; z &lt; 2; z++) {<a name="line.1457"></a>
<span class="sourceLineNo">1458</span>                            int chunkX = (newPos.getFloorX() &gt;&gt; 4) + x, chunkZ = (newPos.getFloorZ() &gt;&gt; 4) + z;<a name="line.1458"></a>
<span class="sourceLineNo">1459</span>                            FullChunk chunk = newPos.level.getChunk(chunkX, chunkZ, false);<a name="line.1459"></a>
<span class="sourceLineNo">1460</span>                            if (chunk == null || !(chunk.isGenerated() || chunk.isPopulated())) {<a name="line.1460"></a>
<span class="sourceLineNo">1461</span>                                newPos.level.generateChunk(chunkX, chunkZ, true);<a name="line.1461"></a>
<span class="sourceLineNo">1462</span>                            }<a name="line.1462"></a>
<span class="sourceLineNo">1463</span>                        }<a name="line.1463"></a>
<span class="sourceLineNo">1464</span>                    }*/<a name="line.1464"></a>
<span class="sourceLineNo">1465</span>                    Position nearestPortal = getNearestValidPortal(newPos);<a name="line.1465"></a>
<span class="sourceLineNo">1466</span>                    if (nearestPortal != null) {<a name="line.1466"></a>
<span class="sourceLineNo">1467</span>                        teleport(nearestPortal.add(0.5, 0, 0.5), PlayerTeleportEvent.TeleportCause.NETHER_PORTAL);<a name="line.1467"></a>
<span class="sourceLineNo">1468</span>                    } else {<a name="line.1468"></a>
<span class="sourceLineNo">1469</span>                        final Position finalPos = newPos.add(1.5, 1, 1.5);<a name="line.1469"></a>
<span class="sourceLineNo">1470</span>                        if (teleport(finalPos, PlayerTeleportEvent.TeleportCause.NETHER_PORTAL)) {<a name="line.1470"></a>
<span class="sourceLineNo">1471</span>                            server.getScheduler().scheduleDelayedTask(new Task() {<a name="line.1471"></a>
<span class="sourceLineNo">1472</span>                                @Override<a name="line.1472"></a>
<span class="sourceLineNo">1473</span>                                public void onRun(int currentTick) {<a name="line.1473"></a>
<span class="sourceLineNo">1474</span>                                    // dirty hack to make sure chunks are loaded and generated before spawning<a name="line.1474"></a>
<span class="sourceLineNo">1475</span>                                    // player<a name="line.1475"></a>
<span class="sourceLineNo">1476</span>                                    inPortalTicks = 81;<a name="line.1476"></a>
<span class="sourceLineNo">1477</span>                                    teleport(finalPos, PlayerTeleportEvent.TeleportCause.NETHER_PORTAL);<a name="line.1477"></a>
<span class="sourceLineNo">1478</span>                                    BlockNetherPortal.spawnPortal(newPos);<a name="line.1478"></a>
<span class="sourceLineNo">1479</span>                                }<a name="line.1479"></a>
<span class="sourceLineNo">1480</span>                            }, 5);<a name="line.1480"></a>
<span class="sourceLineNo">1481</span>                        }<a name="line.1481"></a>
<span class="sourceLineNo">1482</span>                    }<a name="line.1482"></a>
<span class="sourceLineNo">1483</span>                }<a name="line.1483"></a>
<span class="sourceLineNo">1484</span>            }<a name="line.1484"></a>
<span class="sourceLineNo">1485</span>        }<a name="line.1485"></a>
<span class="sourceLineNo">1486</span>        this.age += tickDiff;<a name="line.1486"></a>
<span class="sourceLineNo">1487</span>        this.ticksLived += tickDiff;<a name="line.1487"></a>
<span class="sourceLineNo">1488</span>        TimingsHistory.activatedEntityTicks++;<a name="line.1488"></a>
<span class="sourceLineNo">1489</span>        Timings.entityBaseTickTimer.stopTiming();<a name="line.1489"></a>
<span class="sourceLineNo">1490</span>        return hasUpdate;<a name="line.1490"></a>
<span class="sourceLineNo">1491</span>    }<a name="line.1491"></a>
<span class="sourceLineNo">1492</span><a name="line.1492"></a>
<span class="sourceLineNo">1493</span>    private Position getNearestValidPortal(Position currentPos) {<a name="line.1493"></a>
<span class="sourceLineNo">1494</span>        AxisAlignedBB axisAlignedBB = new SimpleAxisAlignedBB(new Vector3(currentPos.getFloorX() - 128.0, 1.0, currentPos.getFloorZ() - 128.0), new Vector3(currentPos.getFloorX() + 128.0, currentPos.level.getDimension() == Level.DIMENSION_NETHER ? 128 : 256, currentPos.getFloorZ() + 128.0));<a name="line.1494"></a>
<span class="sourceLineNo">1495</span>        BiPredicate&lt;BlockVector3, BlockState&gt; condition = (pos, state) -&gt; state.getBlockId() == BlockID.NETHER_PORTAL;<a name="line.1495"></a>
<span class="sourceLineNo">1496</span>        List&lt;Block&gt; blocks = currentPos.level.scanBlocks(axisAlignedBB, condition);<a name="line.1496"></a>
<span class="sourceLineNo">1497</span>        if (blocks.isEmpty()) {<a name="line.1497"></a>
<span class="sourceLineNo">1498</span>            return null;<a name="line.1498"></a>
<span class="sourceLineNo">1499</span>        }<a name="line.1499"></a>
<span class="sourceLineNo">1500</span>        final Vector2 currentPosV2 = new Vector2(currentPos.getFloorX(), currentPos.getFloorZ());<a name="line.1500"></a>
<span class="sourceLineNo">1501</span>        final double by = currentPos.getFloorY();<a name="line.1501"></a>
<span class="sourceLineNo">1502</span>        Comparator&lt;Block&gt; euclideanDistance = Comparator.comparingDouble(block -&gt; currentPosV2.distanceSquared(block.getFloorX(), block.getFloorZ()));<a name="line.1502"></a>
<span class="sourceLineNo">1503</span>        Comparator&lt;Block&gt; heightDistance = Comparator.comparingDouble(block -&gt; {<a name="line.1503"></a>
<span class="sourceLineNo">1504</span>            double ey = by - block.y;<a name="line.1504"></a>
<span class="sourceLineNo">1505</span>            return ey * ey;<a name="line.1505"></a>
<span class="sourceLineNo">1506</span>        });<a name="line.1506"></a>
<span class="sourceLineNo">1507</span>        Block nearestPortal = blocks.stream().filter(block -&gt; block.down().getId() != BlockID.NETHER_PORTAL).min(euclideanDistance.thenComparing(heightDistance)).orElse(null);<a name="line.1507"></a>
<span class="sourceLineNo">1508</span>        if (nearestPortal == null) {<a name="line.1508"></a>
<span class="sourceLineNo">1509</span>            return null;<a name="line.1509"></a>
<span class="sourceLineNo">1510</span>        }<a name="line.1510"></a>
<span class="sourceLineNo">1511</span>        return nearestPortal;<a name="line.1511"></a>
<span class="sourceLineNo">1512</span>    }<a name="line.1512"></a>
<span class="sourceLineNo">1513</span><a name="line.1513"></a>
<span class="sourceLineNo">1514</span>    public void updateMovement() {<a name="line.1514"></a>
<span class="sourceLineNo">1515</span>        double diffPosition = (this.x - this.lastX) * (this.x - this.lastX) + (this.y - this.lastY) * (this.y - this.lastY) + (this.z - this.lastZ) * (this.z - this.lastZ);<a name="line.1515"></a>
<span class="sourceLineNo">1516</span>        double diffRotation = (this.yaw - this.lastYaw) * (this.yaw - this.lastYaw) + (this.pitch - this.lastPitch) * (this.pitch - this.lastPitch);<a name="line.1516"></a>
<span class="sourceLineNo">1517</span>        double diffMotion = (this.motionX - this.lastMotionX) * (this.motionX - this.lastMotionX) + (this.motionY - this.lastMotionY) * (this.motionY - this.lastMotionY) + (this.motionZ - this.lastMotionZ) * (this.motionZ - this.lastMotionZ);<a name="line.1517"></a>
<span class="sourceLineNo">1518</span>        if (diffPosition &gt; 1.0E-4 || diffRotation &gt; 1.0) {<a name="line.1518"></a>
<span class="sourceLineNo">1519</span>            //0.2 ** 2, 1.5 ** 2<a name="line.1519"></a>
<span class="sourceLineNo">1520</span>            this.lastX = this.x;<a name="line.1520"></a>
<span class="sourceLineNo">1521</span>            this.lastY = this.y;<a name="line.1521"></a>
<span class="sourceLineNo">1522</span>            this.lastZ = this.z;<a name="line.1522"></a>
<span class="sourceLineNo">1523</span>            this.lastYaw = this.yaw;<a name="line.1523"></a>
<span class="sourceLineNo">1524</span>            this.lastPitch = this.pitch;<a name="line.1524"></a>
<span class="sourceLineNo">1525</span>            this.addMovement(this.x, this.y + this.getBaseOffset(), this.z, this.yaw, this.pitch, this.yaw);<a name="line.1525"></a>
<span class="sourceLineNo">1526</span>            this.positionChanged = true;<a name="line.1526"></a>
<span class="sourceLineNo">1527</span>        } else {<a name="line.1527"></a>
<span class="sourceLineNo">1528</span>            this.positionChanged = false;<a name="line.1528"></a>
<span class="sourceLineNo">1529</span>        }<a name="line.1529"></a>
<span class="sourceLineNo">1530</span>        if (diffMotion &gt; 0.0025 || (diffMotion &gt; 1.0E-4 &amp;&amp; this.getMotion().lengthSquared() &lt;= 1.0E-4)) {<a name="line.1530"></a>
<span class="sourceLineNo">1531</span>            //0.05 ** 2<a name="line.1531"></a>
<span class="sourceLineNo">1532</span>            this.lastMotionX = this.motionX;<a name="line.1532"></a>
<span class="sourceLineNo">1533</span>            this.lastMotionY = this.motionY;<a name="line.1533"></a>
<span class="sourceLineNo">1534</span>            this.lastMotionZ = this.motionZ;<a name="line.1534"></a>
<span class="sourceLineNo">1535</span>            this.addMotion(this.motionX, this.motionY, this.motionZ);<a name="line.1535"></a>
<span class="sourceLineNo">1536</span>        }<a name="line.1536"></a>
<span class="sourceLineNo">1537</span>    }<a name="line.1537"></a>
<span class="sourceLineNo">1538</span><a name="line.1538"></a>
<span class="sourceLineNo">1539</span>    public void addMovement(double x, double y, double z, double yaw, double pitch, double headYaw) {<a name="line.1539"></a>
<span class="sourceLineNo">1540</span>        this.level.addEntityMovement(this, x, y, z, yaw, pitch, headYaw);<a name="line.1540"></a>
<span class="sourceLineNo">1541</span>    }<a name="line.1541"></a>
<span class="sourceLineNo">1542</span><a name="line.1542"></a>
<span class="sourceLineNo">1543</span>    public void addMotion(double motionX, double motionY, double motionZ) {<a name="line.1543"></a>
<span class="sourceLineNo">1544</span>        SetEntityMotionPacket pk = new SetEntityMotionPacket();<a name="line.1544"></a>
<span class="sourceLineNo">1545</span>        pk.eid = this.id;<a name="line.1545"></a>
<span class="sourceLineNo">1546</span>        pk.motionX = (float) motionX;<a name="line.1546"></a>
<span class="sourceLineNo">1547</span>        pk.motionY = (float) motionY;<a name="line.1547"></a>
<span class="sourceLineNo">1548</span>        pk.motionZ = (float) motionZ;<a name="line.1548"></a>
<span class="sourceLineNo">1549</span>        Server.broadcastPacket(this.hasSpawned.values(), pk);<a name="line.1549"></a>
<span class="sourceLineNo">1550</span>    }<a name="line.1550"></a>
<span class="sourceLineNo">1551</span><a name="line.1551"></a>
<span class="sourceLineNo">1552</span>    public Vector3 getDirectionVector() {<a name="line.1552"></a>
<span class="sourceLineNo">1553</span>        Vector3 vector = super.getDirectionVector();<a name="line.1553"></a>
<span class="sourceLineNo">1554</span>        return this.temporalVector.setComponents(vector.x, vector.y, vector.z);<a name="line.1554"></a>
<span class="sourceLineNo">1555</span>    }<a name="line.1555"></a>
<span class="sourceLineNo">1556</span><a name="line.1556"></a>
<span class="sourceLineNo">1557</span>    public Vector2 getDirectionPlane() {<a name="line.1557"></a>
<span class="sourceLineNo">1558</span>        return (new Vector2((float) (-Math.cos(Math.toRadians(this.yaw) - Math.PI / 2)), (float) (-Math.sin(Math.toRadians(this.yaw) - Math.PI / 2)))).normalize();<a name="line.1558"></a>
<span class="sourceLineNo">1559</span>    }<a name="line.1559"></a>
<span class="sourceLineNo">1560</span><a name="line.1560"></a>
<span class="sourceLineNo">1561</span>    public BlockFace getHorizontalFacing() {<a name="line.1561"></a>
<span class="sourceLineNo">1562</span>        return BlockFace.fromHorizontalIndex(NukkitMath.floorDouble((this.yaw * 4.0F / 360.0F) + 0.5) &amp; 3);<a name="line.1562"></a>
<span class="sourceLineNo">1563</span>    }<a name="line.1563"></a>
<span class="sourceLineNo">1564</span><a name="line.1564"></a>
<span class="sourceLineNo">1565</span>    public boolean onUpdate(int currentTick) {<a name="line.1565"></a>
<span class="sourceLineNo">1566</span>        if (this.closed) {<a name="line.1566"></a>
<span class="sourceLineNo">1567</span>            return false;<a name="line.1567"></a>
<span class="sourceLineNo">1568</span>        }<a name="line.1568"></a>
<span class="sourceLineNo">1569</span>        if (!this.isAlive()) {<a name="line.1569"></a>
<span class="sourceLineNo">1570</span>            ++this.deadTicks;<a name="line.1570"></a>
<span class="sourceLineNo">1571</span>            if (this.deadTicks &gt;= 10) {<a name="line.1571"></a>
<span class="sourceLineNo">1572</span>                this.despawnFromAll();<a name="line.1572"></a>
<span class="sourceLineNo">1573</span>                if (!this.isPlayer) {<a name="line.1573"></a>
<span class="sourceLineNo">1574</span>                    this.close();<a name="line.1574"></a>
<span class="sourceLineNo">1575</span>                }<a name="line.1575"></a>
<span class="sourceLineNo">1576</span>            }<a name="line.1576"></a>
<span class="sourceLineNo">1577</span>            return this.deadTicks &lt; 10;<a name="line.1577"></a>
<span class="sourceLineNo">1578</span>        }<a name="line.1578"></a>
<span class="sourceLineNo">1579</span>        int tickDiff = currentTick - this.lastUpdate;<a name="line.1579"></a>
<span class="sourceLineNo">1580</span>        if (tickDiff &lt;= 0) {<a name="line.1580"></a>
<span class="sourceLineNo">1581</span>            return false;<a name="line.1581"></a>
<span class="sourceLineNo">1582</span>        }<a name="line.1582"></a>
<span class="sourceLineNo">1583</span>        this.lastUpdate = currentTick;<a name="line.1583"></a>
<span class="sourceLineNo">1584</span>        boolean hasUpdate = this.entityBaseTick(tickDiff);<a name="line.1584"></a>
<span class="sourceLineNo">1585</span>        this.updateMovement();<a name="line.1585"></a>
<span class="sourceLineNo">1586</span>        return hasUpdate;<a name="line.1586"></a>
<span class="sourceLineNo">1587</span>    }<a name="line.1587"></a>
<span class="sourceLineNo">1588</span><a name="line.1588"></a>
<span class="sourceLineNo">1589</span>    public boolean mountEntity(Entity entity) {<a name="line.1589"></a>
<span class="sourceLineNo">1590</span>        return mountEntity(entity, TYPE_RIDE);<a name="line.1590"></a>
<span class="sourceLineNo">1591</span>    }<a name="line.1591"></a>
<span class="sourceLineNo">1592</span><a name="line.1592"></a>
<span class="sourceLineNo">1593</span>    /**<a name="line.1593"></a>
<span class="sourceLineNo">1594</span>     * Mount or Dismounts an Entity from a/into vehicle<a name="line.1594"></a>
<span class="sourceLineNo">1595</span>     *<a name="line.1595"></a>
<span class="sourceLineNo">1596</span>     * @param entity The target Entity<a name="line.1596"></a>
<span class="sourceLineNo">1597</span>     * @return {@code true} if the mounting successful<a name="line.1597"></a>
<span class="sourceLineNo">1598</span>     */<a name="line.1598"></a>
<span class="sourceLineNo">1599</span>    public boolean mountEntity(Entity entity, byte mode) {<a name="line.1599"></a>
<span class="sourceLineNo">1600</span>        Objects.requireNonNull(entity, "The target of the mounting entity can\'t be null");<a name="line.1600"></a>
<span class="sourceLineNo">1601</span>        if (entity.riding != null) {<a name="line.1601"></a>
<span class="sourceLineNo">1602</span>            dismountEntity(entity);<a name="line.1602"></a>
<span class="sourceLineNo">1603</span>        } else {<a name="line.1603"></a>
<span class="sourceLineNo">1604</span>            if (isPassenger(entity)) {<a name="line.1604"></a>
<span class="sourceLineNo">1605</span>                return false;<a name="line.1605"></a>
<span class="sourceLineNo">1606</span>            }<a name="line.1606"></a>
<span class="sourceLineNo">1607</span>            // Entity entering a vehicle<a name="line.1607"></a>
<span class="sourceLineNo">1608</span>            EntityVehicleEnterEvent ev = new EntityVehicleEnterEvent(entity, this);<a name="line.1608"></a>
<span class="sourceLineNo">1609</span>            server.getPluginManager().callEvent(ev);<a name="line.1609"></a>
<span class="sourceLineNo">1610</span>            if (ev.isCancelled()) {<a name="line.1610"></a>
<span class="sourceLineNo">1611</span>                return false;<a name="line.1611"></a>
<span class="sourceLineNo">1612</span>            }<a name="line.1612"></a>
<span class="sourceLineNo">1613</span>            broadcastLinkPacket(entity, mode);<a name="line.1613"></a>
<span class="sourceLineNo">1614</span>            // Add variables to entity<a name="line.1614"></a>
<span class="sourceLineNo">1615</span>            entity.riding = this;<a name="line.1615"></a>
<span class="sourceLineNo">1616</span>            entity.setDataFlag(DATA_FLAGS, DATA_FLAG_RIDING, true);<a name="line.1616"></a>
<span class="sourceLineNo">1617</span>            passengers.add(entity);<a name="line.1617"></a>
<span class="sourceLineNo">1618</span>            entity.setSeatPosition(getMountedOffset(entity));<a name="line.1618"></a>
<span class="sourceLineNo">1619</span>            updatePassengerPosition(entity);<a name="line.1619"></a>
<span class="sourceLineNo">1620</span>        }<a name="line.1620"></a>
<span class="sourceLineNo">1621</span>        return true;<a name="line.1621"></a>
<span class="sourceLineNo">1622</span>    }<a name="line.1622"></a>
<span class="sourceLineNo">1623</span><a name="line.1623"></a>
<span class="sourceLineNo">1624</span>    public boolean dismountEntity(Entity entity) {<a name="line.1624"></a>
<span class="sourceLineNo">1625</span>        // Run the events<a name="line.1625"></a>
<span class="sourceLineNo">1626</span>        EntityVehicleExitEvent ev = new EntityVehicleExitEvent(entity, this);<a name="line.1626"></a>
<span class="sourceLineNo">1627</span>        server.getPluginManager().callEvent(ev);<a name="line.1627"></a>
<span class="sourceLineNo">1628</span>        if (ev.isCancelled()) {<a name="line.1628"></a>
<span class="sourceLineNo">1629</span>            return false;<a name="line.1629"></a>
<span class="sourceLineNo">1630</span>        }<a name="line.1630"></a>
<span class="sourceLineNo">1631</span>        broadcastLinkPacket(entity, TYPE_REMOVE);<a name="line.1631"></a>
<span class="sourceLineNo">1632</span>        // Refurbish the entity<a name="line.1632"></a>
<span class="sourceLineNo">1633</span>        entity.riding = null;<a name="line.1633"></a>
<span class="sourceLineNo">1634</span>        entity.setDataFlag(DATA_FLAGS, DATA_FLAG_RIDING, false);<a name="line.1634"></a>
<span class="sourceLineNo">1635</span>        passengers.remove(entity);<a name="line.1635"></a>
<span class="sourceLineNo">1636</span>        entity.setSeatPosition(new Vector3f());<a name="line.1636"></a>
<span class="sourceLineNo">1637</span>        updatePassengerPosition(entity);<a name="line.1637"></a>
<span class="sourceLineNo">1638</span>        return true;<a name="line.1638"></a>
<span class="sourceLineNo">1639</span>    }<a name="line.1639"></a>
<span class="sourceLineNo">1640</span><a name="line.1640"></a>
<span class="sourceLineNo">1641</span>    protected void broadcastLinkPacket(Entity rider, byte type) {<a name="line.1641"></a>
<span class="sourceLineNo">1642</span>        SetEntityLinkPacket pk = new SetEntityLinkPacket();<a name="line.1642"></a>
<span class="sourceLineNo">1643</span>        pk.vehicleUniqueId = getId(); // To the?<a name="line.1643"></a>
<span class="sourceLineNo">1644</span>        pk.riderUniqueId = rider.getId(); // From who?<a name="line.1644"></a>
<span class="sourceLineNo">1645</span>        pk.type = type;<a name="line.1645"></a>
<span class="sourceLineNo">1646</span>        Server.broadcastPacket(this.hasSpawned.values(), pk);<a name="line.1646"></a>
<span class="sourceLineNo">1647</span>    }<a name="line.1647"></a>
<span class="sourceLineNo">1648</span><a name="line.1648"></a>
<span class="sourceLineNo">1649</span>    public void updatePassengers() {<a name="line.1649"></a>
<span class="sourceLineNo">1650</span>        if (this.passengers.isEmpty()) {<a name="line.1650"></a>
<span class="sourceLineNo">1651</span>            return;<a name="line.1651"></a>
<span class="sourceLineNo">1652</span>        }<a name="line.1652"></a>
<span class="sourceLineNo">1653</span>        for (Entity passenger : new ArrayList&lt;&gt;(this.passengers)) {<a name="line.1653"></a>
<span class="sourceLineNo">1654</span>            if (!passenger.isAlive()) {<a name="line.1654"></a>
<span class="sourceLineNo">1655</span>                dismountEntity(passenger);<a name="line.1655"></a>
<span class="sourceLineNo">1656</span>                continue;<a name="line.1656"></a>
<span class="sourceLineNo">1657</span>            }<a name="line.1657"></a>
<span class="sourceLineNo">1658</span>            updatePassengerPosition(passenger);<a name="line.1658"></a>
<span class="sourceLineNo">1659</span>        }<a name="line.1659"></a>
<span class="sourceLineNo">1660</span>    }<a name="line.1660"></a>
<span class="sourceLineNo">1661</span><a name="line.1661"></a>
<span class="sourceLineNo">1662</span>    protected void updatePassengerPosition(Entity passenger) {<a name="line.1662"></a>
<span class="sourceLineNo">1663</span>        passenger.setPosition(this.add(passenger.getSeatPosition().asVector3()));<a name="line.1663"></a>
<span class="sourceLineNo">1664</span>    }<a name="line.1664"></a>
<span class="sourceLineNo">1665</span><a name="line.1665"></a>
<span class="sourceLineNo">1666</span>    public void setSeatPosition(Vector3f pos) {<a name="line.1666"></a>
<span class="sourceLineNo">1667</span>        this.setDataProperty(new Vector3fEntityData(DATA_RIDER_SEAT_POSITION, pos));<a name="line.1667"></a>
<span class="sourceLineNo">1668</span>    }<a name="line.1668"></a>
<span class="sourceLineNo">1669</span><a name="line.1669"></a>
<span class="sourceLineNo">1670</span>    public Vector3f getSeatPosition() {<a name="line.1670"></a>
<span class="sourceLineNo">1671</span>        return this.getDataPropertyVector3f(DATA_RIDER_SEAT_POSITION);<a name="line.1671"></a>
<span class="sourceLineNo">1672</span>    }<a name="line.1672"></a>
<span class="sourceLineNo">1673</span><a name="line.1673"></a>
<span class="sourceLineNo">1674</span>    public Vector3f getMountedOffset(Entity entity) {<a name="line.1674"></a>
<span class="sourceLineNo">1675</span>        return new Vector3f(0, getHeight() * 0.75F);<a name="line.1675"></a>
<span class="sourceLineNo">1676</span>    }<a name="line.1676"></a>
<span class="sourceLineNo">1677</span><a name="line.1677"></a>
<span class="sourceLineNo">1678</span>    public final void scheduleUpdate() {<a name="line.1678"></a>
<span class="sourceLineNo">1679</span>        this.level.updateEntities.put(this.id, this);<a name="line.1679"></a>
<span class="sourceLineNo">1680</span>    }<a name="line.1680"></a>
<span class="sourceLineNo">1681</span><a name="line.1681"></a>
<span class="sourceLineNo">1682</span>    public boolean isOnFire() {<a name="line.1682"></a>
<span class="sourceLineNo">1683</span>        return this.fireTicks &gt; 0;<a name="line.1683"></a>
<span class="sourceLineNo">1684</span>    }<a name="line.1684"></a>
<span class="sourceLineNo">1685</span><a name="line.1685"></a>
<span class="sourceLineNo">1686</span>    public void setOnFire(int seconds) {<a name="line.1686"></a>
<span class="sourceLineNo">1687</span>        int ticks = seconds * 20;<a name="line.1687"></a>
<span class="sourceLineNo">1688</span>        if (ticks &gt; this.fireTicks) {<a name="line.1688"></a>
<span class="sourceLineNo">1689</span>            this.fireTicks = ticks;<a name="line.1689"></a>
<span class="sourceLineNo">1690</span>        }<a name="line.1690"></a>
<span class="sourceLineNo">1691</span>    }<a name="line.1691"></a>
<span class="sourceLineNo">1692</span><a name="line.1692"></a>
<span class="sourceLineNo">1693</span>    public float getAbsorption() {<a name="line.1693"></a>
<span class="sourceLineNo">1694</span>        return absorption;<a name="line.1694"></a>
<span class="sourceLineNo">1695</span>    }<a name="line.1695"></a>
<span class="sourceLineNo">1696</span><a name="line.1696"></a>
<span class="sourceLineNo">1697</span>    public void setAbsorption(float absorption) {<a name="line.1697"></a>
<span class="sourceLineNo">1698</span>        if (absorption != this.absorption) {<a name="line.1698"></a>
<span class="sourceLineNo">1699</span>            this.absorption = absorption;<a name="line.1699"></a>
<span class="sourceLineNo">1700</span>            if (this instanceof Player) ((Player) this).setAttribute(Attribute.getAttribute(Attribute.ABSORPTION).setValue(absorption));<a name="line.1700"></a>
<span class="sourceLineNo">1701</span>        }<a name="line.1701"></a>
<span class="sourceLineNo">1702</span>    }<a name="line.1702"></a>
<span class="sourceLineNo">1703</span><a name="line.1703"></a>
<span class="sourceLineNo">1704</span>    public boolean canBePushed() {<a name="line.1704"></a>
<span class="sourceLineNo">1705</span>        return true;<a name="line.1705"></a>
<span class="sourceLineNo">1706</span>    }<a name="line.1706"></a>
<span class="sourceLineNo">1707</span><a name="line.1707"></a>
<span class="sourceLineNo">1708</span>    public BlockFace getDirection() {<a name="line.1708"></a>
<span class="sourceLineNo">1709</span>        double rotation = this.yaw % 360;<a name="line.1709"></a>
<span class="sourceLineNo">1710</span>        if (rotation &lt; 0) {<a name="line.1710"></a>
<span class="sourceLineNo">1711</span>            rotation += 360.0;<a name="line.1711"></a>
<span class="sourceLineNo">1712</span>        }<a name="line.1712"></a>
<span class="sourceLineNo">1713</span>        if ((0 &lt;= rotation &amp;&amp; rotation &lt; 45) || (315 &lt;= rotation &amp;&amp; rotation &lt; 360)) {<a name="line.1713"></a>
<span class="sourceLineNo">1714</span>            return BlockFace.SOUTH;<a name="line.1714"></a>
<span class="sourceLineNo">1715</span>        } else if (45 &lt;= rotation &amp;&amp; rotation &lt; 135) {<a name="line.1715"></a>
<span class="sourceLineNo">1716</span>            return BlockFace.WEST;<a name="line.1716"></a>
<span class="sourceLineNo">1717</span>        } else if (135 &lt;= rotation &amp;&amp; rotation &lt; 225) {<a name="line.1717"></a>
<span class="sourceLineNo">1718</span>            return BlockFace.NORTH;<a name="line.1718"></a>
<span class="sourceLineNo">1719</span>        } else if (225 &lt;= rotation &amp;&amp; rotation &lt; 315) {<a name="line.1719"></a>
<span class="sourceLineNo">1720</span>            return BlockFace.EAST;<a name="line.1720"></a>
<span class="sourceLineNo">1721</span>        } else {<a name="line.1721"></a>
<span class="sourceLineNo">1722</span>            return null;<a name="line.1722"></a>
<span class="sourceLineNo">1723</span>        }<a name="line.1723"></a>
<span class="sourceLineNo">1724</span>    }<a name="line.1724"></a>
<span class="sourceLineNo">1725</span><a name="line.1725"></a>
<span class="sourceLineNo">1726</span>    public void extinguish() {<a name="line.1726"></a>
<span class="sourceLineNo">1727</span>        this.fireTicks = 0;<a name="line.1727"></a>
<span class="sourceLineNo">1728</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_ONFIRE, false);<a name="line.1728"></a>
<span class="sourceLineNo">1729</span>    }<a name="line.1729"></a>
<span class="sourceLineNo">1730</span><a name="line.1730"></a>
<span class="sourceLineNo">1731</span>    public boolean canTriggerWalking() {<a name="line.1731"></a>
<span class="sourceLineNo">1732</span>        return true;<a name="line.1732"></a>
<span class="sourceLineNo">1733</span>    }<a name="line.1733"></a>
<span class="sourceLineNo">1734</span><a name="line.1734"></a>
<span class="sourceLineNo">1735</span>    public void resetFallDistance() {<a name="line.1735"></a>
<span class="sourceLineNo">1736</span>        this.highestPosition = 0;<a name="line.1736"></a>
<span class="sourceLineNo">1737</span>    }<a name="line.1737"></a>
<span class="sourceLineNo">1738</span><a name="line.1738"></a>
<span class="sourceLineNo">1739</span>    protected void updateFallState(boolean onGround) {<a name="line.1739"></a>
<span class="sourceLineNo">1740</span>        if (onGround) {<a name="line.1740"></a>
<span class="sourceLineNo">1741</span>            fallDistance = (float) (this.highestPosition - this.y);<a name="line.1741"></a>
<span class="sourceLineNo">1742</span>            if (fallDistance &gt; 0) {<a name="line.1742"></a>
<span class="sourceLineNo">1743</span>                // check if we fell into at least 1 block of water<a name="line.1743"></a>
<span class="sourceLineNo">1744</span>                if (this instanceof EntityLiving &amp;&amp; !(this.getLevelBlock() instanceof BlockWater)) {<a name="line.1744"></a>
<span class="sourceLineNo">1745</span>                    this.fall(fallDistance);<a name="line.1745"></a>
<span class="sourceLineNo">1746</span>                }<a name="line.1746"></a>
<span class="sourceLineNo">1747</span>                this.resetFallDistance();<a name="line.1747"></a>
<span class="sourceLineNo">1748</span>            }<a name="line.1748"></a>
<span class="sourceLineNo">1749</span>        }<a name="line.1749"></a>
<span class="sourceLineNo">1750</span>    }<a name="line.1750"></a>
<span class="sourceLineNo">1751</span><a name="line.1751"></a>
<span class="sourceLineNo">1752</span>    public AxisAlignedBB getBoundingBox() {<a name="line.1752"></a>
<span class="sourceLineNo">1753</span>        return this.boundingBox;<a name="line.1753"></a>
<span class="sourceLineNo">1754</span>    }<a name="line.1754"></a>
<span class="sourceLineNo">1755</span><a name="line.1755"></a>
<span class="sourceLineNo">1756</span>    public void fall(float fallDistance) {<a name="line.1756"></a>
<span class="sourceLineNo">1757</span>        if (this.hasEffect(Effect.SLOW_FALLING)) {<a name="line.1757"></a>
<span class="sourceLineNo">1758</span>            return;<a name="line.1758"></a>
<span class="sourceLineNo">1759</span>        }<a name="line.1759"></a>
<span class="sourceLineNo">1760</span>        float damage = (float) Math.floor(fallDistance - 3 - (this.hasEffect(Effect.JUMP) ? this.getEffect(Effect.JUMP).getAmplifier() + 1 : 0));<a name="line.1760"></a>
<span class="sourceLineNo">1761</span>        Location floorLocation = this.floor();<a name="line.1761"></a>
<span class="sourceLineNo">1762</span>        Block down = this.level.getBlock(floorLocation.down());<a name="line.1762"></a>
<span class="sourceLineNo">1763</span>        if (damage &gt; 0) {<a name="line.1763"></a>
<span class="sourceLineNo">1764</span>            if (down instanceof BlockHayBale) {<a name="line.1764"></a>
<span class="sourceLineNo">1765</span>                damage -= (damage * 0.8F);<a name="line.1765"></a>
<span class="sourceLineNo">1766</span>            }<a name="line.1766"></a>
<span class="sourceLineNo">1767</span>            if (down.getId() == BlockID.HONEY_BLOCK) {<a name="line.1767"></a>
<span class="sourceLineNo">1768</span>                damage *= 0.2F;<a name="line.1768"></a>
<span class="sourceLineNo">1769</span>            }<a name="line.1769"></a>
<span class="sourceLineNo">1770</span>            if (!this.isPlayer || level.getGameRules().getBoolean(GameRule.FALL_DAMAGE)) {<a name="line.1770"></a>
<span class="sourceLineNo">1771</span>                this.attack(new EntityDamageEvent(this, DamageCause.FALL, damage));<a name="line.1771"></a>
<span class="sourceLineNo">1772</span>            }<a name="line.1772"></a>
<span class="sourceLineNo">1773</span>        }<a name="line.1773"></a>
<span class="sourceLineNo">1774</span>        if (fallDistance &gt; 0.75) {<a name="line.1774"></a>
<span class="sourceLineNo">1775</span>            if (down.getId() == Block.FARMLAND) {<a name="line.1775"></a>
<span class="sourceLineNo">1776</span>                if (onPhysicalInteraction(down, false)) {<a name="line.1776"></a>
<span class="sourceLineNo">1777</span>                    return;<a name="line.1777"></a>
<span class="sourceLineNo">1778</span>                }<a name="line.1778"></a>
<span class="sourceLineNo">1779</span>                this.level.setBlock(down, new BlockDirt(), false, true);<a name="line.1779"></a>
<span class="sourceLineNo">1780</span>                return;<a name="line.1780"></a>
<span class="sourceLineNo">1781</span>            }<a name="line.1781"></a>
<span class="sourceLineNo">1782</span>            Block floor = this.level.getBlock(floorLocation);<a name="line.1782"></a>
<span class="sourceLineNo">1783</span>            if (floor instanceof BlockTurtleEgg) {<a name="line.1783"></a>
<span class="sourceLineNo">1784</span>                if (onPhysicalInteraction(floor, ThreadLocalRandom.current().nextInt(10) &gt;= 3)) {<a name="line.1784"></a>
<span class="sourceLineNo">1785</span>                    return;<a name="line.1785"></a>
<span class="sourceLineNo">1786</span>                }<a name="line.1786"></a>
<span class="sourceLineNo">1787</span>                this.level.useBreakOn(this, null, null, true);<a name="line.1787"></a>
<span class="sourceLineNo">1788</span>            }<a name="line.1788"></a>
<span class="sourceLineNo">1789</span>        }<a name="line.1789"></a>
<span class="sourceLineNo">1790</span>    }<a name="line.1790"></a>
<span class="sourceLineNo">1791</span><a name="line.1791"></a>
<span class="sourceLineNo">1792</span>    private boolean onPhysicalInteraction(Block block, boolean cancelled) {<a name="line.1792"></a>
<span class="sourceLineNo">1793</span>        Event ev;<a name="line.1793"></a>
<span class="sourceLineNo">1794</span>        if (this instanceof Player) {<a name="line.1794"></a>
<span class="sourceLineNo">1795</span>            ev = new PlayerInteractEvent((Player) this, null, block, null, Action.PHYSICAL);<a name="line.1795"></a>
<span class="sourceLineNo">1796</span>        } else {<a name="line.1796"></a>
<span class="sourceLineNo">1797</span>            ev = new EntityInteractEvent(this, block);<a name="line.1797"></a>
<span class="sourceLineNo">1798</span>        }<a name="line.1798"></a>
<span class="sourceLineNo">1799</span>        ev.setCancelled(cancelled);<a name="line.1799"></a>
<span class="sourceLineNo">1800</span>        this.server.getPluginManager().callEvent(ev);<a name="line.1800"></a>
<span class="sourceLineNo">1801</span>        return ev.isCancelled();<a name="line.1801"></a>
<span class="sourceLineNo">1802</span>    }<a name="line.1802"></a>
<span class="sourceLineNo">1803</span><a name="line.1803"></a>
<span class="sourceLineNo">1804</span>    public void handleLavaMovement() {<a name="line.1804"></a>
<span class="sourceLineNo">1805</span>        //todo<a name="line.1805"></a>
<span class="sourceLineNo">1806</span>    }<a name="line.1806"></a>
<span class="sourceLineNo">1807</span><a name="line.1807"></a>
<span class="sourceLineNo">1808</span>    public void moveFlying(float strafe, float forward, float friction) {<a name="line.1808"></a>
<span class="sourceLineNo">1809</span>        // This is special for Nukkit! :)<a name="line.1809"></a>
<span class="sourceLineNo">1810</span>        float speed = strafe * strafe + forward * forward;<a name="line.1810"></a>
<span class="sourceLineNo">1811</span>        if (speed &gt;= 1.0E-4F) {<a name="line.1811"></a>
<span class="sourceLineNo">1812</span>            speed = MathHelper.sqrt(speed);<a name="line.1812"></a>
<span class="sourceLineNo">1813</span>            if (speed &lt; 1.0F) {<a name="line.1813"></a>
<span class="sourceLineNo">1814</span>                speed = 1.0F;<a name="line.1814"></a>
<span class="sourceLineNo">1815</span>            }<a name="line.1815"></a>
<span class="sourceLineNo">1816</span>            speed = friction / speed;<a name="line.1816"></a>
<span class="sourceLineNo">1817</span>            strafe *= speed;<a name="line.1817"></a>
<span class="sourceLineNo">1818</span>            forward *= speed;<a name="line.1818"></a>
<span class="sourceLineNo">1819</span>            float nest = MathHelper.sin((float) (this.yaw * 3.1415927F / 180.0F));<a name="line.1819"></a>
<span class="sourceLineNo">1820</span>            float place = MathHelper.cos((float) (this.yaw * 3.1415927F / 180.0F));<a name="line.1820"></a>
<span class="sourceLineNo">1821</span>            this.motionX += strafe * place - forward * nest;<a name="line.1821"></a>
<span class="sourceLineNo">1822</span>            this.motionZ += forward * place + strafe * nest;<a name="line.1822"></a>
<span class="sourceLineNo">1823</span>        }<a name="line.1823"></a>
<span class="sourceLineNo">1824</span>    }<a name="line.1824"></a>
<span class="sourceLineNo">1825</span><a name="line.1825"></a>
<span class="sourceLineNo">1826</span>    public void onCollideWithPlayer(EntityHuman entityPlayer) {<a name="line.1826"></a>
<span class="sourceLineNo">1827</span>    }<a name="line.1827"></a>
<span class="sourceLineNo">1828</span><a name="line.1828"></a>
<span class="sourceLineNo">1829</span>    public void applyEntityCollision(Entity entity) {<a name="line.1829"></a>
<span class="sourceLineNo">1830</span>        if (entity.riding != this &amp;&amp; !entity.passengers.contains(this)) {<a name="line.1830"></a>
<span class="sourceLineNo">1831</span>            double dx = entity.x - this.x;<a name="line.1831"></a>
<span class="sourceLineNo">1832</span>            double dy = entity.z - this.z;<a name="line.1832"></a>
<span class="sourceLineNo">1833</span>            double dz = NukkitMath.getDirection(dx, dy);<a name="line.1833"></a>
<span class="sourceLineNo">1834</span>            if (dz &gt;= 0.009999999776482582) {<a name="line.1834"></a>
<span class="sourceLineNo">1835</span>                dz = MathHelper.sqrt((float) dz);<a name="line.1835"></a>
<span class="sourceLineNo">1836</span>                dx /= dz;<a name="line.1836"></a>
<span class="sourceLineNo">1837</span>                dy /= dz;<a name="line.1837"></a>
<span class="sourceLineNo">1838</span>                double d3 = 1.0 / dz;<a name="line.1838"></a>
<span class="sourceLineNo">1839</span>                if (d3 &gt; 1.0) {<a name="line.1839"></a>
<span class="sourceLineNo">1840</span>                    d3 = 1.0;<a name="line.1840"></a>
<span class="sourceLineNo">1841</span>                }<a name="line.1841"></a>
<span class="sourceLineNo">1842</span>                dx *= d3;<a name="line.1842"></a>
<span class="sourceLineNo">1843</span>                dy *= d3;<a name="line.1843"></a>
<span class="sourceLineNo">1844</span>                dx *= 0.05000000074505806;<a name="line.1844"></a>
<span class="sourceLineNo">1845</span>                dy *= 0.05000000074505806;<a name="line.1845"></a>
<span class="sourceLineNo">1846</span>                dx *= 1.0F + entityCollisionReduction;<a name="line.1846"></a>
<span class="sourceLineNo">1847</span>                if (this.riding == null) {<a name="line.1847"></a>
<span class="sourceLineNo">1848</span>                    motionX -= dx;<a name="line.1848"></a>
<span class="sourceLineNo">1849</span>                    motionZ -= dy;<a name="line.1849"></a>
<span class="sourceLineNo">1850</span>                }<a name="line.1850"></a>
<span class="sourceLineNo">1851</span>            }<a name="line.1851"></a>
<span class="sourceLineNo">1852</span>        }<a name="line.1852"></a>
<span class="sourceLineNo">1853</span>    }<a name="line.1853"></a>
<span class="sourceLineNo">1854</span><a name="line.1854"></a>
<span class="sourceLineNo">1855</span>    public void onStruckByLightning(Entity entity) {<a name="line.1855"></a>
<span class="sourceLineNo">1856</span>        if (this.attack(new EntityDamageByEntityEvent(entity, this, DamageCause.LIGHTNING, 5))) {<a name="line.1856"></a>
<span class="sourceLineNo">1857</span>            if (this.fireTicks &lt; 8 * 20) {<a name="line.1857"></a>
<span class="sourceLineNo">1858</span>                this.setOnFire(8);<a name="line.1858"></a>
<span class="sourceLineNo">1859</span>            }<a name="line.1859"></a>
<span class="sourceLineNo">1860</span>        }<a name="line.1860"></a>
<span class="sourceLineNo">1861</span>    }<a name="line.1861"></a>
<span class="sourceLineNo">1862</span><a name="line.1862"></a>
<span class="sourceLineNo">1863</span>    public void onPushByPiston(BlockEntityPistonArm piston) {<a name="line.1863"></a>
<span class="sourceLineNo">1864</span>    }<a name="line.1864"></a>
<span class="sourceLineNo">1865</span><a name="line.1865"></a>
<span class="sourceLineNo">1866</span>    public boolean onInteract(Player player, Item item, Vector3 clickedPos) {<a name="line.1866"></a>
<span class="sourceLineNo">1867</span>        return onInteract(player, item);<a name="line.1867"></a>
<span class="sourceLineNo">1868</span>    }<a name="line.1868"></a>
<span class="sourceLineNo">1869</span><a name="line.1869"></a>
<span class="sourceLineNo">1870</span>    public boolean onInteract(Player player, Item item) {<a name="line.1870"></a>
<span class="sourceLineNo">1871</span>        return false;<a name="line.1871"></a>
<span class="sourceLineNo">1872</span>    }<a name="line.1872"></a>
<span class="sourceLineNo">1873</span><a name="line.1873"></a>
<span class="sourceLineNo">1874</span>    protected boolean switchLevel(Level targetLevel) {<a name="line.1874"></a>
<span class="sourceLineNo">1875</span>        if (this.closed) {<a name="line.1875"></a>
<span class="sourceLineNo">1876</span>            return false;<a name="line.1876"></a>
<span class="sourceLineNo">1877</span>        }<a name="line.1877"></a>
<span class="sourceLineNo">1878</span>        if (this.isValid()) {<a name="line.1878"></a>
<span class="sourceLineNo">1879</span>            EntityLevelChangeEvent ev = new EntityLevelChangeEvent(this, this.level, targetLevel);<a name="line.1879"></a>
<span class="sourceLineNo">1880</span>            this.server.getPluginManager().callEvent(ev);<a name="line.1880"></a>
<span class="sourceLineNo">1881</span>            if (ev.isCancelled()) {<a name="line.1881"></a>
<span class="sourceLineNo">1882</span>                return false;<a name="line.1882"></a>
<span class="sourceLineNo">1883</span>            }<a name="line.1883"></a>
<span class="sourceLineNo">1884</span>            this.level.removeEntity(this);<a name="line.1884"></a>
<span class="sourceLineNo">1885</span>            if (this.chunk != null) {<a name="line.1885"></a>
<span class="sourceLineNo">1886</span>                this.chunk.removeEntity(this);<a name="line.1886"></a>
<span class="sourceLineNo">1887</span>            }<a name="line.1887"></a>
<span class="sourceLineNo">1888</span>            this.despawnFromAll();<a name="line.1888"></a>
<span class="sourceLineNo">1889</span>        }<a name="line.1889"></a>
<span class="sourceLineNo">1890</span>        this.setLevel(targetLevel);<a name="line.1890"></a>
<span class="sourceLineNo">1891</span>        this.level.addEntity(this);<a name="line.1891"></a>
<span class="sourceLineNo">1892</span>        this.chunk = null;<a name="line.1892"></a>
<span class="sourceLineNo">1893</span>        return true;<a name="line.1893"></a>
<span class="sourceLineNo">1894</span>    }<a name="line.1894"></a>
<span class="sourceLineNo">1895</span><a name="line.1895"></a>
<span class="sourceLineNo">1896</span>    public Position getPosition() {<a name="line.1896"></a>
<span class="sourceLineNo">1897</span>        return new Position(this.x, this.y, this.z, this.level);<a name="line.1897"></a>
<span class="sourceLineNo">1898</span>    }<a name="line.1898"></a>
<span class="sourceLineNo">1899</span><a name="line.1899"></a>
<span class="sourceLineNo">1900</span>    @Nonnull<a name="line.1900"></a>
<span class="sourceLineNo">1901</span>    public Location getLocation() {<a name="line.1901"></a>
<span class="sourceLineNo">1902</span>        return new Location(this.x, this.y, this.z, this.yaw, this.pitch, this.level);<a name="line.1902"></a>
<span class="sourceLineNo">1903</span>    }<a name="line.1903"></a>
<span class="sourceLineNo">1904</span><a name="line.1904"></a>
<span class="sourceLineNo">1905</span>    public boolean isTouchingWater() {<a name="line.1905"></a>
<span class="sourceLineNo">1906</span>        return hasWaterAt(0) || hasWaterAt(this.getEyeHeight());<a name="line.1906"></a>
<span class="sourceLineNo">1907</span>    }<a name="line.1907"></a>
<span class="sourceLineNo">1908</span><a name="line.1908"></a>
<span class="sourceLineNo">1909</span>    public boolean isInsideOfWater() {<a name="line.1909"></a>
<span class="sourceLineNo">1910</span>        return hasWaterAt(this.getEyeHeight());<a name="line.1910"></a>
<span class="sourceLineNo">1911</span>    }<a name="line.1911"></a>
<span class="sourceLineNo">1912</span><a name="line.1912"></a>
<span class="sourceLineNo">1913</span>    @PowerNukkitOnly<a name="line.1913"></a>
<span class="sourceLineNo">1914</span>    @Since("1.4.0.0-PN")<a name="line.1914"></a>
<span class="sourceLineNo">1915</span>    protected boolean hasWaterAt(float height) {<a name="line.1915"></a>
<span class="sourceLineNo">1916</span>        double y = this.y + height;<a name="line.1916"></a>
<span class="sourceLineNo">1917</span>        Block block = this.level.getBlock(this.temporalVector.setComponents(NukkitMath.floorDouble(this.x), NukkitMath.floorDouble(y), NukkitMath.floorDouble(this.z)));<a name="line.1917"></a>
<span class="sourceLineNo">1918</span>        boolean layer1 = false;<a name="line.1918"></a>
<span class="sourceLineNo">1919</span>        if (!(block instanceof BlockBubbleColumn) &amp;&amp; (block instanceof BlockWater || (layer1 = block.getLevelBlockAtLayer(1) instanceof BlockWater))) {<a name="line.1919"></a>
<span class="sourceLineNo">1920</span>            BlockWater water = (BlockWater) (layer1 ? block.getLevelBlockAtLayer(1) : block);<a name="line.1920"></a>
<span class="sourceLineNo">1921</span>            double f = (block.y + 1) - (water.getFluidHeightPercent() - 0.1111111);<a name="line.1921"></a>
<span class="sourceLineNo">1922</span>            return y &lt; f;<a name="line.1922"></a>
<span class="sourceLineNo">1923</span>        }<a name="line.1923"></a>
<span class="sourceLineNo">1924</span>        return false;<a name="line.1924"></a>
<span class="sourceLineNo">1925</span>    }<a name="line.1925"></a>
<span class="sourceLineNo">1926</span><a name="line.1926"></a>
<span class="sourceLineNo">1927</span>    public boolean isInsideOfSolid() {<a name="line.1927"></a>
<span class="sourceLineNo">1928</span>        double y = this.y + this.getEyeHeight();<a name="line.1928"></a>
<span class="sourceLineNo">1929</span>        Block block = this.level.getBlock(this.temporalVector.setComponents(NukkitMath.floorDouble(this.x), NukkitMath.floorDouble(y), NukkitMath.floorDouble(this.z)));<a name="line.1929"></a>
<span class="sourceLineNo">1930</span>        AxisAlignedBB bb = block.getBoundingBox();<a name="line.1930"></a>
<span class="sourceLineNo">1931</span>        return bb != null &amp;&amp; block.isSolid() &amp;&amp; !block.isTransparent() &amp;&amp; bb.intersectsWith(this.getBoundingBox());<a name="line.1931"></a>
<span class="sourceLineNo">1932</span>    }<a name="line.1932"></a>
<span class="sourceLineNo">1933</span><a name="line.1933"></a>
<span class="sourceLineNo">1934</span>    public boolean isInsideOfFire() {<a name="line.1934"></a>
<span class="sourceLineNo">1935</span>        for (Block block : this.getCollisionBlocks()) {<a name="line.1935"></a>
<span class="sourceLineNo">1936</span>            if (block instanceof BlockFire) {<a name="line.1936"></a>
<span class="sourceLineNo">1937</span>                return true;<a name="line.1937"></a>
<span class="sourceLineNo">1938</span>            }<a name="line.1938"></a>
<span class="sourceLineNo">1939</span>        }<a name="line.1939"></a>
<span class="sourceLineNo">1940</span>        return false;<a name="line.1940"></a>
<span class="sourceLineNo">1941</span>    }<a name="line.1941"></a>
<span class="sourceLineNo">1942</span><a name="line.1942"></a>
<span class="sourceLineNo">1943</span>    @PowerNukkitOnly<a name="line.1943"></a>
<span class="sourceLineNo">1944</span>    @Since("1.4.0.0-PN")<a name="line.1944"></a>
<span class="sourceLineNo">1945</span>    public &lt;T extends Block&gt; boolean collideWithBlock(Class&lt;T&gt; classType) {<a name="line.1945"></a>
<span class="sourceLineNo">1946</span>        for (Block block : this.getCollisionBlocks()) {<a name="line.1946"></a>
<span class="sourceLineNo">1947</span>            if (classType.isInstance(block)) {<a name="line.1947"></a>
<span class="sourceLineNo">1948</span>                return true;<a name="line.1948"></a>
<span class="sourceLineNo">1949</span>            }<a name="line.1949"></a>
<span class="sourceLineNo">1950</span>        }<a name="line.1950"></a>
<span class="sourceLineNo">1951</span>        return false;<a name="line.1951"></a>
<span class="sourceLineNo">1952</span>    }<a name="line.1952"></a>
<span class="sourceLineNo">1953</span><a name="line.1953"></a>
<span class="sourceLineNo">1954</span>    @PowerNukkitOnly<a name="line.1954"></a>
<span class="sourceLineNo">1955</span>    @Since("1.4.0.0-PN")<a name="line.1955"></a>
<span class="sourceLineNo">1956</span>    public boolean isInsideOfLava() {<a name="line.1956"></a>
<span class="sourceLineNo">1957</span>        for (Block block : this.getCollisionBlocks()) {<a name="line.1957"></a>
<span class="sourceLineNo">1958</span>            if (block instanceof BlockLava) {<a name="line.1958"></a>
<span class="sourceLineNo">1959</span>                return true;<a name="line.1959"></a>
<span class="sourceLineNo">1960</span>            }<a name="line.1960"></a>
<span class="sourceLineNo">1961</span>        }<a name="line.1961"></a>
<span class="sourceLineNo">1962</span>        return false;<a name="line.1962"></a>
<span class="sourceLineNo">1963</span>    }<a name="line.1963"></a>
<span class="sourceLineNo">1964</span><a name="line.1964"></a>
<span class="sourceLineNo">1965</span>    public boolean isOnLadder() {<a name="line.1965"></a>
<span class="sourceLineNo">1966</span>        Block b = this.getLevelBlock();<a name="line.1966"></a>
<span class="sourceLineNo">1967</span>        return b.getId() == Block.LADDER;<a name="line.1967"></a>
<span class="sourceLineNo">1968</span>    }<a name="line.1968"></a>
<span class="sourceLineNo">1969</span><a name="line.1969"></a>
<span class="sourceLineNo">1970</span>    public boolean fastMove(double dx, double dy, double dz) {<a name="line.1970"></a>
<span class="sourceLineNo">1971</span>        if (dx == 0 &amp;&amp; dy == 0 &amp;&amp; dz == 0) {<a name="line.1971"></a>
<span class="sourceLineNo">1972</span>            return true;<a name="line.1972"></a>
<span class="sourceLineNo">1973</span>        }<a name="line.1973"></a>
<span class="sourceLineNo">1974</span>        Timings.entityMoveTimer.startTiming();<a name="line.1974"></a>
<span class="sourceLineNo">1975</span>        AxisAlignedBB newBB = this.boundingBox.getOffsetBoundingBox(dx, dy, dz);<a name="line.1975"></a>
<span class="sourceLineNo">1976</span>        if (server.getAllowFlight() || isPlayer &amp;&amp; ((Player) this).getAdventureSettings().get(AdventureSettings.Type.NO_CLIP) || !this.level.hasCollision(this, newBB, false)) {<a name="line.1976"></a>
<span class="sourceLineNo">1977</span>            this.boundingBox = newBB;<a name="line.1977"></a>
<span class="sourceLineNo">1978</span>        }<a name="line.1978"></a>
<span class="sourceLineNo">1979</span>        this.x = (this.boundingBox.getMinX() + this.boundingBox.getMaxX()) / 2;<a name="line.1979"></a>
<span class="sourceLineNo">1980</span>        this.y = this.boundingBox.getMinY() - this.ySize;<a name="line.1980"></a>
<span class="sourceLineNo">1981</span>        this.z = (this.boundingBox.getMinZ() + this.boundingBox.getMaxZ()) / 2;<a name="line.1981"></a>
<span class="sourceLineNo">1982</span>        this.checkChunks();<a name="line.1982"></a>
<span class="sourceLineNo">1983</span>        if ((!this.onGround || dy != 0) &amp;&amp; !this.noClip) {<a name="line.1983"></a>
<span class="sourceLineNo">1984</span>            AxisAlignedBB bb = this.boundingBox.clone();<a name="line.1984"></a>
<span class="sourceLineNo">1985</span>            bb.setMinY(bb.getMinY() - 0.75);<a name="line.1985"></a>
<span class="sourceLineNo">1986</span>            this.onGround = this.level.getCollisionBlocks(bb).length &gt; 0;<a name="line.1986"></a>
<span class="sourceLineNo">1987</span>        }<a name="line.1987"></a>
<span class="sourceLineNo">1988</span>        this.isCollided = this.onGround;<a name="line.1988"></a>
<span class="sourceLineNo">1989</span>        this.updateFallState(this.onGround);<a name="line.1989"></a>
<span class="sourceLineNo">1990</span>        Timings.entityMoveTimer.stopTiming();<a name="line.1990"></a>
<span class="sourceLineNo">1991</span>        return true;<a name="line.1991"></a>
<span class="sourceLineNo">1992</span>    }<a name="line.1992"></a>
<span class="sourceLineNo">1993</span><a name="line.1993"></a>
<span class="sourceLineNo">1994</span>    public boolean move(double dx, double dy, double dz) {<a name="line.1994"></a>
<span class="sourceLineNo">1995</span>        if (dx == 0 &amp;&amp; dz == 0 &amp;&amp; dy == 0) {<a name="line.1995"></a>
<span class="sourceLineNo">1996</span>            return true;<a name="line.1996"></a>
<span class="sourceLineNo">1997</span>        }<a name="line.1997"></a>
<span class="sourceLineNo">1998</span>        if (this.keepMovement) {<a name="line.1998"></a>
<span class="sourceLineNo">1999</span>            this.boundingBox.offset(dx, dy, dz);<a name="line.1999"></a>
<span class="sourceLineNo">2000</span>            this.setPosition(this.temporalVector.setComponents((this.boundingBox.getMinX() + this.boundingBox.getMaxX()) / 2, this.boundingBox.getMinY(), (this.boundingBox.getMinZ() + this.boundingBox.getMaxZ()) / 2));<a name="line.2000"></a>
<span class="sourceLineNo">2001</span>            this.onGround = this.isPlayer;<a name="line.2001"></a>
<span class="sourceLineNo">2002</span>            return true;<a name="line.2002"></a>
<span class="sourceLineNo">2003</span>        } else {<a name="line.2003"></a>
<span class="sourceLineNo">2004</span>            Timings.entityMoveTimer.startTiming();<a name="line.2004"></a>
<span class="sourceLineNo">2005</span>            this.ySize *= 0.4;<a name="line.2005"></a>
<span class="sourceLineNo">2006</span>            double movX = dx;<a name="line.2006"></a>
<span class="sourceLineNo">2007</span>            double movY = dy;<a name="line.2007"></a>
<span class="sourceLineNo">2008</span>            double movZ = dz;<a name="line.2008"></a>
<span class="sourceLineNo">2009</span>            AxisAlignedBB axisalignedbb = this.boundingBox.clone();<a name="line.2009"></a>
<span class="sourceLineNo">2010</span>            AxisAlignedBB[] list = this.noClip ? AxisAlignedBB.EMPTY_ARRAY : this.level.getCollisionCubes(this, this.boundingBox.addCoord(dx, dy, dz), false);<a name="line.2010"></a>
<span class="sourceLineNo">2011</span>            for (AxisAlignedBB bb : list) {<a name="line.2011"></a>
<span class="sourceLineNo">2012</span>                dy = bb.calculateYOffset(this.boundingBox, dy);<a name="line.2012"></a>
<span class="sourceLineNo">2013</span>            }<a name="line.2013"></a>
<span class="sourceLineNo">2014</span>            this.boundingBox.offset(0, dy, 0);<a name="line.2014"></a>
<span class="sourceLineNo">2015</span>            boolean fallingFlag = (this.onGround || (dy != movY &amp;&amp; movY &lt; 0));<a name="line.2015"></a>
<span class="sourceLineNo">2016</span>            for (AxisAlignedBB bb : list) {<a name="line.2016"></a>
<span class="sourceLineNo">2017</span>                dx = bb.calculateXOffset(this.boundingBox, dx);<a name="line.2017"></a>
<span class="sourceLineNo">2018</span>            }<a name="line.2018"></a>
<span class="sourceLineNo">2019</span>            this.boundingBox.offset(dx, 0, 0);<a name="line.2019"></a>
<span class="sourceLineNo">2020</span>            for (AxisAlignedBB bb : list) {<a name="line.2020"></a>
<span class="sourceLineNo">2021</span>                dz = bb.calculateZOffset(this.boundingBox, dz);<a name="line.2021"></a>
<span class="sourceLineNo">2022</span>            }<a name="line.2022"></a>
<span class="sourceLineNo">2023</span>            this.boundingBox.offset(0, 0, dz);<a name="line.2023"></a>
<span class="sourceLineNo">2024</span>            if (this.getStepHeight() &gt; 0 &amp;&amp; fallingFlag &amp;&amp; this.ySize &lt; 0.05 &amp;&amp; (movX != dx || movZ != dz)) {<a name="line.2024"></a>
<span class="sourceLineNo">2025</span>                double cx = dx;<a name="line.2025"></a>
<span class="sourceLineNo">2026</span>                double cy = dy;<a name="line.2026"></a>
<span class="sourceLineNo">2027</span>                double cz = dz;<a name="line.2027"></a>
<span class="sourceLineNo">2028</span>                dx = movX;<a name="line.2028"></a>
<span class="sourceLineNo">2029</span>                dy = this.getStepHeight();<a name="line.2029"></a>
<span class="sourceLineNo">2030</span>                dz = movZ;<a name="line.2030"></a>
<span class="sourceLineNo">2031</span>                AxisAlignedBB axisalignedbb1 = this.boundingBox.clone();<a name="line.2031"></a>
<span class="sourceLineNo">2032</span>                this.boundingBox.setBB(axisalignedbb);<a name="line.2032"></a>
<span class="sourceLineNo">2033</span>                list = this.level.getCollisionCubes(this, this.boundingBox.addCoord(dx, dy, dz), false);<a name="line.2033"></a>
<span class="sourceLineNo">2034</span>                for (AxisAlignedBB bb : list) {<a name="line.2034"></a>
<span class="sourceLineNo">2035</span>                    dy = bb.calculateYOffset(this.boundingBox, dy);<a name="line.2035"></a>
<span class="sourceLineNo">2036</span>                }<a name="line.2036"></a>
<span class="sourceLineNo">2037</span>                this.boundingBox.offset(0, dy, 0);<a name="line.2037"></a>
<span class="sourceLineNo">2038</span>                for (AxisAlignedBB bb : list) {<a name="line.2038"></a>
<span class="sourceLineNo">2039</span>                    dx = bb.calculateXOffset(this.boundingBox, dx);<a name="line.2039"></a>
<span class="sourceLineNo">2040</span>                }<a name="line.2040"></a>
<span class="sourceLineNo">2041</span>                this.boundingBox.offset(dx, 0, 0);<a name="line.2041"></a>
<span class="sourceLineNo">2042</span>                for (AxisAlignedBB bb : list) {<a name="line.2042"></a>
<span class="sourceLineNo">2043</span>                    dz = bb.calculateZOffset(this.boundingBox, dz);<a name="line.2043"></a>
<span class="sourceLineNo">2044</span>                }<a name="line.2044"></a>
<span class="sourceLineNo">2045</span>                this.boundingBox.offset(0, 0, dz);<a name="line.2045"></a>
<span class="sourceLineNo">2046</span>                this.boundingBox.offset(0, 0, dz);<a name="line.2046"></a>
<span class="sourceLineNo">2047</span>                if ((cx * cx + cz * cz) &gt;= (dx * dx + dz * dz)) {<a name="line.2047"></a>
<span class="sourceLineNo">2048</span>                    dx = cx;<a name="line.2048"></a>
<span class="sourceLineNo">2049</span>                    dy = cy;<a name="line.2049"></a>
<span class="sourceLineNo">2050</span>                    dz = cz;<a name="line.2050"></a>
<span class="sourceLineNo">2051</span>                    this.boundingBox.setBB(axisalignedbb1);<a name="line.2051"></a>
<span class="sourceLineNo">2052</span>                } else {<a name="line.2052"></a>
<span class="sourceLineNo">2053</span>                    this.ySize += 0.5;<a name="line.2053"></a>
<span class="sourceLineNo">2054</span>                }<a name="line.2054"></a>
<span class="sourceLineNo">2055</span>            }<a name="line.2055"></a>
<span class="sourceLineNo">2056</span>            this.x = (this.boundingBox.getMinX() + this.boundingBox.getMaxX()) / 2;<a name="line.2056"></a>
<span class="sourceLineNo">2057</span>            this.y = this.boundingBox.getMinY() - this.ySize;<a name="line.2057"></a>
<span class="sourceLineNo">2058</span>            this.z = (this.boundingBox.getMinZ() + this.boundingBox.getMaxZ()) / 2;<a name="line.2058"></a>
<span class="sourceLineNo">2059</span>            this.checkChunks();<a name="line.2059"></a>
<span class="sourceLineNo">2060</span>            this.checkGroundState(movX, movY, movZ, dx, dy, dz);<a name="line.2060"></a>
<span class="sourceLineNo">2061</span>            this.updateFallState(this.onGround);<a name="line.2061"></a>
<span class="sourceLineNo">2062</span>            if (movX != dx) {<a name="line.2062"></a>
<span class="sourceLineNo">2063</span>                this.motionX = 0;<a name="line.2063"></a>
<span class="sourceLineNo">2064</span>            }<a name="line.2064"></a>
<span class="sourceLineNo">2065</span>            if (movY != dy) {<a name="line.2065"></a>
<span class="sourceLineNo">2066</span>                this.motionY = 0;<a name="line.2066"></a>
<span class="sourceLineNo">2067</span>            }<a name="line.2067"></a>
<span class="sourceLineNo">2068</span>            if (movZ != dz) {<a name="line.2068"></a>
<span class="sourceLineNo">2069</span>                this.motionZ = 0;<a name="line.2069"></a>
<span class="sourceLineNo">2070</span>            }<a name="line.2070"></a>
<span class="sourceLineNo">2071</span>            //TODO: vehicle collision events (first we need to spawn them!)<a name="line.2071"></a>
<span class="sourceLineNo">2072</span>            Timings.entityMoveTimer.stopTiming();<a name="line.2072"></a>
<span class="sourceLineNo">2073</span>            return true;<a name="line.2073"></a>
<span class="sourceLineNo">2074</span>        }<a name="line.2074"></a>
<span class="sourceLineNo">2075</span>    }<a name="line.2075"></a>
<span class="sourceLineNo">2076</span><a name="line.2076"></a>
<span class="sourceLineNo">2077</span>    @PowerNukkitDifference(since = "1.4.0.0-PN", info = "Will do nothing if the entity is on ground and all args are 0")<a name="line.2077"></a>
<span class="sourceLineNo">2078</span>    protected void checkGroundState(double movX, double movY, double movZ, double dx, double dy, double dz) {<a name="line.2078"></a>
<span class="sourceLineNo">2079</span>        if (onGround &amp;&amp; movX == 0 &amp;&amp; movY == 0 &amp;&amp; movZ == 0 &amp;&amp; dx == 0 &amp;&amp; dy == 0 &amp;&amp; dz == 0) {<a name="line.2079"></a>
<span class="sourceLineNo">2080</span>            return;<a name="line.2080"></a>
<span class="sourceLineNo">2081</span>        }<a name="line.2081"></a>
<span class="sourceLineNo">2082</span>        if (this.noClip) {<a name="line.2082"></a>
<span class="sourceLineNo">2083</span>            this.isCollidedVertically = false;<a name="line.2083"></a>
<span class="sourceLineNo">2084</span>            this.isCollidedHorizontally = false;<a name="line.2084"></a>
<span class="sourceLineNo">2085</span>            this.isCollided = false;<a name="line.2085"></a>
<span class="sourceLineNo">2086</span>            this.onGround = false;<a name="line.2086"></a>
<span class="sourceLineNo">2087</span>        } else {<a name="line.2087"></a>
<span class="sourceLineNo">2088</span>            this.isCollidedVertically = movY != dy;<a name="line.2088"></a>
<span class="sourceLineNo">2089</span>            this.isCollidedHorizontally = (movX != dx || movZ != dz);<a name="line.2089"></a>
<span class="sourceLineNo">2090</span>            this.isCollided = (this.isCollidedHorizontally || this.isCollidedVertically);<a name="line.2090"></a>
<span class="sourceLineNo">2091</span>            this.onGround = (movY != dy &amp;&amp; movY &lt; 0);<a name="line.2091"></a>
<span class="sourceLineNo">2092</span>        }<a name="line.2092"></a>
<span class="sourceLineNo">2093</span>    }<a name="line.2093"></a>
<span class="sourceLineNo">2094</span><a name="line.2094"></a>
<span class="sourceLineNo">2095</span>    public List&lt;Block&gt; getBlocksAround() {<a name="line.2095"></a>
<span class="sourceLineNo">2096</span>        if (this.blocksAround == null) {<a name="line.2096"></a>
<span class="sourceLineNo">2097</span>            int minX = NukkitMath.floorDouble(this.boundingBox.getMinX());<a name="line.2097"></a>
<span class="sourceLineNo">2098</span>            int minY = NukkitMath.floorDouble(this.boundingBox.getMinY());<a name="line.2098"></a>
<span class="sourceLineNo">2099</span>            int minZ = NukkitMath.floorDouble(this.boundingBox.getMinZ());<a name="line.2099"></a>
<span class="sourceLineNo">2100</span>            int maxX = NukkitMath.ceilDouble(this.boundingBox.getMaxX());<a name="line.2100"></a>
<span class="sourceLineNo">2101</span>            int maxY = NukkitMath.ceilDouble(this.boundingBox.getMaxY());<a name="line.2101"></a>
<span class="sourceLineNo">2102</span>            int maxZ = NukkitMath.ceilDouble(this.boundingBox.getMaxZ());<a name="line.2102"></a>
<span class="sourceLineNo">2103</span>            this.blocksAround = new ArrayList&lt;&gt;();<a name="line.2103"></a>
<span class="sourceLineNo">2104</span>            for (int z = minZ; z &lt;= maxZ; ++z) {<a name="line.2104"></a>
<span class="sourceLineNo">2105</span>                for (int x = minX; x &lt;= maxX; ++x) {<a name="line.2105"></a>
<span class="sourceLineNo">2106</span>                    for (int y = minY; y &lt;= maxY; ++y) {<a name="line.2106"></a>
<span class="sourceLineNo">2107</span>                        Block block = this.level.getBlock(this.temporalVector.setComponents(x, y, z));<a name="line.2107"></a>
<span class="sourceLineNo">2108</span>                        this.blocksAround.add(block);<a name="line.2108"></a>
<span class="sourceLineNo">2109</span>                    }<a name="line.2109"></a>
<span class="sourceLineNo">2110</span>                }<a name="line.2110"></a>
<span class="sourceLineNo">2111</span>            }<a name="line.2111"></a>
<span class="sourceLineNo">2112</span>        }<a name="line.2112"></a>
<span class="sourceLineNo">2113</span>        return this.blocksAround;<a name="line.2113"></a>
<span class="sourceLineNo">2114</span>    }<a name="line.2114"></a>
<span class="sourceLineNo">2115</span><a name="line.2115"></a>
<span class="sourceLineNo">2116</span>    public List&lt;Block&gt; getCollisionBlocks() {<a name="line.2116"></a>
<span class="sourceLineNo">2117</span>        if (this.collisionBlocks == null) {<a name="line.2117"></a>
<span class="sourceLineNo">2118</span>            this.collisionBlocks = new ArrayList&lt;&gt;();<a name="line.2118"></a>
<span class="sourceLineNo">2119</span>            for (Block b : getBlocksAround()) {<a name="line.2119"></a>
<span class="sourceLineNo">2120</span>                if (b.collidesWithBB(this.getBoundingBox(), true)) {<a name="line.2120"></a>
<span class="sourceLineNo">2121</span>                    this.collisionBlocks.add(b);<a name="line.2121"></a>
<span class="sourceLineNo">2122</span>                }<a name="line.2122"></a>
<span class="sourceLineNo">2123</span>            }<a name="line.2123"></a>
<span class="sourceLineNo">2124</span>        }<a name="line.2124"></a>
<span class="sourceLineNo">2125</span>        return this.collisionBlocks;<a name="line.2125"></a>
<span class="sourceLineNo">2126</span>    }<a name="line.2126"></a>
<span class="sourceLineNo">2127</span><a name="line.2127"></a>
<span class="sourceLineNo">2128</span>    /**<a name="line.2128"></a>
<span class="sourceLineNo">2129</span>     * Returns whether this entity can be moved by currents in liquids.<a name="line.2129"></a>
<span class="sourceLineNo">2130</span>     *<a name="line.2130"></a>
<span class="sourceLineNo">2131</span>     * @return boolean<a name="line.2131"></a>
<span class="sourceLineNo">2132</span>     */<a name="line.2132"></a>
<span class="sourceLineNo">2133</span>    public boolean canBeMovedByCurrents() {<a name="line.2133"></a>
<span class="sourceLineNo">2134</span>        return true;<a name="line.2134"></a>
<span class="sourceLineNo">2135</span>    }<a name="line.2135"></a>
<span class="sourceLineNo">2136</span><a name="line.2136"></a>
<span class="sourceLineNo">2137</span>    protected void checkBlockCollision() {<a name="line.2137"></a>
<span class="sourceLineNo">2138</span>        if (this.noClip) {<a name="line.2138"></a>
<span class="sourceLineNo">2139</span>            return;<a name="line.2139"></a>
<span class="sourceLineNo">2140</span>        }<a name="line.2140"></a>
<span class="sourceLineNo">2141</span>        Vector3 vector = new Vector3(0, 0, 0);<a name="line.2141"></a>
<span class="sourceLineNo">2142</span>        boolean portal = false;<a name="line.2142"></a>
<span class="sourceLineNo">2143</span>        boolean scaffolding = false;<a name="line.2143"></a>
<span class="sourceLineNo">2144</span>        boolean endPortal = false;<a name="line.2144"></a>
<span class="sourceLineNo">2145</span>        for (Block block : this.getCollisionBlocks()) {<a name="line.2145"></a>
<span class="sourceLineNo">2146</span>            switch (block.getId()) {<a name="line.2146"></a>
<span class="sourceLineNo">2147</span>            case Block.NETHER_PORTAL: <a name="line.2147"></a>
<span class="sourceLineNo">2148</span>                portal = true;<a name="line.2148"></a>
<span class="sourceLineNo">2149</span>                break;<a name="line.2149"></a>
<span class="sourceLineNo">2150</span>            case BlockID.SCAFFOLDING: <a name="line.2150"></a>
<span class="sourceLineNo">2151</span>                scaffolding = true;<a name="line.2151"></a>
<span class="sourceLineNo">2152</span>                break;<a name="line.2152"></a>
<span class="sourceLineNo">2153</span>            case BlockID.END_PORTAL: <a name="line.2153"></a>
<span class="sourceLineNo">2154</span>                endPortal = true;<a name="line.2154"></a>
<span class="sourceLineNo">2155</span>                break;<a name="line.2155"></a>
<span class="sourceLineNo">2156</span>            }<a name="line.2156"></a>
<span class="sourceLineNo">2157</span>            block.onEntityCollide(this);<a name="line.2157"></a>
<span class="sourceLineNo">2158</span>            block.getLevelBlockAtLayer(1).onEntityCollide(this);<a name="line.2158"></a>
<span class="sourceLineNo">2159</span>            block.addVelocityToEntity(this, vector);<a name="line.2159"></a>
<span class="sourceLineNo">2160</span>        }<a name="line.2160"></a>
<span class="sourceLineNo">2161</span>        setDataFlag(DATA_FLAGS_EXTENDED, DATA_FLAG_IN_SCAFFOLDING, scaffolding);<a name="line.2161"></a>
<span class="sourceLineNo">2162</span>        AxisAlignedBB scanBoundingBox = boundingBox.getOffsetBoundingBox(0, -0.125, 0);<a name="line.2162"></a>
<span class="sourceLineNo">2163</span>        scanBoundingBox.setMaxY(boundingBox.getMinY());<a name="line.2163"></a>
<span class="sourceLineNo">2164</span>        Block[] scaffoldingUnder = level.getCollisionBlocks(scanBoundingBox, true, true, b -&gt; b.getId() == BlockID.SCAFFOLDING);<a name="line.2164"></a>
<span class="sourceLineNo">2165</span>        setDataFlag(DATA_FLAGS_EXTENDED, DATA_FLAG_OVER_SCAFFOLDING, scaffoldingUnder.length &gt; 0);<a name="line.2165"></a>
<span class="sourceLineNo">2166</span>        if (endPortal) {<a name="line.2166"></a>
<span class="sourceLineNo">2167</span>            if (!inEndPortal) {<a name="line.2167"></a>
<span class="sourceLineNo">2168</span>                inEndPortal = true;<a name="line.2168"></a>
<span class="sourceLineNo">2169</span>                EntityPortalEnterEvent ev = new EntityPortalEnterEvent(this, PortalType.END);<a name="line.2169"></a>
<span class="sourceLineNo">2170</span>                getServer().getPluginManager().callEvent(ev);<a name="line.2170"></a>
<span class="sourceLineNo">2171</span>            }<a name="line.2171"></a>
<span class="sourceLineNo">2172</span>        } else {<a name="line.2172"></a>
<span class="sourceLineNo">2173</span>            inEndPortal = false;<a name="line.2173"></a>
<span class="sourceLineNo">2174</span>        }<a name="line.2174"></a>
<span class="sourceLineNo">2175</span>        if (portal) {<a name="line.2175"></a>
<span class="sourceLineNo">2176</span>            if (this.inPortalTicks &lt;= 80) {<a name="line.2176"></a>
<span class="sourceLineNo">2177</span>                // 81 means the server won't try to teleport<a name="line.2177"></a>
<span class="sourceLineNo">2178</span>                this.inPortalTicks++;<a name="line.2178"></a>
<span class="sourceLineNo">2179</span>            }<a name="line.2179"></a>
<span class="sourceLineNo">2180</span>        } else {<a name="line.2180"></a>
<span class="sourceLineNo">2181</span>            this.inPortalTicks = 0;<a name="line.2181"></a>
<span class="sourceLineNo">2182</span>        }<a name="line.2182"></a>
<span class="sourceLineNo">2183</span>        if (vector.lengthSquared() &gt; 0) {<a name="line.2183"></a>
<span class="sourceLineNo">2184</span>            vector = vector.normalize();<a name="line.2184"></a>
<span class="sourceLineNo">2185</span>            double d = 0.014;<a name="line.2185"></a>
<span class="sourceLineNo">2186</span>            this.motionX += vector.x * d;<a name="line.2186"></a>
<span class="sourceLineNo">2187</span>            this.motionY += vector.y * d;<a name="line.2187"></a>
<span class="sourceLineNo">2188</span>            this.motionZ += vector.z * d;<a name="line.2188"></a>
<span class="sourceLineNo">2189</span>        }<a name="line.2189"></a>
<span class="sourceLineNo">2190</span>    }<a name="line.2190"></a>
<span class="sourceLineNo">2191</span><a name="line.2191"></a>
<span class="sourceLineNo">2192</span>    public boolean setPositionAndRotation(Vector3 pos, double yaw, double pitch) {<a name="line.2192"></a>
<span class="sourceLineNo">2193</span>        if (this.setPosition(pos)) {<a name="line.2193"></a>
<span class="sourceLineNo">2194</span>            this.setRotation(yaw, pitch);<a name="line.2194"></a>
<span class="sourceLineNo">2195</span>            return true;<a name="line.2195"></a>
<span class="sourceLineNo">2196</span>        }<a name="line.2196"></a>
<span class="sourceLineNo">2197</span>        return false;<a name="line.2197"></a>
<span class="sourceLineNo">2198</span>    }<a name="line.2198"></a>
<span class="sourceLineNo">2199</span><a name="line.2199"></a>
<span class="sourceLineNo">2200</span>    public void setRotation(double yaw, double pitch) {<a name="line.2200"></a>
<span class="sourceLineNo">2201</span>        this.yaw = yaw;<a name="line.2201"></a>
<span class="sourceLineNo">2202</span>        this.pitch = pitch;<a name="line.2202"></a>
<span class="sourceLineNo">2203</span>        this.scheduleUpdate();<a name="line.2203"></a>
<span class="sourceLineNo">2204</span>    }<a name="line.2204"></a>
<span class="sourceLineNo">2205</span><a name="line.2205"></a>
<span class="sourceLineNo">2206</span>    /**<a name="line.2206"></a>
<span class="sourceLineNo">2207</span>     * Whether the entity can active pressure plates.<a name="line.2207"></a>
<span class="sourceLineNo">2208</span>     * Used for {@link cn.nukkit.entity.passive.EntityBat}s only.<a name="line.2208"></a>
<span class="sourceLineNo">2209</span>     *<a name="line.2209"></a>
<span class="sourceLineNo">2210</span>     * @return triggers pressure plate<a name="line.2210"></a>
<span class="sourceLineNo">2211</span>     */<a name="line.2211"></a>
<span class="sourceLineNo">2212</span>    public boolean doesTriggerPressurePlate() {<a name="line.2212"></a>
<span class="sourceLineNo">2213</span>        return true;<a name="line.2213"></a>
<span class="sourceLineNo">2214</span>    }<a name="line.2214"></a>
<span class="sourceLineNo">2215</span><a name="line.2215"></a>
<span class="sourceLineNo">2216</span>    public boolean canPassThrough() {<a name="line.2216"></a>
<span class="sourceLineNo">2217</span>        return true;<a name="line.2217"></a>
<span class="sourceLineNo">2218</span>    }<a name="line.2218"></a>
<span class="sourceLineNo">2219</span><a name="line.2219"></a>
<span class="sourceLineNo">2220</span>    protected void checkChunks() {<a name="line.2220"></a>
<span class="sourceLineNo">2221</span>        if (this.chunk == null || (this.chunk.getX() != ((int) this.x &gt;&gt; 4)) || this.chunk.getZ() != ((int) this.z &gt;&gt; 4)) {<a name="line.2221"></a>
<span class="sourceLineNo">2222</span>            if (this.chunk != null) {<a name="line.2222"></a>
<span class="sourceLineNo">2223</span>                this.chunk.removeEntity(this);<a name="line.2223"></a>
<span class="sourceLineNo">2224</span>            }<a name="line.2224"></a>
<span class="sourceLineNo">2225</span>            this.chunk = this.level.getChunk((int) this.x &gt;&gt; 4, (int) this.z &gt;&gt; 4, true);<a name="line.2225"></a>
<span class="sourceLineNo">2226</span>            if (!this.justCreated) {<a name="line.2226"></a>
<span class="sourceLineNo">2227</span>                Map&lt;Integer, Player&gt; newChunk = this.level.getChunkPlayers((int) this.x &gt;&gt; 4, (int) this.z &gt;&gt; 4);<a name="line.2227"></a>
<span class="sourceLineNo">2228</span>                for (Player player : new ArrayList&lt;&gt;(this.hasSpawned.values())) {<a name="line.2228"></a>
<span class="sourceLineNo">2229</span>                    if (!newChunk.containsKey(player.getLoaderId())) {<a name="line.2229"></a>
<span class="sourceLineNo">2230</span>                        this.despawnFrom(player);<a name="line.2230"></a>
<span class="sourceLineNo">2231</span>                    } else {<a name="line.2231"></a>
<span class="sourceLineNo">2232</span>                        newChunk.remove(player.getLoaderId());<a name="line.2232"></a>
<span class="sourceLineNo">2233</span>                    }<a name="line.2233"></a>
<span class="sourceLineNo">2234</span>                }<a name="line.2234"></a>
<span class="sourceLineNo">2235</span>                for (Player player : newChunk.values()) {<a name="line.2235"></a>
<span class="sourceLineNo">2236</span>                    this.spawnTo(player);<a name="line.2236"></a>
<span class="sourceLineNo">2237</span>                }<a name="line.2237"></a>
<span class="sourceLineNo">2238</span>            }<a name="line.2238"></a>
<span class="sourceLineNo">2239</span>            if (this.chunk == null) {<a name="line.2239"></a>
<span class="sourceLineNo">2240</span>                return;<a name="line.2240"></a>
<span class="sourceLineNo">2241</span>            }<a name="line.2241"></a>
<span class="sourceLineNo">2242</span>            this.chunk.addEntity(this);<a name="line.2242"></a>
<span class="sourceLineNo">2243</span>        }<a name="line.2243"></a>
<span class="sourceLineNo">2244</span>    }<a name="line.2244"></a>
<span class="sourceLineNo">2245</span><a name="line.2245"></a>
<span class="sourceLineNo">2246</span>    public boolean setPosition(Vector3 pos) {<a name="line.2246"></a>
<span class="sourceLineNo">2247</span>        if (this.closed) {<a name="line.2247"></a>
<span class="sourceLineNo">2248</span>            return false;<a name="line.2248"></a>
<span class="sourceLineNo">2249</span>        }<a name="line.2249"></a>
<span class="sourceLineNo">2250</span>        if (pos instanceof Position &amp;&amp; ((Position) pos).level != null &amp;&amp; ((Position) pos).level != this.level) {<a name="line.2250"></a>
<span class="sourceLineNo">2251</span>            if (!this.switchLevel(((Position) pos).getLevel())) {<a name="line.2251"></a>
<span class="sourceLineNo">2252</span>                return false;<a name="line.2252"></a>
<span class="sourceLineNo">2253</span>            }<a name="line.2253"></a>
<span class="sourceLineNo">2254</span>        }<a name="line.2254"></a>
<span class="sourceLineNo">2255</span>        this.x = pos.x;<a name="line.2255"></a>
<span class="sourceLineNo">2256</span>        this.y = pos.y;<a name="line.2256"></a>
<span class="sourceLineNo">2257</span>        this.z = pos.z;<a name="line.2257"></a>
<span class="sourceLineNo">2258</span>        this.recalculateBoundingBox(false); // Don't need to send BB height/width to client on position change<a name="line.2258"></a>
<span class="sourceLineNo">2259</span>        this.checkChunks();<a name="line.2259"></a>
<span class="sourceLineNo">2260</span>        return true;<a name="line.2260"></a>
<span class="sourceLineNo">2261</span>    }<a name="line.2261"></a>
<span class="sourceLineNo">2262</span><a name="line.2262"></a>
<span class="sourceLineNo">2263</span>    public Vector3 getMotion() {<a name="line.2263"></a>
<span class="sourceLineNo">2264</span>        return new Vector3(this.motionX, this.motionY, this.motionZ);<a name="line.2264"></a>
<span class="sourceLineNo">2265</span>    }<a name="line.2265"></a>
<span class="sourceLineNo">2266</span><a name="line.2266"></a>
<span class="sourceLineNo">2267</span>    public boolean setMotion(Vector3 motion) {<a name="line.2267"></a>
<span class="sourceLineNo">2268</span>        if (!this.justCreated) {<a name="line.2268"></a>
<span class="sourceLineNo">2269</span>            EntityMotionEvent ev = new EntityMotionEvent(this, motion);<a name="line.2269"></a>
<span class="sourceLineNo">2270</span>            this.server.getPluginManager().callEvent(ev);<a name="line.2270"></a>
<span class="sourceLineNo">2271</span>            if (ev.isCancelled()) {<a name="line.2271"></a>
<span class="sourceLineNo">2272</span>                return false;<a name="line.2272"></a>
<span class="sourceLineNo">2273</span>            }<a name="line.2273"></a>
<span class="sourceLineNo">2274</span>        }<a name="line.2274"></a>
<span class="sourceLineNo">2275</span>        this.motionX = motion.x;<a name="line.2275"></a>
<span class="sourceLineNo">2276</span>        this.motionY = motion.y;<a name="line.2276"></a>
<span class="sourceLineNo">2277</span>        this.motionZ = motion.z;<a name="line.2277"></a>
<span class="sourceLineNo">2278</span>        if (!this.justCreated) {<a name="line.2278"></a>
<span class="sourceLineNo">2279</span>            this.updateMovement();<a name="line.2279"></a>
<span class="sourceLineNo">2280</span>        }<a name="line.2280"></a>
<span class="sourceLineNo">2281</span>        return true;<a name="line.2281"></a>
<span class="sourceLineNo">2282</span>    }<a name="line.2282"></a>
<span class="sourceLineNo">2283</span><a name="line.2283"></a>
<span class="sourceLineNo">2284</span>    public boolean isOnGround() {<a name="line.2284"></a>
<span class="sourceLineNo">2285</span>        return onGround;<a name="line.2285"></a>
<span class="sourceLineNo">2286</span>    }<a name="line.2286"></a>
<span class="sourceLineNo">2287</span><a name="line.2287"></a>
<span class="sourceLineNo">2288</span>    public void kill() {<a name="line.2288"></a>
<span class="sourceLineNo">2289</span>        this.health = 0;<a name="line.2289"></a>
<span class="sourceLineNo">2290</span>        this.scheduleUpdate();<a name="line.2290"></a>
<span class="sourceLineNo">2291</span>        for (Entity passenger : new ArrayList&lt;&gt;(this.passengers)) {<a name="line.2291"></a>
<span class="sourceLineNo">2292</span>            dismountEntity(passenger);<a name="line.2292"></a>
<span class="sourceLineNo">2293</span>        }<a name="line.2293"></a>
<span class="sourceLineNo">2294</span>    }<a name="line.2294"></a>
<span class="sourceLineNo">2295</span><a name="line.2295"></a>
<span class="sourceLineNo">2296</span>    public boolean teleport(Vector3 pos) {<a name="line.2296"></a>
<span class="sourceLineNo">2297</span>        return this.teleport(pos, PlayerTeleportEvent.TeleportCause.PLUGIN);<a name="line.2297"></a>
<span class="sourceLineNo">2298</span>    }<a name="line.2298"></a>
<span class="sourceLineNo">2299</span><a name="line.2299"></a>
<span class="sourceLineNo">2300</span>    public boolean teleport(Vector3 pos, PlayerTeleportEvent.TeleportCause cause) {<a name="line.2300"></a>
<span class="sourceLineNo">2301</span>        return this.teleport(Location.fromObject(pos, this.level, this.yaw, this.pitch), cause);<a name="line.2301"></a>
<span class="sourceLineNo">2302</span>    }<a name="line.2302"></a>
<span class="sourceLineNo">2303</span><a name="line.2303"></a>
<span class="sourceLineNo">2304</span>    public boolean teleport(Position pos) {<a name="line.2304"></a>
<span class="sourceLineNo">2305</span>        return this.teleport(pos, PlayerTeleportEvent.TeleportCause.PLUGIN);<a name="line.2305"></a>
<span class="sourceLineNo">2306</span>    }<a name="line.2306"></a>
<span class="sourceLineNo">2307</span><a name="line.2307"></a>
<span class="sourceLineNo">2308</span>    public boolean teleport(Position pos, PlayerTeleportEvent.TeleportCause cause) {<a name="line.2308"></a>
<span class="sourceLineNo">2309</span>        return this.teleport(Location.fromObject(pos, pos.level, this.yaw, this.pitch), cause);<a name="line.2309"></a>
<span class="sourceLineNo">2310</span>    }<a name="line.2310"></a>
<span class="sourceLineNo">2311</span><a name="line.2311"></a>
<span class="sourceLineNo">2312</span>    public boolean teleport(Location location) {<a name="line.2312"></a>
<span class="sourceLineNo">2313</span>        return this.teleport(location, PlayerTeleportEvent.TeleportCause.PLUGIN);<a name="line.2313"></a>
<span class="sourceLineNo">2314</span>    }<a name="line.2314"></a>
<span class="sourceLineNo">2315</span><a name="line.2315"></a>
<span class="sourceLineNo">2316</span>    public boolean teleport(Location location, PlayerTeleportEvent.TeleportCause cause) {<a name="line.2316"></a>
<span class="sourceLineNo">2317</span>        double yaw = location.yaw;<a name="line.2317"></a>
<span class="sourceLineNo">2318</span>        double pitch = location.pitch;<a name="line.2318"></a>
<span class="sourceLineNo">2319</span>        Location from = this.getLocation();<a name="line.2319"></a>
<span class="sourceLineNo">2320</span>        Location to = location;<a name="line.2320"></a>
<span class="sourceLineNo">2321</span>        if (cause != null) {<a name="line.2321"></a>
<span class="sourceLineNo">2322</span>            EntityTeleportEvent ev = new EntityTeleportEvent(this, from, to);<a name="line.2322"></a>
<span class="sourceLineNo">2323</span>            this.server.getPluginManager().callEvent(ev);<a name="line.2323"></a>
<span class="sourceLineNo">2324</span>            if (ev.isCancelled()) {<a name="line.2324"></a>
<span class="sourceLineNo">2325</span>                return false;<a name="line.2325"></a>
<span class="sourceLineNo">2326</span>            }<a name="line.2326"></a>
<span class="sourceLineNo">2327</span>            to = ev.getTo();<a name="line.2327"></a>
<span class="sourceLineNo">2328</span>        }<a name="line.2328"></a>
<span class="sourceLineNo">2329</span>        Entity currentRide = getRiding();<a name="line.2329"></a>
<span class="sourceLineNo">2330</span>        if (currentRide != null &amp;&amp; !currentRide.dismountEntity(this)) {<a name="line.2330"></a>
<span class="sourceLineNo">2331</span>            return false;<a name="line.2331"></a>
<span class="sourceLineNo">2332</span>        }<a name="line.2332"></a>
<span class="sourceLineNo">2333</span>        this.ySize = 0;<a name="line.2333"></a>
<span class="sourceLineNo">2334</span>        this.setMotion(this.temporalVector.setComponents(0, 0, 0));<a name="line.2334"></a>
<span class="sourceLineNo">2335</span>        if (this.setPositionAndRotation(to, yaw, pitch)) {<a name="line.2335"></a>
<span class="sourceLineNo">2336</span>            this.resetFallDistance();<a name="line.2336"></a>
<span class="sourceLineNo">2337</span>            this.onGround = this.noClip ? false : true;<a name="line.2337"></a>
<span class="sourceLineNo">2338</span>            this.updateMovement();<a name="line.2338"></a>
<span class="sourceLineNo">2339</span>            return true;<a name="line.2339"></a>
<span class="sourceLineNo">2340</span>        }<a name="line.2340"></a>
<span class="sourceLineNo">2341</span>        return false;<a name="line.2341"></a>
<span class="sourceLineNo">2342</span>    }<a name="line.2342"></a>
<span class="sourceLineNo">2343</span><a name="line.2343"></a>
<span class="sourceLineNo">2344</span>    public long getId() {<a name="line.2344"></a>
<span class="sourceLineNo">2345</span>        return this.id;<a name="line.2345"></a>
<span class="sourceLineNo">2346</span>    }<a name="line.2346"></a>
<span class="sourceLineNo">2347</span><a name="line.2347"></a>
<span class="sourceLineNo">2348</span>    public void respawnToAll() {<a name="line.2348"></a>
<span class="sourceLineNo">2349</span>        Player[] players = this.hasSpawned.values().toArray(Player.EMPTY_ARRAY);<a name="line.2349"></a>
<span class="sourceLineNo">2350</span>        this.hasSpawned.clear();<a name="line.2350"></a>
<span class="sourceLineNo">2351</span>        for (Player player : players) {<a name="line.2351"></a>
<span class="sourceLineNo">2352</span>            this.spawnTo(player);<a name="line.2352"></a>
<span class="sourceLineNo">2353</span>        }<a name="line.2353"></a>
<span class="sourceLineNo">2354</span>    }<a name="line.2354"></a>
<span class="sourceLineNo">2355</span><a name="line.2355"></a>
<span class="sourceLineNo">2356</span>    public void spawnToAll() {<a name="line.2356"></a>
<span class="sourceLineNo">2357</span>        if (this.chunk == null || this.closed) {<a name="line.2357"></a>
<span class="sourceLineNo">2358</span>            return;<a name="line.2358"></a>
<span class="sourceLineNo">2359</span>        }<a name="line.2359"></a>
<span class="sourceLineNo">2360</span>        for (Player player : this.level.getChunkPlayers(this.chunk.getX(), this.chunk.getZ()).values()) {<a name="line.2360"></a>
<span class="sourceLineNo">2361</span>            if (player.isOnline()) {<a name="line.2361"></a>
<span class="sourceLineNo">2362</span>                this.spawnTo(player);<a name="line.2362"></a>
<span class="sourceLineNo">2363</span>            }<a name="line.2363"></a>
<span class="sourceLineNo">2364</span>        }<a name="line.2364"></a>
<span class="sourceLineNo">2365</span>    }<a name="line.2365"></a>
<span class="sourceLineNo">2366</span><a name="line.2366"></a>
<span class="sourceLineNo">2367</span>    public void despawnFromAll() {<a name="line.2367"></a>
<span class="sourceLineNo">2368</span>        for (Player player : new ArrayList&lt;&gt;(this.hasSpawned.values())) {<a name="line.2368"></a>
<span class="sourceLineNo">2369</span>            this.despawnFrom(player);<a name="line.2369"></a>
<span class="sourceLineNo">2370</span>        }<a name="line.2370"></a>
<span class="sourceLineNo">2371</span>    }<a name="line.2371"></a>
<span class="sourceLineNo">2372</span><a name="line.2372"></a>
<span class="sourceLineNo">2373</span>    public void close() {<a name="line.2373"></a>
<span class="sourceLineNo">2374</span>        if (!this.closed) {<a name="line.2374"></a>
<span class="sourceLineNo">2375</span>            this.closed = true;<a name="line.2375"></a>
<span class="sourceLineNo">2376</span>            try {<a name="line.2376"></a>
<span class="sourceLineNo">2377</span>                EntityDespawnEvent event = new EntityDespawnEvent(this);<a name="line.2377"></a>
<span class="sourceLineNo">2378</span>                this.server.getPluginManager().callEvent(event);<a name="line.2378"></a>
<span class="sourceLineNo">2379</span>                if (event.isCancelled()) {<a name="line.2379"></a>
<span class="sourceLineNo">2380</span>                    this.closed = false;<a name="line.2380"></a>
<span class="sourceLineNo">2381</span>                    return;<a name="line.2381"></a>
<span class="sourceLineNo">2382</span>                }<a name="line.2382"></a>
<span class="sourceLineNo">2383</span>            } catch (Throwable e) {<a name="line.2383"></a>
<span class="sourceLineNo">2384</span>                this.closed = false;<a name="line.2384"></a>
<span class="sourceLineNo">2385</span>                throw e;<a name="line.2385"></a>
<span class="sourceLineNo">2386</span>            }<a name="line.2386"></a>
<span class="sourceLineNo">2387</span>            try {<a name="line.2387"></a>
<span class="sourceLineNo">2388</span>                this.despawnFromAll();<a name="line.2388"></a>
<span class="sourceLineNo">2389</span>            } finally {<a name="line.2389"></a>
<span class="sourceLineNo">2390</span>                try {<a name="line.2390"></a>
<span class="sourceLineNo">2391</span>                    if (this.chunk != null) {<a name="line.2391"></a>
<span class="sourceLineNo">2392</span>                        this.chunk.removeEntity(this);<a name="line.2392"></a>
<span class="sourceLineNo">2393</span>                    }<a name="line.2393"></a>
<span class="sourceLineNo">2394</span>                } finally {<a name="line.2394"></a>
<span class="sourceLineNo">2395</span>                    if (this.level != null) {<a name="line.2395"></a>
<span class="sourceLineNo">2396</span>                        this.level.removeEntity(this);<a name="line.2396"></a>
<span class="sourceLineNo">2397</span>                    }<a name="line.2397"></a>
<span class="sourceLineNo">2398</span>                }<a name="line.2398"></a>
<span class="sourceLineNo">2399</span>            }<a name="line.2399"></a>
<span class="sourceLineNo">2400</span>        }<a name="line.2400"></a>
<span class="sourceLineNo">2401</span>    }<a name="line.2401"></a>
<span class="sourceLineNo">2402</span><a name="line.2402"></a>
<span class="sourceLineNo">2403</span>    private void close(Boolean despawn) {<a name="line.2403"></a>
<span class="sourceLineNo">2404</span>        if (!this.closed) {<a name="line.2404"></a>
<span class="sourceLineNo">2405</span>            this.closed = true;<a name="line.2405"></a>
<span class="sourceLineNo">2406</span>            if (despawn) {<a name="line.2406"></a>
<span class="sourceLineNo">2407</span>                EntityDespawnEvent event = new EntityDespawnEvent(this);<a name="line.2407"></a>
<span class="sourceLineNo">2408</span>                this.server.getPluginManager().callEvent(event);<a name="line.2408"></a>
<span class="sourceLineNo">2409</span>                if (event.isCancelled()) return;<a name="line.2409"></a>
<span class="sourceLineNo">2410</span>            }<a name="line.2410"></a>
<span class="sourceLineNo">2411</span>            this.despawnFromAll();<a name="line.2411"></a>
<span class="sourceLineNo">2412</span>            if (this.chunk != null) {<a name="line.2412"></a>
<span class="sourceLineNo">2413</span>                this.chunk.removeEntity(this);<a name="line.2413"></a>
<span class="sourceLineNo">2414</span>            }<a name="line.2414"></a>
<span class="sourceLineNo">2415</span>            if (this.level != null) {<a name="line.2415"></a>
<span class="sourceLineNo">2416</span>                this.level.removeEntity(this);<a name="line.2416"></a>
<span class="sourceLineNo">2417</span>            }<a name="line.2417"></a>
<span class="sourceLineNo">2418</span>        }<a name="line.2418"></a>
<span class="sourceLineNo">2419</span>    }<a name="line.2419"></a>
<span class="sourceLineNo">2420</span><a name="line.2420"></a>
<span class="sourceLineNo">2421</span>    public boolean setDataProperty(EntityData data) {<a name="line.2421"></a>
<span class="sourceLineNo">2422</span>        return setDataProperty(data, true);<a name="line.2422"></a>
<span class="sourceLineNo">2423</span>    }<a name="line.2423"></a>
<span class="sourceLineNo">2424</span><a name="line.2424"></a>
<span class="sourceLineNo">2425</span>    public boolean setDataProperty(EntityData data, boolean send) {<a name="line.2425"></a>
<span class="sourceLineNo">2426</span>        if (!Objects.equals(data, this.getDataProperties().get(data.getId()))) {<a name="line.2426"></a>
<span class="sourceLineNo">2427</span>            this.getDataProperties().put(data);<a name="line.2427"></a>
<span class="sourceLineNo">2428</span>            if (send) {<a name="line.2428"></a>
<span class="sourceLineNo">2429</span>                this.sendData(this.hasSpawned.values().toArray(Player.EMPTY_ARRAY), new EntityMetadata().put(this.dataProperties.get(data.getId())));<a name="line.2429"></a>
<span class="sourceLineNo">2430</span>            }<a name="line.2430"></a>
<span class="sourceLineNo">2431</span>            return true;<a name="line.2431"></a>
<span class="sourceLineNo">2432</span>        }<a name="line.2432"></a>
<span class="sourceLineNo">2433</span>        return false;<a name="line.2433"></a>
<span class="sourceLineNo">2434</span>    }<a name="line.2434"></a>
<span class="sourceLineNo">2435</span><a name="line.2435"></a>
<span class="sourceLineNo">2436</span>    public EntityMetadata getDataProperties() {<a name="line.2436"></a>
<span class="sourceLineNo">2437</span>        return this.dataProperties;<a name="line.2437"></a>
<span class="sourceLineNo">2438</span>    }<a name="line.2438"></a>
<span class="sourceLineNo">2439</span><a name="line.2439"></a>
<span class="sourceLineNo">2440</span>    public EntityData getDataProperty(int id) {<a name="line.2440"></a>
<span class="sourceLineNo">2441</span>        return this.getDataProperties().get(id);<a name="line.2441"></a>
<span class="sourceLineNo">2442</span>    }<a name="line.2442"></a>
<span class="sourceLineNo">2443</span><a name="line.2443"></a>
<span class="sourceLineNo">2444</span>    public int getDataPropertyInt(int id) {<a name="line.2444"></a>
<span class="sourceLineNo">2445</span>        return this.getDataProperties().getInt(id);<a name="line.2445"></a>
<span class="sourceLineNo">2446</span>    }<a name="line.2446"></a>
<span class="sourceLineNo">2447</span><a name="line.2447"></a>
<span class="sourceLineNo">2448</span>    public int getDataPropertyShort(int id) {<a name="line.2448"></a>
<span class="sourceLineNo">2449</span>        return this.getDataProperties().getShort(id);<a name="line.2449"></a>
<span class="sourceLineNo">2450</span>    }<a name="line.2450"></a>
<span class="sourceLineNo">2451</span><a name="line.2451"></a>
<span class="sourceLineNo">2452</span>    public int getDataPropertyByte(int id) {<a name="line.2452"></a>
<span class="sourceLineNo">2453</span>        return this.getDataProperties().getByte(id);<a name="line.2453"></a>
<span class="sourceLineNo">2454</span>    }<a name="line.2454"></a>
<span class="sourceLineNo">2455</span><a name="line.2455"></a>
<span class="sourceLineNo">2456</span>    public boolean getDataPropertyBoolean(int id) {<a name="line.2456"></a>
<span class="sourceLineNo">2457</span>        return this.getDataProperties().getBoolean(id);<a name="line.2457"></a>
<span class="sourceLineNo">2458</span>    }<a name="line.2458"></a>
<span class="sourceLineNo">2459</span><a name="line.2459"></a>
<span class="sourceLineNo">2460</span>    public long getDataPropertyLong(int id) {<a name="line.2460"></a>
<span class="sourceLineNo">2461</span>        return this.getDataProperties().getLong(id);<a name="line.2461"></a>
<span class="sourceLineNo">2462</span>    }<a name="line.2462"></a>
<span class="sourceLineNo">2463</span><a name="line.2463"></a>
<span class="sourceLineNo">2464</span>    public String getDataPropertyString(int id) {<a name="line.2464"></a>
<span class="sourceLineNo">2465</span>        return this.getDataProperties().getString(id);<a name="line.2465"></a>
<span class="sourceLineNo">2466</span>    }<a name="line.2466"></a>
<span class="sourceLineNo">2467</span><a name="line.2467"></a>
<span class="sourceLineNo">2468</span>    public float getDataPropertyFloat(int id) {<a name="line.2468"></a>
<span class="sourceLineNo">2469</span>        return this.getDataProperties().getFloat(id);<a name="line.2469"></a>
<span class="sourceLineNo">2470</span>    }<a name="line.2470"></a>
<span class="sourceLineNo">2471</span><a name="line.2471"></a>
<span class="sourceLineNo">2472</span>    public CompoundTag getDataPropertyNBT(int id) {<a name="line.2472"></a>
<span class="sourceLineNo">2473</span>        return this.getDataProperties().getNBT(id);<a name="line.2473"></a>
<span class="sourceLineNo">2474</span>    }<a name="line.2474"></a>
<span class="sourceLineNo">2475</span><a name="line.2475"></a>
<span class="sourceLineNo">2476</span>    public Vector3 getDataPropertyPos(int id) {<a name="line.2476"></a>
<span class="sourceLineNo">2477</span>        return this.getDataProperties().getPosition(id);<a name="line.2477"></a>
<span class="sourceLineNo">2478</span>    }<a name="line.2478"></a>
<span class="sourceLineNo">2479</span><a name="line.2479"></a>
<span class="sourceLineNo">2480</span>    public Vector3f getDataPropertyVector3f(int id) {<a name="line.2480"></a>
<span class="sourceLineNo">2481</span>        return this.getDataProperties().getFloatPosition(id);<a name="line.2481"></a>
<span class="sourceLineNo">2482</span>    }<a name="line.2482"></a>
<span class="sourceLineNo">2483</span><a name="line.2483"></a>
<span class="sourceLineNo">2484</span>    public int getDataPropertyType(int id) {<a name="line.2484"></a>
<span class="sourceLineNo">2485</span>        return this.getDataProperties().exists(id) ? this.getDataProperty(id).getType() : -1;<a name="line.2485"></a>
<span class="sourceLineNo">2486</span>    }<a name="line.2486"></a>
<span class="sourceLineNo">2487</span><a name="line.2487"></a>
<span class="sourceLineNo">2488</span>    public void setDataFlag(int propertyId, int id) {<a name="line.2488"></a>
<span class="sourceLineNo">2489</span>        this.setDataFlag(propertyId, id, true);<a name="line.2489"></a>
<span class="sourceLineNo">2490</span>    }<a name="line.2490"></a>
<span class="sourceLineNo">2491</span><a name="line.2491"></a>
<span class="sourceLineNo">2492</span>    public void setDataFlag(int propertyId, int id, boolean value) {<a name="line.2492"></a>
<span class="sourceLineNo">2493</span>        if (this.getDataFlag(propertyId, id) != value) {<a name="line.2493"></a>
<span class="sourceLineNo">2494</span>            if (propertyId == EntityHuman.DATA_PLAYER_FLAGS) {<a name="line.2494"></a>
<span class="sourceLineNo">2495</span>                byte flags = (byte) this.getDataPropertyByte(propertyId);<a name="line.2495"></a>
<span class="sourceLineNo">2496</span>                flags ^= 1 &lt;&lt; id;<a name="line.2496"></a>
<span class="sourceLineNo">2497</span>                this.setDataProperty(new ByteEntityData(propertyId, flags));<a name="line.2497"></a>
<span class="sourceLineNo">2498</span>            } else {<a name="line.2498"></a>
<span class="sourceLineNo">2499</span>                long flags = this.getDataPropertyLong(propertyId);<a name="line.2499"></a>
<span class="sourceLineNo">2500</span>                flags ^= 1L &lt;&lt; id;<a name="line.2500"></a>
<span class="sourceLineNo">2501</span>                this.setDataProperty(new LongEntityData(propertyId, flags));<a name="line.2501"></a>
<span class="sourceLineNo">2502</span>            }<a name="line.2502"></a>
<span class="sourceLineNo">2503</span>        }<a name="line.2503"></a>
<span class="sourceLineNo">2504</span>    }<a name="line.2504"></a>
<span class="sourceLineNo">2505</span><a name="line.2505"></a>
<span class="sourceLineNo">2506</span>    public boolean getDataFlag(int propertyId, int id) {<a name="line.2506"></a>
<span class="sourceLineNo">2507</span>        return (((propertyId == EntityHuman.DATA_PLAYER_FLAGS ? this.getDataPropertyByte(propertyId) &amp; 255 : this.getDataPropertyLong(propertyId))) &amp; (1L &lt;&lt; id)) &gt; 0;<a name="line.2507"></a>
<span class="sourceLineNo">2508</span>    }<a name="line.2508"></a>
<span class="sourceLineNo">2509</span><a name="line.2509"></a>
<span class="sourceLineNo">2510</span>    @Override<a name="line.2510"></a>
<span class="sourceLineNo">2511</span>    public void setMetadata(String metadataKey, MetadataValue newMetadataValue) {<a name="line.2511"></a>
<span class="sourceLineNo">2512</span>        this.server.getEntityMetadata().setMetadata(this, metadataKey, newMetadataValue);<a name="line.2512"></a>
<span class="sourceLineNo">2513</span>    }<a name="line.2513"></a>
<span class="sourceLineNo">2514</span><a name="line.2514"></a>
<span class="sourceLineNo">2515</span>    @Override<a name="line.2515"></a>
<span class="sourceLineNo">2516</span>    public List&lt;MetadataValue&gt; getMetadata(String metadataKey) {<a name="line.2516"></a>
<span class="sourceLineNo">2517</span>        return this.server.getEntityMetadata().getMetadata(this, metadataKey);<a name="line.2517"></a>
<span class="sourceLineNo">2518</span>    }<a name="line.2518"></a>
<span class="sourceLineNo">2519</span><a name="line.2519"></a>
<span class="sourceLineNo">2520</span>    @Override<a name="line.2520"></a>
<span class="sourceLineNo">2521</span>    public boolean hasMetadata(String metadataKey) {<a name="line.2521"></a>
<span class="sourceLineNo">2522</span>        return this.server.getEntityMetadata().hasMetadata(this, metadataKey);<a name="line.2522"></a>
<span class="sourceLineNo">2523</span>    }<a name="line.2523"></a>
<span class="sourceLineNo">2524</span><a name="line.2524"></a>
<span class="sourceLineNo">2525</span>    @Override<a name="line.2525"></a>
<span class="sourceLineNo">2526</span>    public void removeMetadata(String metadataKey, Plugin owningPlugin) {<a name="line.2526"></a>
<span class="sourceLineNo">2527</span>        this.server.getEntityMetadata().removeMetadata(this, metadataKey, owningPlugin);<a name="line.2527"></a>
<span class="sourceLineNo">2528</span>    }<a name="line.2528"></a>
<span class="sourceLineNo">2529</span><a name="line.2529"></a>
<span class="sourceLineNo">2530</span>    public Server getServer() {<a name="line.2530"></a>
<span class="sourceLineNo">2531</span>        return server;<a name="line.2531"></a>
<span class="sourceLineNo">2532</span>    }<a name="line.2532"></a>
<span class="sourceLineNo">2533</span><a name="line.2533"></a>
<span class="sourceLineNo">2534</span>    public boolean isUndead() {<a name="line.2534"></a>
<span class="sourceLineNo">2535</span>        return false;<a name="line.2535"></a>
<span class="sourceLineNo">2536</span>    }<a name="line.2536"></a>
<span class="sourceLineNo">2537</span><a name="line.2537"></a>
<span class="sourceLineNo">2538</span>    @PowerNukkitOnly<a name="line.2538"></a>
<span class="sourceLineNo">2539</span>    @Since("1.2.1.0-PN")<a name="line.2539"></a>
<span class="sourceLineNo">2540</span>    public boolean isInEndPortal() {<a name="line.2540"></a>
<span class="sourceLineNo">2541</span>        return inEndPortal;<a name="line.2541"></a>
<span class="sourceLineNo">2542</span>    }<a name="line.2542"></a>
<span class="sourceLineNo">2543</span><a name="line.2543"></a>
<span class="sourceLineNo">2544</span>    @PowerNukkitOnly<a name="line.2544"></a>
<span class="sourceLineNo">2545</span>    @Since("1.4.0.0-PN")<a name="line.2545"></a>
<span class="sourceLineNo">2546</span>    public boolean isPreventingSleep(Player player) {<a name="line.2546"></a>
<span class="sourceLineNo">2547</span>        return false;<a name="line.2547"></a>
<span class="sourceLineNo">2548</span>    }<a name="line.2548"></a>
<span class="sourceLineNo">2549</span><a name="line.2549"></a>
<span class="sourceLineNo">2550</span>    @Override<a name="line.2550"></a>
<span class="sourceLineNo">2551</span>    public boolean equals(Object obj) {<a name="line.2551"></a>
<span class="sourceLineNo">2552</span>        if (obj == null) {<a name="line.2552"></a>
<span class="sourceLineNo">2553</span>            return false;<a name="line.2553"></a>
<span class="sourceLineNo">2554</span>        }<a name="line.2554"></a>
<span class="sourceLineNo">2555</span>        if (getClass() != obj.getClass()) {<a name="line.2555"></a>
<span class="sourceLineNo">2556</span>            return false;<a name="line.2556"></a>
<span class="sourceLineNo">2557</span>        }<a name="line.2557"></a>
<span class="sourceLineNo">2558</span>        Entity other = (Entity) obj;<a name="line.2558"></a>
<span class="sourceLineNo">2559</span>        return this.getId() == other.getId();<a name="line.2559"></a>
<span class="sourceLineNo">2560</span>    }<a name="line.2560"></a>
<span class="sourceLineNo">2561</span><a name="line.2561"></a>
<span class="sourceLineNo">2562</span>    @Override<a name="line.2562"></a>
<span class="sourceLineNo">2563</span>    public int hashCode() {<a name="line.2563"></a>
<span class="sourceLineNo">2564</span>        int hash = 7;<a name="line.2564"></a>
<span class="sourceLineNo">2565</span>        hash = (int) (29 * hash + this.getId());<a name="line.2565"></a>
<span class="sourceLineNo">2566</span>        return hash;<a name="line.2566"></a>
<span class="sourceLineNo">2567</span>    }<a name="line.2567"></a>
<span class="sourceLineNo">2568</span><a name="line.2568"></a>
<span class="sourceLineNo">2569</span>    @PowerNukkitOnly<a name="line.2569"></a>
<span class="sourceLineNo">2570</span>    @Since("1.4.0.0-PN")<a name="line.2570"></a>
<span class="sourceLineNo">2571</span>    public boolean isSpinAttacking() {<a name="line.2571"></a>
<span class="sourceLineNo">2572</span>        return this.getDataFlag(DATA_FLAGS, DATA_FLAG_SPIN_ATTACK);<a name="line.2572"></a>
<span class="sourceLineNo">2573</span>    }<a name="line.2573"></a>
<span class="sourceLineNo">2574</span><a name="line.2574"></a>
<span class="sourceLineNo">2575</span>    @PowerNukkitOnly<a name="line.2575"></a>
<span class="sourceLineNo">2576</span>    @Since("1.4.0.0-PN")<a name="line.2576"></a>
<span class="sourceLineNo">2577</span>    public void setSpinAttacking() {<a name="line.2577"></a>
<span class="sourceLineNo">2578</span>        this.setSpinAttacking(true);<a name="line.2578"></a>
<span class="sourceLineNo">2579</span>    }<a name="line.2579"></a>
<span class="sourceLineNo">2580</span><a name="line.2580"></a>
<span class="sourceLineNo">2581</span>    @PowerNukkitOnly<a name="line.2581"></a>
<span class="sourceLineNo">2582</span>    @Since("1.4.0.0-PN")<a name="line.2582"></a>
<span class="sourceLineNo">2583</span>    public void setSpinAttacking(boolean value) {<a name="line.2583"></a>
<span class="sourceLineNo">2584</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_SPIN_ATTACK, value);<a name="line.2584"></a>
<span class="sourceLineNo">2585</span>    }<a name="line.2585"></a>
<span class="sourceLineNo">2586</span><a name="line.2586"></a>
<span class="sourceLineNo">2587</span>    @PowerNukkitOnly<a name="line.2587"></a>
<span class="sourceLineNo">2588</span>    @Since("1.4.0.0-PN")<a name="line.2588"></a>
<span class="sourceLineNo">2589</span>    public boolean isNoClip() {<a name="line.2589"></a>
<span class="sourceLineNo">2590</span>        return noClip;<a name="line.2590"></a>
<span class="sourceLineNo">2591</span>    }<a name="line.2591"></a>
<span class="sourceLineNo">2592</span><a name="line.2592"></a>
<span class="sourceLineNo">2593</span>    @PowerNukkitOnly<a name="line.2593"></a>
<span class="sourceLineNo">2594</span>    @Since("1.4.0.0-PN")<a name="line.2594"></a>
<span class="sourceLineNo">2595</span>    public void setNoClip(boolean noClip) {<a name="line.2595"></a>
<span class="sourceLineNo">2596</span>        this.noClip = noClip;<a name="line.2596"></a>
<span class="sourceLineNo">2597</span>        this.setDataFlag(DATA_FLAGS, DATA_FLAG_HAS_COLLISION, noClip);<a name="line.2597"></a>
<span class="sourceLineNo">2598</span>    }<a name="line.2598"></a>
<span class="sourceLineNo">2599</span>}<a name="line.2599"></a>




























































</pre>
</div>
</body>
</html>
