<?xml version="1.0" encoding="UTF-8"?>
<project name="jdiff" default="jdiff_report" basedir=".">
  <property name="powernukkit.version.before" value="1.1.1.0-PN" />
  <property name="powernukkit.version" value="1.1.1.1-PN" />
  <property name="nukkit.version" value="Nukkit-29c2a366" />

  <property name="jdiff.working.folder" value="undefined" />
  <property name="jdiff.old.name" value="undefined" />
  <property name="jdiff.new.name" value="undefined" />

  <target name="jdiff_report" depends="jdiff_powernukkit_nukkit,jdiff_powernukkit_old"/>

  <target name="def_jdiff" depends="">
    <taskdef name="jdiff" classname="jdiff.JDiffAntTask" classpath="./libs/antjdiff-2.0.0-SNAPSHOT.jar"/>
  </target>

  <target name="jdiff_powernukkit_nukkit">
    <property name="jdiff.working.folder" value="./jdiff/${powernukkit.version}_x_Nukkit" />

    <property name="jdiff.old.name" value="Cloudburst${nukkit.version}" />
    <property name="jdiff.new.name" value="PowerNukkit ${powernukkit.version}" />

    <property name="jdiff.old.src" value="../../org.cloudburst/Nukkit/target/delombok" />
    <property name="jdiff.new.src" value="../PowerNukkit/target/delombok" />

    <antcall target="jdiff_execute" />
  </target>

  <target name="jdiff_powernukkit_old">
    <property name="jdiff.working.folder" value="./jdiff/${powernukkit.version}_x_${powernukkit.version.before}" />

    <property name="jdiff.old.name" value="PowerNukkit ${powernukkit.version.before}" />
    <property name="jdiff.new.name" value="PowerNukkit ${powernukkit.version}" />

    <property name="jdiff.old.src" value="../PowerNukkit-old/target/delombok" />
    <property name="jdiff.new.src" value="../PowerNukkit/target/delombok" />

    <antcall target="jdiff_execute" />
    <deltree dir="${jdiff.working.folder}/${jdiff.old.name}" />
  </target>

  <target name="jdiff_execute" depends="def_jdiff">
    <jdiff destdir="${jdiff.working.folder}"
           verbose="on"
           stats="on"
           docchanges="on"
           docEncoding="UTF-8"
           charset="UTF-8"
           encoding="UTF-8"
           linkSource="on">
      <old name="${jdiff.old.name}">
        <dirset dir="${jdiff.old.src}" />
      </old>
      <new name="${jdiff.new.name}">
        <dirset dir="{jdiff.new.src}" />
      </new>
    </jdiff>
    <replace dir="${jdiff.working.folder}/changes">
      <include name="*.html"/>
      <replacefilter token="../PowerNukkit ${powernukkit.version}/"
                     value="../../../javadoc/${powernukkit.version}/"/>
      <replacefilter token="../PowerNukkit ${powernukkit.version.before}/"
                     value="../../../javadoc/${powernukkit.version.before}/"/>
      <replacefilter token="../stylesheet-jdiff.css"
                     value="../../stylesheet-jdiff.css"/>
      <replacefilter token="../background.gif"
                     value="../../background.gif"/>
      <replacefilter token="../black.gif"
                     value="../../black.gif"/>
    </replace>
    <replace dir="${jdiff.working.folder}">
      <include name="*.html"/>
      <replacefilter token="stylesheet-jdiff.css"
                     value="../stylesheet-jdiff.css"/>
      <replacefilter token="background.gif"
                     value="../background.gif"/>
      <replacefilter token="black.gif"
                     value="../black.gif"/>
    </replace>
    <deltree dir="${jdiff.working.folder}/${jdiff.new.name}" />
    <delete file="${jdiff.working.folder}/stylesheet-jdiff.css"/>
    <delete file="${jdiff.working.folder}/background.gif"/>
    <delete file="${jdiff.working.folder}/black.gif"/>
    <exec executable="/bin/sh" dir="${jdiff.working.folder}">
      <arg value="../../google-analytics.sh"/>
    </exec>
  </target>

</project>
